
@{
    ViewBag.Title = "Checkout";
    Layout = "~/Views/Shared/_FrontLayout.cshtml";
    Page.Title = "checkout";
}
<style>
    .showerror {
        padding: 10px 10px;
        background: #c10404;
        color: #fff;
        font-size: 16px;
    }

    #agreementmodal p {
        margin-bottom: 0px;
    }

    #agreementmodal form {
        margin-bottom: 0px !important;
    }

    #generatedAgreementmodal .modal-lg {
        width: 80%;
        max-width: 80%;
    }

    .form-label, .section-title {
        color: #565555;
    }

    .radio-inline {
        color: #fff;
    }

    .showerror.in {
        display: block;
    }

    input.ng-invalid.ng-touched {
        border-color: #FA787E;
    }

    input.ng-valid.ng-touched {
        border-color: rgba(0, 201, 167, 0.1);
    }

    .invalid-feedback {
        display: block;
        margin-left: 10px;
    }

    .table-bordered td, .table-bordered th, table.cart tbody + tbody {
        border-top: 2px solid #eceeef !important;
        border-left: 0px;
        border-right: 0px;
        border-bottom: 0px;
    }

    table.cart tbody > tr > td {
        border-top: 1px solid #eceeef !important;
    }

    
</style>
<style>
    .approvedtd td {
        background: #ffd89c;
        border: 1px solid #bba7a7;
    }

    .lapprovedtd td {
        background: #d4edda;
        border: 1px solid #bba7a7;
    }

    .lpendingtd td {
        background: #fff3cd;
        border: 1px solid #bba7a7;
    }

    .lrejectedtd td {
        background: #f8d7da;
        border: 1px solid #bba7a7;
    }

    table.cart .actions {
        padding-top: 0 !important;
    }

    .tab-pane {
        padding: 1rem;
    }

    .md-tabs {
        position: relative;
        z-index: 1;
        padding: .7rem;
        margin-right: 1rem;
        margin-bottom: -20px;
        margin-left: 1rem;
        background-color: #fff;
        border: 0;
        border-radius: .25rem;
        -webkit-box-shadow: 0 5px 11px 0 rgba(0,0,0,0.18), 0 4px 15px 0 rgba(0,0,0,0.15);
        box-shadow: 0 5px 11px 0 rgba(0,0,0,0.18), 0 4px 15px 0 rgba(0,0,0,0.15);
    }

    .indigo1 {
        background-color: #3f51b5 !important;
    }

    .md-tabs .nav-link {
        color: #082044;
        border: 0;
        -webkit-transition: all .4s;
        transition: all .4s;
    }

    .nav-tabs .nav-link {
        border: 1px solid transparent;
        border-top-left-radius: .25rem;
        border-top-right-radius: .25rem;
    }

    .nav-link {
        display: block;
        padding: .5rem 1rem;
    }

    .nav-tabs .nav-link:hover, .nav-tabs .nav-link.active:focus, .nav-tabs .nav-link.active:hover {
        border-color: #3f51b5;
    }

    .nav-tabs .nav-item {
        background: rgba(0,0,0,0.05);
        display: block;
        position: relative;
    }

        .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link {
            color: #fff !important;
            background-color: #082044 !important;
            border-color: #e7eaf3 #e7eaf3 #fff;
        }

    .entry-content .card {
        font-weight: 400;
        border: 0;
        -webkit-box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
        box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
    }

    table.cart .actions {
        padding-top: 0 !important;
    }

    .btndropdown .btn, .open > .btn.dropdown-toggle, .open > .button.dropdown-toggle, .open > .dropdown-toggle.hero-action-btn, .open > button.dropdown-toggle {
        background-color: #4d44bd;
        border-color: #4940b4;
        border-radius: 0px;
        color: #fff;
    }


    .btndropdown .dropdown-menu {
        margin-top: 0px;
    }

    .btndropdown .dropdown-item {
        cursor: pointer;
    }

    #datepicker .input-group-addon, #datepicker .input-group-btn {
        width: 9% !important;
        padding: 0.67rem .75rem !important;
    }


    .quoteh6 {
        text-align: left;
        color: #8a0808 !important;
        padding-bottom: 15px;
        font-size: 0.8rem;
    }

    .col-xs-3.quoteh6.border, .col-xs-9.border.quoteh6 {
        padding-top: 15px;
    }

    {
        padding-top: 15px;
    }



    .agreementform {
        color: #333;
    }

    .agreementtable {
        background-color: #082044;
    }

    .panel-group .panel {
        border-radius: 0;
        box-shadow: none;
        border: 1px solid #EEEEEE;
        margin-top: 10px;
    }

    .panel-default > .panel-heading {
        padding: 0;
        border-radius: 0;
        color: #212121;
        /*background-color: #FAFAFA;*/
        /*border-color: #EEEEEE;*/
    }

    .panel-title {
        font-size: 14px;
    }

        .panel-title > a {
            display: block;
            padding: 15px;
            text-decoration: none;
        }

    .more-less {
        float: right;
        color: #212121;
        margin-top: 10px;
        margin-right: 10px;
    }

    .panel-default > .panel-heading + .panel-collapse > .panel-body {
        border-top-color: #EEEEEE;
    }

    .nav-tabs .nav-link .tab-items-count {
        border: 1px solid #fe5300;
        background: #fe5300;
        border-radius: 50%;
        position: absolute;
        top: -8px;
        right: 0px;
        color: #fff;
    }

    .nav-tabs .nav-link.active1 .tab-items-count {
        background: #fff;
        color: #333;
    }



    #agreementmodal p {
        margin-bottom: 0px;
    }

    .price-color-gold {
        color: #000 !important;
    }

    .maintable {
        border-collapse: separate;
        border-spacing: 0 0.5em;
    }

    .nav-item1 a, li .dropdown-title {
        font-size: 1em;
    }

    .sidebar-navbar.view-all .dropdown-toggle::after {
        content: "\f105";
    }

    .nav-item1 {
        margin: 0px !important;
    }

        .nav-item1.active {
            background: #082044;
        }

        .nav-item1 a:before {
            content: "\f105";
            font-size: 1.00012rem;
            line-height: 1;
            order: -1;
            margin-left: 0;
            margin-right: .5rem;
            display: inline-block;
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }

        .nav-item1.active a {
            color: #fff;
        }

        .nav-item1:hover {
            background: #082044;
            color: #fff;
        }

            .nav-item1:hover a {
                color: #fff;
            }

    .invalid-feedback {
        display: block;
        margin-left: 10px;
        text-align: left;
    }

    #grid table {
        border: inherit;
        color: #333 !important;
    }

        #grid table td, #grid table th {
            border: inherit;
            padding: 0px;
        }

    #grid .table3 td, #grid .table3 th, #grid .border {
        border: 1px solid !important;
    }

    .nodata p {
        font-size: 1.2em;
    }

    #agreementmodal form {
        margin-bottom: 0px !important;
    }

    #generatedAgreementmodal .modal-lg {
        width: 80%;
        max-width: 80%;
    }
    .msgModal.fade.in{
        display:flex!important;
        align-items:center;
    }
    #msgModal:before {
        content: '';
        display: inline-block;
        height: 100%;
        vertical-align: middle;
    }

    #msgModal1 .modal-dialog {
        display: inline-block;
        vertical-align: middle;
        left: 18%;
    }

    #msgModal .modal-content {
        -webkit-animation-name: modal-animation;
        -webkit-animation-duration: 0.5s;
        animation-name: modal-animation;
        animation-duration: 0.5s;
    }

    .agreementordertable tr td {
        color: #333 !important;
    }

    .agreementordertable tr td {
        padding: 2px;
    }

    .agreementordertable tr.first td {
        border-top: 0px;
    }

    .agreementordertable tr td {
        width: 33.33%;
    }

        .agreementordertable tr td:first-child {
            width: 50%;
        }

    .bnktable tr td {
        padding: .25rem;
    }

    @@media(min-width:1100px) {
        #reviewModal .modal-lg {
            width: 600px;
        }

        #agreementmodal .modal-lg {
            width: 900px;
            max-width: 900px;
        }

        #agreementmodal2 .modal-lg {
            width: 90%;
            min-height: 700px;
            max-width: 90%;
        }

        #leaseterm-dialog .modal-lg {
            width: 70%;
            max-width: 100%;
        }
    }

    .panel-table {
        margin-bottom: 0px;
    }

        .panel-table thead th, .panel-table tbody td {
            border-top: none;
            border-bottom: none;
            color: #333;
            padding: 4px .75rem;
        }

    .aggreementrow table tbody td {
        padding: 4px .75rem !important;
        border-top: 0px !important;
    }

    .aggreementrow .btn {
        padding: 4px 10px !important;
        cursor: pointer !important;
    }

    .nopadding {
        padding-left: 0px !important;
        padding-right: 0px !important;
    }
    .poinput{
        color:#fff!important;
    }
        .poinput:focus {
            color: #818181!important;
        }
    .invalid-feedback {
        color: #fd4537!important;
    }
</style>
<!-- ========== MAIN CONTENT ========== -->
<main id="content" role="main" class="checkout-page confirmorder-page" ng-controller="ConfirmOrderController">
    <div class="se-pre-con" ng-show="loader">

    </div>
    <div id="message" class="se-pre-con" style="left: 16px;top: 41px;width: 98%;height: 98%;z-index:111;display: none;">
        <h1>Loading ...</h1>
    </div>
    <div id="addnewaddress-dialog">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title ng-binding">New Address</h4>
                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                    </div>
                    <form class="rform js-validate" name="form" ng-submit="SaveData(form.$valid)" novalidate>
                        <div class="modal-body">

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="js-form-message mb-2">
                                        <label></label>
                                        <div id="postcode_lookup1" ng-init="postcode='';selectedAddress=''">
                                            <input type="text" id="getaddress_input" placeholder="Enter your Postcode" ng-model="postcode" class="form-control postcode-autocomplete" name="getaddress_input" autocomplete="off">
                                            <button id="getaddress_button" type="button" class="btn btn-primary" ng-click="getAddress(postcode)" ng-disabled="getaddressdisable">{{getaddbtntxt}}</button>


                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7" ng-show="addressess.length>0">
                                    <div class="js-form-message mb-2">
                                        <select id="getaddress_dropdown" ng-options="address as address.Name for address in addressess track by address.Code" class="form-control js-select selectpicker dropdown-select" ng-model="selectedAddress" ng-change="getSelectedAddress(selectedAddress)" data-msg="Please select country." data-error-class="u-has-error" data-success-class="u-has-success"
                                                data-live-search="true"
                                                data-style="form-control border-color-1 font-weight-normal">
                                            <option value="">Select address</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <!-- Input -->
                                    <div class="js-form-message mb-2">
                                        <label class="form-label">
                                            Address line 1
                                            <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" id="line1" maxlength="100" class="form-control" ng-model="User.maddress1" name="streetAddress" placeholder="" aria-label="470 Lucy Forks" required="" data-msg="Please enter a valid address." data-error-class="u-has-error" data-success-class="u-has-success">
                                        <div class="invalid-feedback" ng-show="(form.$submitted || form.streetAddress.$touched) && form.streetAddress.$error.required">Enter Street Address</div>
                                    </div>
                                    <!-- End Input -->
                                </div>

                                <div class="col-md-4">
                                    <!-- Input -->
                                    <div class="js-form-message mb-2">
                                        <label class="form-label">
                                            Address line 2
                                        </label>
                                        <input type="text" id="line2" maxlength="100" class="form-control" ng-model="User.maddress2" placeholder="" aria-label="YC7B 3UT" data-msg="Please enter a valid address." data-error-class="u-has-error" data-success-class="u-has-success">

                                    </div>
                                    <!-- End Input -->
                                </div>

                                <div class="col-md-6">
                                    <!-- Input -->
                                    <div class="js-form-message mb-2">
                                        <label class="form-label">
                                            City
                                            <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" id="town" maxlength="50" class="form-control" ng-model="User.mcity" name="cityAddress" placeholder="" aria-label="London" required="" data-msg="Please enter a valid address." data-error-class="u-has-error" data-success-class="u-has-success" autocomplete="off">
                                        <div class="invalid-feedback" ng-show="(form.$submitted || form.cityAddress.$touched) && form.cityAddress.$error.required">Enter City</div>
                                    </div>
                                    <!-- End Input -->
                                </div>

                                <div class="col-md-6">
                                    <!-- Input -->
                                    <div class="js-form-message mb-2">
                                        <label class="form-label">
                                            Postcode/Zip
                                            <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" maxlength="9" id="postcode" class="form-control" ng-model="User.mpostcode" name="postcode" placeholder="" required="" data-msg="Please enter a postcode or zip code." data-error-class="u-has-error" data-success-class="u-has-success">
                                        <div class="invalid-feedback" ng-show="(form.$submitted || form.postcode.$touched) && form.postcode.$error.required">Enter Postcode</div>
                                    </div>
                                    <!-- End Input -->
                                </div>
                                <div class="col-md-6">
                                    <!-- Input -->
                                    <div class="js-form-message mb-2">
                                        <label class="form-label">
                                            Country
                                            <span class="text-danger">*</span>
                                        </label>
                                        <select name="country" ng-init="mcountry = {Code:230}" ng-options="country as country.Name for country in countries track by country.Code" class="form-control js-select selectpicker dropdown-select" ng-model="mcountry" ng-change="getStates(mcountry)" required="" data-msg="Please select country." data-error-class="u-has-error" data-success-class="u-has-success"
                                                data-live-search="true"
                                                data-style="form-control border-color-1 font-weight-normal">
                                            <option value="">Select country</option>
                                        </select>
                                        <div class="invalid-feedback" ng-show="(form.$submitted || form.country.$touched) && form.country.$error.required">Select Country from list</div>
                                    </div>
                                    <!-- End Input -->
                                </div>

                                <div class="col-md-6">
                                    <!-- Input -->
                                    <div class="js-form-message mb-2">
                                        <label class="form-label">
                                            State
                                            <!--<span class="text-danger">*</span>-->
                                        </label>
                                        <select ng-options="state as state.Name for state in states track by state.Code" class="form-control js-select selectpicker dropdown-select" ng-model="mstate" data-msg="Please select states." data-error-class="u-has-error" data-success-class="u-has-success"
                                                data-live-search="true"
                                                data-style="form-control border-color-1 font-weight-normal">
                                            <option value="">Select State</option>
                                        </select>

                                    </div>
                                    <!-- End Input -->
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" ng-disabled="form.$invalid" class="btn btn-primary-dark-w btn-block btn-pill font-size-20 mb-3 py-3">{{submitText}}</button>
                            <button type="button" class="btn btn-secondary" ng-repeat="button in leaseaddress.buttons" ng-click="DefaultCheck(button.item)" data-dismiss="modal">Close</button>

                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="alladress-dialog">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title ng-binding">Choose Address</h4>

                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-2">
                            <div class="col-lg-12">
                                <button class="btn btn-primary pull-right" ng-click="AddNewAddress()">Add New</button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4 mb-5" ng-repeat="addr in alladdress">
                                <label class="m-option">
                                    <span class="m-option__control">
                                        <span class="m-radio m-radio--state-brand">
                                            <input type="radio" name="billing_delivery" ng-model="selectedaddressid" ng-change="changeAddress(addr.museraddrid)" ng-value="addr.museraddrid">
                                            <span></span>
                                        </span>
                                    </span>
                                    <span class="m-option__label">
                                        <span class="m-option__body">
                                            <span ng-show="addr.maddress1">{{addr.maddress1}}<br /></span>
                                            <span ng-show="addr.maddress2">{{addr.maddress2}}<br /></span>
                                            <span>{{addr.mcity}} - {{addr.mpostcode}}</span>
                                        </span>
                                    </span>
                                </label>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" ng-repeat="button in leaseaddress.buttons" ng-click="executeleaseAction(button.action,button.item,button.qty,button.event,button.singleitem)" class="btn btn-primary ng-binding ng-scope">{{button.label}}</button>
                        <button type="button" class="btn btn-secondary" ng-repeat="button in leaseaddress.buttons" ng-click="DefaultCheck(button.singleitem)" data-dismiss="modal">Close</button>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="leaseaddress-dialog">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title ng-binding">Alternative Address</h4>
                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="span5"><textarea id="alternative_address"></textarea></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-soft-danger" ng-click="clearaddress()">Clear</button>
                        <button type="button" ng-repeat="button in leaseaddress.buttons" ng-click="executeleaseAction(button.action,button.item,button.qty,button.event)" class="btn btn-primary ng-binding ng-scope">Update Address</button>
                        <button type="button" class="btn btn-secondary" ng-repeat="button in leaseaddress.buttons" ng-click="DefaultCheck(button.item)" data-dismiss="modal">Close</button>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- breadcrumb -->
    <div id="agreementmodal2">
        <div class="modal fade confirmation-dialog" role="dialog" style="overflow-y:scroll">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        <div class="row">
                            <div class="col-lg-6">
                                <h4 class="modal-title ng-binding">Lease Agreement</h4>
                            </div>
                            <div class="col-lg-6" ng-show="printoption" style="display:none;">
                                <button type="submit" class="btn btn-primary" onclick="doPrint()">Print Agreement</button>

                                <form method="post" action="Order/Export" style="display:inline-block;margin-left:10px;">
                                    <input type="hidden" name="html" />

                                    <button type="submit" class="btn btn-primary" id="exportpdfnew">Export Agreement</button>
                                </form>



                            </div>
                        </div>
                    </div>
                    <div class="modal-body">
                        <iframe id="printf3" style="width:100%;height:100%;"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="agreementmodal">
        <div class="modal fade confirmation-dialog" role="dialog" style="overflow-y:scroll">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">

                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        <div class="row">
                            <div class="col-lg-6">
                                <h4 class="modal-title ng-binding">Lease Agreement</h4>
                            </div>
                            <div class="col-lg-6" ng-show="printoption" style="display:none;">
                                <button type="submit" class="btn btn-primary" onclick="doPrint()">Print Agreement</button>

                                <form method="post" action="Order/Export" style="display:inline-block;margin-left:10px;">
                                    <input type="hidden" name="html" />

                                    <button type="submit" class="btn btn-primary" id="exportpdfnew">Export Agreement</button>
                                </form>



                            </div>
                        </div>
                    </div>
                    <div class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <div class="row">
                            <div class="col-lg-12">
                                <!--<button type="submit" ng-show="printoption" class="btn btn-primary" onclick="doPrint()">Print Agreement</button>

                                <form method="post" ng-show="printoption" action="Order/Export" style="display:inline-block;margin-left:10px;">
                                    <input type="hidden" name="html" />

                                    <button type="submit" class="btn btn-primary" id="exportpdfnew">Export Agreement</button>
                                </form>
                                -->

                                <button type="button" data-dismiss="modal" class="btn" style="background:#000;">Cancel</button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="agreementorder-dialog">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content" ng-show="agorder.Product.length>0">
                    <div class="modal-header">
                        <h4 class="modal-title">Order :{{agorder.mleaseno}} <span style="float:right;"> Your PO No :{{agorder.msorderref}}</span></h4>
                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="row row m-0 box-shadow-1">
                            <div class="col-md-12 m-2">

                                Payment Mode : {{agorder.mpayment=='2'?'Direct Debit':'On Invoice'}}
                                <button class="btn btn-primary pull-right" ng-click="printorder(agorder)">Print Order</button>
                            </div>
                            <div class="col-md-12">
                                <table class="table" ng-show="payment=='2'">
                                    <tbody>
                                        <tr>
                                            <td style="color:#333;width:200px;">Bank Name</td>
                                            <td><label class="form-label">{{bank.mbankname}}</label></td>
                                            <td style="color:#333;width:200px;">Account No.</td>
                                            <td><label class="form-label">{{bank.mbankaccount}}</label></td>
                                        </tr>
                                        <tr>
                                            <td style="color:#333;width:200px;">Account Holder</td>
                                            <td><label class="form-label">{{bank.maccountholder}}</label></td>
                                            <td style="color:#333;width:200px;">Bank Sort Code</td>
                                            <td><label class="form-label">{{bank.mbankshort}}</label></td>
                                        </tr>
                                    </tbody>
                                </table>


                            </div>

                        </div>
                        <div class="row row m-0 mt-5 box-shadow-1">
                            <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                <thead>
                                    <tr>
                                        <th class="product-thumbnail">&nbsp;</th>
                                        <th style="width:150px;" class="product-name">Product Details</th>
                                        <th style="text-align:center" class="product-name">Term</th>
                                        <th style="text-align:center" class="product-name">Unit Rental</th>
                                        <th style="text-align:center" class="product-quantity">Quantity</th>
                                        <th style="text-align:center" class="product-subtotal">Total</th>



                                    </tr>

                                </thead>
                                <tbody ng-repeat="item in agorder.Product">
                                    <tr>
                                        <td class="product-thumbnail">
                                            <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" style="width:auto;height:50px;" width="300" height="300">
                                            </a>
                                        </td>

                                        <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                            <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">{{item.mproductname}}</a>

                                            <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br /><br />Manufacturer: {{item.suppliername}}</span>
                                            <span style="font-size: 0.675em;color:#c80606;" ng-if="item.suppliername!=null && item.mleadtime>=0"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                            <span style="font-size: 0.675em;" ng-if="item.suppliername!=null && item.mleadtime==0"><br />Estimated Delivery: {{deliverytime}} days</span>
                                        </td>
                                        <td class="product-name" align="center" style="width:200px;">
                                            <div class="terms">
                                                <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                                            </div>
                                        </td>
                                        <td style="text-align:center">
                                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style=""><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                                        </td>
                                        <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                            <div class="quantity" style="margin:0 auto;">
                                                <input type="text" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                            </div>
                                        </td>

                                        <td class="product-subtotal" style="text-align:center" data-title="Total" style="width:80px;">
                                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style=""><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                                        </td>
                                    </tr>


                                </tbody>
                                <tfoot>
                                    <tr ng-repeat="(key,value) in filtered = (agorder.Product)  | groupBy:'[mtermf,mtermp]'">

                                        <td colspan="6" style="color:#333;">{{getTermData(key)}} total = £{{getVolumeSum(value)}}</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>


                    </div>
                    <div class="modal-footer" style="display:block;">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="confirmation-dialog">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">{{confirmationDialogConfig.title}}</h4>
                    </div>
                    <div class="modal-body">
                        <div class="span5">{{confirmationDialogConfig.message}}</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" style="background:#333;" data-dismiss="modal">Cancel</button>
                        <button type="button" ng-repeat="button in confirmationDialogConfig.buttons" ng-click="executeDialogAction(button.action,button.index,button.step)" class="btn btn-primary">{{button.label}}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="confirmmodal">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="span5">There are <span id="cnt"></span> pending agreement to save and sign. Do you still want to go back?</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" style="background:#333;" data-dismiss="modal">No</button>
                        <button type="button" id="continue" class="btn btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="docinmodal" class="modal fade" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="row" style="width:100%;">
                        <button type="button" class="close mdclose" data-dismiss="modal">×</button>

                        <div class="col-lg-12">
                            <div class="alert alert-success" style="display:none;">
                                Upload Doc In

                            </div>

                        </div>
                        <input type="hidden" id="reload" value="" />
                    </div>
                </div>

                <div class="modal-body" style="padding:0 22px;">
                    <div class="row m-2 ng-hide" ng-init="ScanCopy=1">

                        <div class="col-lg-6">
                            <button type="button" class="btn btn-primary" ng-click="ScanCopy=1">Upload scanned doc</button>
                        </div>
                        <div class="col-lg-6">
                            <button type="button" class="btn btn-primary" ng-click="ScanCopy=2">Do not have scanner?</button>
                        </div>

                    </div>
                    <div class="row" ng-show="ScanCopy=='2'">
                        <div class="col-lg-12">
                            <hr />
                        </div>

                        <div class="col-lg-12">
                            <div class="alert alert-success">
                                <p>Oh! Not to worry. Just send your signed copy to the lessor at below address.</p><br />
                                <p><strong>17 The Avenue, London NW6 7NR, UK</strong></p>
                            </div>
                        </div>
                    </div>
                    <form ng-show="ScanCopy==1" method="post" ng-submit="UploadDocs()" name="f1">
                        <div ng-show="!DocUpload">
                            <div class="row form-group">
                                <div class="col-lg-12">
                                    <hr />
                                </div>
                                <div class="col-lg-3">
                                    <label for="exampleInputinvoiceserialnumber">Doc Id</label>
                                </div>
                                <div class="col-lg-9">
                                    <input type="text" readonly ng-model="mleaseno" class="form-control m-input--air" name="mleaseno" value="{{mleaseno}}" />
                                    <!--<input type="text" class="form-control m-input--air" compare-to="mleaseno" name="leasedocid" ng-model="leasedocid" placeholder="Doc Id" required>
                                    <div class="form-control-feedback" style="color:#b20606" ng-show="f1.leasedocid.$dirty && f1.leasedocid.$error.compareTo">Enter correct  doc id</div>-->
                                </div>
                            </div>
                            <div class="row form-group">
                                <div class="col-lg-3">
                                    <label for="exampleInputEmail1">Document</label>

                                </div>
                                <div class="col-lg-9">
                                    <div class="custom-file">

                                        <input type="file" class="custom-file-input" nv-file-select="" uploader="uploader" />
                                        <label class="custom-file-label" for="customFile">Choose file</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="alert alert-success">
                                <p>Please send your signed copy to the lessor at below address.</p><br />
                                <p><strong>17 The Avenue, London NW6 7NR, UK</strong></p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <button type="submit" class="btn btn-primary" id="uploaddoc" ng-click="uploader.queue[0].upload()">Upload Doc</button>
                                <button type="button" data-dismiss="modal" class="btn btn-warning">Close</button>
                            </div>
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>
    <div class="msgModal modal fade" id="msgModal" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header" ng-show="hideclose">
                    <button type="button" class="close mdclose" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body" style="padding:0px;">
                    <div class="alert alert-success" style="margin-bottom:0px;text-align:center" role="alert">
                        <h6 class="alert-heading">{{bootmsg}}</h6>
                        <p ng-bind-html="bootdetailmsg"></p>

                    </div>
                </div>

            </div>
        </div>
    </div>
    <div id="leaseterm1-dialog">
        <div class="modal fade confirmation-dialog" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">{{leaseTerms1.title}}</h4>
                        <button type="button" class="close" data-dismiss="modal">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="span5" ng-bind-html="leaseTerms1.message"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                    <thead>
                                        <tr>
                                            <th class="product-thumbnail">&nbsp;</th>
                                            <th style="width:150px;" class="product-name">Product Details</th>
                                            <th style="text-align:center" class="product-name">Term</th>
                                            <th style="text-align:center" class="product-name">Unit Rental</th>
                                            <th style="text-align:center" class="product-quantity">Quantity</th>
                                            <th style="text-align:center" class="product-subtotal">Total</th>



                                        </tr>

                                    </thead>
                                    <tbody ng-repeat="item in splititem">
                                        <tr>
                                            <td class="product-thumbnail">
                                                <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                    <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" width="300" height="300">
                                                </a>
                                            </td>

                                            <td class="product-name" style="word-wrap: break-word;white-space:normal;width:350px;" data-title="Product">
                                                <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                    {{item.mproductname}}
                                                </a>
                                                <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br /><br />Manufacturer: {{item.suppliername}}</span>
                                            </td>
                                            <td class="product-name" align="center" style="width:200px;">
                                                <div class="terms">
                                                    <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                                                </div>
                                            </td>
                                            <td style="text-align:center">
                                                <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style=""><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                                            </td>
                                            <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                                <div class="quantity" style="margin:0 auto;">
                                                    <input type="text" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                                </div>
                                            </td>

                                            <td class="product-subtotal" style="text-align:center" data-title="Total" style="width:80px;">
                                                <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style="color: #eac603;"><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                                            </td>
                                        </tr>


                                    </tbody>
                                    <tfoot>
                                        <tr ng-repeat="(key,value) in filtered = splititem  | groupBy:'[mtermf,mtermp]'">

                                            <td colspan="6" style="color:#333;">{{getTermData(key)}} total = £{{getVolumeSum(value)}}</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="span5" ng-bind-html="leaseTerms1.message2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" ng-repeat="button in leaseTerms1.buttons" ng-click="executeleaseAction(button.action,button.item,button.qty,button.event)" style="margin-right:5px;" class="btn btn-primary">{{button.label}}</button>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-cloak class="container" ng-if="!loader">

        <form id="msform">
            <ul id="progressbar">
                <li class="active p-2" id="order"><strong>Confirm Delivery Details</strong></li>
                <li id="payment1" class="p-2"><strong>Confirm Payment Method</strong></li>
                <li id="print" class="p-2"><strong>Print Agreement</strong></li>
                <!--<li id="agreement"><strong>Upload Signed Agreement</strong></li>-->

            </ul>
        </form>
    </div>
    <!-- End breadcrumb -->

    <div ng-cloak class="container" ng-if="!loader">
        <div id="primary">
            <div id="tabloading" class="se-pre-con" style="left: 16px;top: 41px;width: 98%;height: 98%;z-index:111;" ng-show="tabloading">
            </div>
            <main id="main" class="site-main" ng-if="!loader">


                <article id="post-3134" class="post-3134 page type-page status-publish hentry">


                    <div class="entry-content">
                        <div class="woocommerce orderpage">

                            <!------------------Order Start------------------------------>

                            <div ng-show="showOrder" class="border box-shadow-1 pt-2 mb-10">
                                <div class="row box-shadow-1 ml-3 mr-3 p-2">
                                    <div class="col-lg-12">
                                        <div class="woocommerce-notices-wrapper">
                                            <h3 class="text-center" style="color:#333;font-weight:600">{{pagetitle}}</h3>
                                        </div>

                                    </div>
                                </div>
                                <div class="row box-shadow-1 mt-1 ml-3 mr-3 mb-3 p-2">
                                    <!--<div class="col-md-12 m-1">
            <div class="col-md-2 nopadding">
                <label class="" style="color:#333;font-weight:500">
                    Select Contact
                </label>

            </div>
            <div class="col-md-4">
                <select ng-options="contacts.Id as contacts.cusername for contacts in UserContacts" ng-change="GetDetail(mcontactid)" class="form-control select2" style="height:24px;padding:0px 1rem" ng-model="mcontactid"></select>

            </div>

        </div>
        <div class="col-md-12">
            <hr />
        </div>-->
                                    <style>
                                        .cptable tr td {
                                            padding: 2px;
                                            color: #333;
                                            border: none;
                                            font-size: 14px;
                                        }
                                    </style>
                                    <div class="col-lg-6">
                                        <label style="color:#333"><strong>Contact Person:</strong></label>
                                        <div style="color:#655e5e">
                                            <table class="table table-borderless table-dark cptable">
                                                <tr>
                                                    <td><strong>Name : </strong></td>
                                                    <td><select ng-options="contacts.Id as contacts.cusername for contacts in UserContacts" ng-change="GetDetail(mcontactid)" class="form-control select2" style="height:24px;padding:0px 1rem;width:60%;display:inline-block;" ng-model="mcontactid"></select></td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Position : </strong></td>
                                                    <td>{{singlecontact.cposition}}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Phone : </strong></td>
                                                    <td>{{singlecontact.cphone}}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Email : </strong></td>
                                                    <td>{{singlecontact.cemailaddress}}</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <label style="color:#333"><strong>Delivery Address:</strong> <a href="javascript:;" class="btn btn-link pull-right border-0" style="padding-top:0!important;padding-bottom:0px!important;line-height:15px;color:#3f51b5!important" ng-click="showAddresses()">Change</a> </label>
                                        <div style="color:#333" ng-bind-html="defaultaddress"></div>
                                    </div>
                                </div>
                                <!-----SPLIT Start Here-->
                                <div class="row box-shadow-1 m-3 p-2" style="margin-top:0px!important;" ng-if="leaseTerms.Split==1" ng-repeat="(key,value) in filtered = (leaseTerms.Products )  | groupBy:'[mtermf,mtermp,mleadtime]'">
                                    <div class="col-lg-12" style="border-bottom: 1px solid #ddd;border-bottom: 1px solid #ddd;background: #ddd;padding-top: 7px;">
                                        <!--<h6 style="color:#333">Order Number: <strong>{{$index+1}},  {{value[0].mtermp/12}} years, total {{getTermDataOnly(key)}} payments of £{{getVolumeSum(value)}} (inc VAT)</strong><span ng-if="value[$index].mleadtime>leadtime">(LeadTime : {{value[$index].mleadtime}} days)</span></h6>-->
                                        <
                                        <div class="col-lg-6">
                                            <
                                            <h6 style="color:#333"><span>Lease term: <strong>{{value[0].mtermp/12}} years, {{getTermDataOnly(key)}}</strong>.</span></h6>
                                        </div>
                                        <div class="col-lg-6">
                                            <h6 style="color:#333;text-align:right;"><span>Total Rental  = <strong>£{{getVolumeSum(value)}} {{ getNewTerms(value[$index].mtermf,value[$index].mtermp) }}</strong></span> <span ng-if="value[$index].mleadtime>leadtime">(LeadTime : {{value[$index].mleadtime}} days)</span></h6>
                                        </div>

                                    </div>
                                    <div class="col-lg-12">
                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                            <thead>
                                                <tr>
                                                    <th class="product-remove">&nbsp;</th>
                                                    <th class="product-thumbnail">&nbsp;</th>
                                                    <th style="width:350px;" class="product-name">Product Details</th>
                                                    <!--<th style="text-align:center" class="product-name">Term</th>
                        <th style="text-align:center" class="product-name">Unit Rental</th>-->
                                                    <th style="text-align:center" class="product-quantity">Quantity</th>
                                                    <!--<th style="text-align:center" class="product-subtotal">VAT</th>-->
                                                    <th style="text-align:center" class="product-subtotal">Total</th>
                                                    <th style="width:150px;text-align:center" class="product-name">Delivery Address</th>


                                                </tr>

                                            </thead>
                                            <tbody ng-repeat="item in value">
                                                <tr class="woocommerce-cart-form__cart-item cart_item border-0">
                                                    <td class="product-remove">
                                                        <a style="cursor:pointer;" ng-click="deleteFromCart(item.msubquoteid,$index)" class="remove" aria-label="Remove this item" data-product_id="2623" data-product_sku="5487FB8/08"><i class="fa fa-trash"></i></a>
                                                    </td>
                                                    <td class="product-thumbnail">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" width="300" height="300">
                                                        </a>
                                                    </td>

                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            {{item.mproductname}}
                                                        </a>
                                                        <span style="font-size: 0.675em;" ng-if="item.warrantydetails!=null"><br />With Extended {{item.warrantydetails.mprodname}}</span><br />
                                                        <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br />Manufacturer: {{item.suppliername}}</span>
                                                        <span style="font-size: 0.675em;color:#06429c;" ng-if="item.suppliername!=null && item.mleadtime>=0 && item.mleadtime<=21"><br />Estimated Delivery: {{item.Product.mleadtime}} days</span>
                                                        <span style="font-size: 0.675em;color:#c80606;" ng-if="item.suppliername!=null && item.mleadtime>21"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                        <div class="offer" style='margin-top:8px; margin-bottom:0px;background:#5cb85c;color: #fff !important;font-weight: 700;padding:5px;' ng-show="item.mofferdetail!=null && item.mofferdetail!='' && item.mofferapplied">
                                                            <span class="loop-product-categories dealdetail ng-cloak" ng-show="item.mofferapplied">Applied: {{item.mofferdetail}}</span>
                                                        </div>

                                                    </td>
                                                    <!--<td class="product-name" data-title="Term" align="center" style="width:200px;">
                            <div class="terms">
                                <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                            </div>
                        </td>
                        <td style="text-align:center" data-title="Unit Rental">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style=""><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                                        <div class="quantity" style="margin:0 auto;">
                                                            <input type="text" tabindex="-1" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                                        </div>
                                                    </td>
                                                    <!--<td class="product-subtotal" style="text-align:center" data-title="VAT">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{item.mvat | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-subtotal" style="text-align:center" data-title="Total">
                                                        <span class="woocommerce-Price-amount amount">
                                                            <span class="price-color-gold">
                                                                <!--<span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity+(item.mvat) | number:2}}</span>-->

                                                                <span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}
                                                            </span>
                                                            <br />
                                                            <span class="pm" style="font-size:10px;margin-bottom:0px;">+VAT</span><br />
                                                            <span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span><br />
                                                            <label ng-show="item.minstallationflag=='yes'" class="installtext" style="">Installation included</label>
                                                        </span>
                                                    </td>
                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;width:250px;position:relative;text-align:center" data-title="Product">
                                                        <input type="checkbox" ng-if="item.maddressflag!=1" class="{{item.msubquoteid}}check" ng-checked="item.maddressflag!=1" ng-click="AddAddress(item,item.maddressflag)"> <span ng-if="item.maddressflag!=1">As Above</span>
                                                        <div ng-if="item.maddressflag==1" style="">
                                                            <button type="button" class="close mdclose tblremove" style="border:0px!important;font-size:12px;color:#c80606;" ng-click="RemoveAddress(item)">Amend Delivery Address</button>
                                                            <div ng-bind-html="item.AddressDetail"></div>
                                                        </div>
                                                    </td>
                                                </tr>


                                            </tbody>

                                        </table>

                                    </div>
                                </div>
                                <!-----SPLIT END Here-->
                                <div class="row box-shadow-1 m-3 p-2" style="margin-top:0px!important;" ng-if="leaseTerms.Split==0" ng-repeat="(key,value) in filtered = (leaseTerms.Products)  | groupBy:'[mtermf,mtermp]'">
                                    <div class="col-lg-12 ordertitle" style="border-bottom: 1px solid #ddd;background: #ddd;padding-top: 7px;">

                                        <!--<h6 style="color:#333">Lease term: <strong>  {{value[0].mtermp/12}} years, total {{getTermDataOnly(key)}} payments of £{{getVolumeSum(value)}} (excl. VAT)</strong></h6>-->                                        <!---({{getTermData(key)}} total = £{{getVolumeSum(value)}})-->
                                        <div class="col-lg-6">

                                            <h6 style="color:#333"><span>Lease term: <strong>{{value[0].mtermp/12}} years, {{getTermDataOnly(key)}}</strong>.</span></h6>
                                        </div>
                                        <div class="col-lg-6">
                                            <h6 style="color:#333;text-align:right;"><span>Total Rental = <strong>£{{getVolumeSum(value)}} {{ getNewTerms(value[$index].mtermf,value[$index].mtermp) }}</strong></span> </h6>
                                        </div>

                                        <!--<h6 style="color:#333">({{getAnnualMsg(key,value)}})</h6>-->
                                    </div>
                                    <div class="col-lg-12">
                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                            <thead>
                                                <tr>
                                                    <th class="product-remove">&nbsp;</th>
                                                    <th class="product-thumbnail">&nbsp;</th>
                                                    <th style="width:350px;" class="product-name">Product Details</th>
                                                    <!--<th style="text-align:center" class="product-name">Term</th>
                        <th style="text-align:center" class="product-name">Unit Rental</th>-->
                                                    <th style="text-align:center" class="product-quantity">Qty</th>
                                                    <!--<th style="text-align:center" class="product-subtotal">VAT</th>-->
                                                    <th style="text-align:center" class="product-subtotal">Total</th>

                                                    <th style="width:150px;text-align:center" class="product-name">Delivery Address</th>


                                                </tr>

                                            </thead>
                                            <tbody ng-repeat="item in value" class="mb-5">
                                                <tr class="woocommerce-cart-form__cart-item cart_item">
                                                    <td class="product-remove">
                                                        <a style="cursor:pointer;" ng-click="deleteFromCart(item.msubquoteid)" class="remove" aria-label="Remove this item" data-product_id="2623" data-product_sku="5487FB8/08"><i class="fa fa-trash"></i></a>
                                                    </td>
                                                    <td class="product-thumbnail">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" width="300" height="300">
                                                        </a>
                                                    </td>

                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            {{item.mproductname}}
                                                        </a>
                                                        <span style="font-size: 0.675em;" ng-if="item.warrantydetails!=null"><br />With Extended {{item.warrantydetails.mprodname}}</span>
                                                        <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br />Manufacturer: {{item.suppliername}}</span>
                                                        <span style="font-size: 0.675em;color:#06429c;" ng-if="item.suppliername!=null && item.mleadtime>=0 && item.mleadtime<=21"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                        <span style="font-size: 0.675em;color:#c80606;" ng-if="item.suppliername!=null && item.mleadtime>21"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                        <div class="offer" style='margin-top:8px; margin-bottom:0px;background:#5cb85c;color: #fff !important;font-weight: 700;padding:5px;' ng-show="item.mofferdetail!=null && item.mofferdetail!='' && item.mofferapplied">
                                                            <span class="loop-product-categories dealdetail ng-cloak" ng-show="item.mofferapplied">Applied: {{item.mofferdetail}}</span>
                                                        </div>

                                                    </td>




                                                    <!--<td class="product-name" align="center" style="width:200px;" data-title="Term">

                            <div class="terms">
                                <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                            </div>
                        </td>
                        <td style="text-align:center" data-title="Unit Rental">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                                        <div class="quantity" style="margin:0 auto;">
                                                            <input type="text" tabindex="-1" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                                        </div>
                                                    </td>
                                                    <!--<td class="product-subtotal" style="text-align:center" data-title="VAT">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{(item.mvat) | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-subtotal" style="text-align:center" data-title="Total">
                                                        <span class="woocommerce-Price-amount amount">
                                                            <span class="price-color-gold">
                                                                <!--<span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity+(item.mvat) | number:2}}</span>-->
                                                                <span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}
                                                            </span>
                                                            <br />
                                                            <!--<span class="pm" style="font-size:10px;margin-bottom:0px;">+VAT</span><br/>-->
                                                            <span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span>
                                                            <br />
                                                            <label ng-show="item.minstallationflag=='yes'" class="installtext" style="">Installation included</label>
                                                        </span>
                                                    </td>
                                                    <td class="product-name" style="text-align:center;word-wrap: break-word;white-space:normal;width:250px;position:relative;" data-title="Product">
                                                        <input type="checkbox" ng-if="item.maddressflag!=1" class="{{item.msubquoteid}}check" ng-checked="item.maddressflag!=1" ng-click="AddAddress(item,item.maddressflag)"> <span ng-if="item.maddressflag!=1">As Above</span>
                                                        <div ng-if="item.maddressflag==1" style="">
                                                            <button type="button" class="close mdclose" style="border:0px!important;font-size:12px;color:#c80606;" ng-click="RemoveAddress(item)">Remove</button>
                                                            <div ng-bind-html="item.AddressDetail"></div>
                                                        </div>
                                                    </td>
                                                </tr>


                                            </tbody>

                                        </table>

                                    </div>
                                </div>
                                <div class="row mt-3 mb-3 ml-3 mr-3" style="width:98%;margin-top:10px;">
                                    <div class="col-md-12">
                                        <div class="woocommerce-notices-wrapper">
                                            <p class="mb-0 text-danger" style="font-size:12px;">*All prices are excl. of VAT</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3 mb-3 ml-3 mr-3" ng-show="inactiveproduct.length>0" style="width:98%;margin-top:10px;">
                                    <div class="col-md-12">
                                        <div class="woocommerce-notices-wrapper">
                                            <div class="alert alert-danger">
                                                Sorry! some of your products in basket are not active now. So, please go back to basket and select new products
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mt-2 mb-5 ml-3 mr-3" style="width:98%;margin-top:10px;" ng-show="leaseTerms.Products.length>0">

                                    <div class="col-md-2" style="margin-left:0px;margin-right:0px;">
                                        <a href="/Leasing/ViewCart" style="margin-right:5px;" class="btn btn-warning">Back to Basket</a>

                                    </div>
                                    <div class="col-md-10 pull-right text-right">
                                        <button type="button" ng-click="ContinueToPayment()" style="margin-right:5px;" class="btn btn-primary">Continue</button>

                                    </div>
                                </div>
                            </div>


                            <!---------------------------Order Finish---------------------->
                            <!--------------------------Payment Mode Start-------------------->

                            <div ng-show="showbankpage" class="border box-shadow-1 pt-2 mb-10">
                                <div class="row box-shadow-1 ml-3 mr-3 p-2">
                                    <div class="col-lg-12">
                                        <div class="woocommerce-notices-wrapper">
                                            <h3 class="text-center" style="color:#333;font-weight:600">{{pagetitle}}</h3>
                                            <h3 class="quoteh6 text-center" style="font-weight:600;padding-bottom:0px;font-size:0.9rem">
                                                PLEASE NOTE: Your first payment will NOT be due or taken until the equipment has been delivered/installed
                                            </h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="row box-shadow-1 m-3 p-2">
                                    <div class="col-lg-6">
                                        <label style="color:#333"><strong>Contact Person:</strong></label>
                                        <div style="color:#655e5e">
                                            <table class="table table-borderless table-dark cptable">
                                                <tr>
                                                    <td><strong>Name : </strong></td>
                                                    <td>{{singlecontact.cusername}}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Position : </strong></td>
                                                    <td>{{singlecontact.cposition}}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Phone : </strong></td>
                                                    <td>{{singlecontact.cphone}}</td>
                                                </tr>
                                                <tr>
                                                    <td><strong>Email : </strong></td>
                                                    <td>{{singlecontact.cemailaddress}}</td>
                                                </tr>
                                            </table>

                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <label style="color:#333"><strong>Delivery Address:</strong></label>
                                        <div style="color:#333" ng-bind-html="defaultaddress"></div>
                                    </div>
                                </div>

                                <!-----SPLIT Start Here-->
                                <div class="row box-shadow-1 m-3 p-2" style="margin-top:0px!important;" ng-if="leaseTerms.Split==1" ng-repeat="(key,value) in filtered = (leaseTerms.Products )  | groupBy:'[mtermf,mtermp,mleadtime]'">
                                    <div class="col-lg-12" style="border-bottom: 1px solid #ddd;border-bottom: 1px solid #ddd;background: #ddd;padding-top: 7px;">
                                        <div class="col-lg-6">
                                            <h6 style="color:#333"><span>Lease term: <strong>{{value[0].mtermp/12}} years, {{getTermDataOnly(key)}}</strong>.</span></h6>
                                        </div>
                                        <div class="col-lg-6">
                                            <h6 style="color:#333;text-align:right;"><span>Total Rental = <strong>£{{getVolumeSum(value)}} {{ getNewTerms(value[$index].mtermf,value[$index].mtermp) }}</strong></span> <span ng-if="value[$index].mleadtime>leadtime">(LeadTime : {{value[$index].mleadtime}} days)</span></h6>
                                        </div>


                                    </div>
                                    <div class="col-lg-12">
                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                            <thead>
                                                <tr>
                                                    <th class="product-remove">&nbsp;</th>
                                                    <th class="product-thumbnail">&nbsp;</th>
                                                    <th style="width:350px;" class="product-name">Product Details</th>
                                                    <!--<th style="text-align:center" class="product-name">Term</th>
                        <th style="text-align:center" class="product-name">Unit Rental</th>-->
                                                    <th style="text-align:center" class="product-quantity">Qty</th>
                                                    <!--<th style="text-align:center" class="product-subtotal">VAT</th>-->
                                                    <th style="text-align:center" class="product-subtotal">Total</th>
                                                    <th style="width:150px;text-align:center;" class="product-name">Delivery Address</th>


                                                </tr>

                                            </thead>
                                            <tbody ng-repeat="item in value">
                                                <tr class="woocommerce-cart-form__cart-item cart_item border-0">
                                                    <td class="product-remove">
                                                        <a style="cursor:pointer;" ng-click="deleteFromCart(item.msubquoteid,$index)" class="remove" aria-label="Remove this item" data-product_id="2623" data-product_sku="5487FB8/08"><i class="fa fa-trash"></i></a>
                                                    </td>
                                                    <td class="product-thumbnail">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" width="300" height="300">
                                                        </a>
                                                    </td>

                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            {{item.mproductname}}
                                                        </a>
                                                        <span style="font-size: 0.675em;" ng-if="item.warrantydetails!=null"><br />With Extended {{item.warrantydetails.mprodname}}</span>
                                                        <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br />Manufacturer: {{item.suppliername}}</span>
                                                        <span style="font-size: 0.675em;color:#06429c;" ng-if="item.suppliername!=null && item.mleadtime>=0 && item.mleadtime<=21"><br />Estimated Delivery: {{item.Product.mleadtime}} days</span>
                                                        <span style="font-size: 0.675em;color:#c80606;" ng-if="item.suppliername!=null && item.mleadtime>=21"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                        <div class="offer" style='margin-top:8px; margin-bottom:0px;background:#5cb85c;color: #fff !important;font-weight: 700;padding:5px;' ng-show="item.mofferdetail!=null && item.mofferdetail!='' && item.mofferapplied">
                                                            <span class="loop-product-categories dealdetail ng-cloak" ng-show="item.mofferapplied">Applied: {{item.mofferdetail}}</span>
                                                        </div>

                                                    </td>
                                                    <!--<td class="product-name" align="center" style="width:200px;" data-title="Term">
                            <div class="terms">
                                <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                            </div>
                        </td>
                        <td style="text-align:center" data-title="Unit Rental">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style=""><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                                        <div class="quantity" style="margin:0 auto;">
                                                            <input type="text" tabindex="-1" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                                        </div>
                                                    </td>
                                                    <!--<td class="product-subtotal" style="text-align:center" data-title="VAT">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{(item.mvat) | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-subtotal" style="text-align:center" data-title="Total">
                                                        <span class="woocommerce-Price-amount amount">
                                                            <span class="price-color-gold">
                                                                <!--<span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity+(item.mvat) | number:2}}</span>-->
                                                                <span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}
                                                            </span>
                                                            <br />
                                                            <!--<span class="pm" style="font-size:10px;margin-bottom:0px;">+VAT</span><br />-->
                                                            <span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span>
                                                            <br />
                                                            <label ng-show="item.minstallationflag=='yes'" class="installtext" style="">Installation included</label>
                                                        </span>
                                                    </td>
                                                    <td class="product-name" style="text-align:center;word-wrap: break-word;white-space:normal;width:250px;position:relative;" data-title="Product">
                                                        <input type="checkbox" ng-if="item.maddressflag!=1" ng-disabled="item.maddressflag!=1" ng-checked="item.maddressflag!=1" ng-click="AddAddress(item,item.maddressflag)"> <span ng-if="item.maddressflag!=1">As Above</span>
                                                        <div ng-if="item.maddressflag==1" style="">
                                                            <div ng-bind-html="item.AddressDetail"></div>
                                                        </div>
                                                    </td>
                                                </tr>


                                            </tbody>
                                            <tfoot class="footertds" style="background: #f7db4f;">
                                                <tr>
                                                    <td colspan="3" class="p-2" align="right" style="color: #333;">Add your purchase order number:</td>
                                                    <td colspan="4" class="p-2" ng-init="ItemM[$index].items=value;morderref[$index].emptyref=false;">
                                                        <input type="text" ng-model="ItemM[$index].items" style="display:none;" />
                                                        <input type="text" class="form-control poinput ref{{$index}}" style="border: 1px solid #360874;" id="sref" ng-model="morderref[$index].morderref" />
                                                        <div class="invalid-feedback" ng-show="morderref[$index].emptyref">please enter your purchase order number</div>
                                                    </td>
                                                    <td></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                    </div>
                                </div>
                                <!-----SPLIT END Here-->
                                <div class="row box-shadow-1 m-3 p-2" style="margin-top:0px!important;" ng-if="leaseTerms.Split==0" ng-repeat="(key,value) in filtered = (leaseTerms.Products)  | groupBy:'[mtermf,mtermp]'">

                                    <div class="col-lg-12" style="border-bottom: 1px solid #ddd;border-bottom: 1px solid #ddd;background: #ddd;padding-top: 7px;">
                                        <div class="col-lg-6">
                                            <h6 style="color:#333"><span>Lease term: <strong>{{value[0].mtermp/12}} years, {{getTermDataOnly(key)}}</strong>.</span></h6>
                                        </div>
                                        <div class="col-lg-6">
                                            <h6 style="color:#333;text-align:right;"><span>Total Rental = <strong>£{{getVolumeSum(value)}} {{ getNewTerms(value[$index].mtermf,value[$index].mtermp) }}</strong></span> </h6>
                                        </div>
                                        <!--<h6 style="color:#333"><strong>No. - {{$index+1}}</strong> ({{getTermData(key)}} total = £{{getVolumeSum(value)}})</h6>-->


                                    </div>

                                    <div class="col-lg-12">
                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                            <thead>
                                                <tr>
                                                    <th class="product-remove">&nbsp;</th>
                                                    <th class="product-thumbnail">&nbsp;</th>
                                                    <th style="width:350px;" class="product-name">Product Details</th>
                                                    <!--<th style="text-align:center" class="product-name">Term</th>
                        <th style="text-align:center" class="product-name">Unit Rental</th>-->
                                                    <th style="text-align:center" class="product-quantity">Qty</th>
                                                    <!--<th style="text-align:center" class="product-subtotal">VAT</th>-->
                                                    <th style="text-align:center" class="product-subtotal">Total</th>
                                                    <th style="width:150px;text-align:center;" class="product-name">Delivery Address</th>


                                                </tr>

                                            </thead>
                                            <tbody ng-repeat="item in value" class="mb-5">
                                                <tr class="woocommerce-cart-form__cart-item cart_item">
                                                    <td class="product-remove">
                                                        <a style="cursor:pointer;" ng-click="deleteFromCart(item.msubquoteid)" class="remove" aria-label="Remove this item" data-product_id="2623" data-product_sku="5487FB8/08"><i class="fa fa-trash"></i></a>
                                                    </td>
                                                    <td class="product-thumbnail">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" width="300" height="300">
                                                        </a>
                                                    </td>

                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                        <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                            {{item.mproductname}}
                                                        </a>
                                                        <span style="font-size: 0.675em;" ng-if="item.warrantydetails!=null"><br />With Extended {{item.warrantydetails.mprodname}}</span>
                                                        <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br />Manufacturer: {{item.suppliername}}</span>
                                                        <span style="font-size: 0.675em;color:#06429c;" ng-if="item.suppliername!=null && item.mleadtime>=0 && item.mleadtime<=21"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                        <span style="font-size: 0.675em;color:#c80606;" ng-if="item.suppliername!=null && item.mleadtime>21"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                        <div class="offer" style='margin-top:8px; margin-bottom:0px;background:#5cb85c;color: #fff !important;font-weight: 700;padding:5px;' ng-show="item.mofferdetail!=null && item.mofferdetail!='' && item.mofferapplied">
                                                            <span class="loop-product-categories dealdetail ng-cloak" ng-show="item.mofferapplied">Applied: {{item.mofferdetail}}</span>
                                                        </div>

                                                    </td>




                                                    <!--<td class="product-name" align="center" style="width:200px;" data-title="Term">

                            <div class="terms">
                                <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                            </div>
                        </td>
                        <td style="text-align:center" data-title="Unit Rental">
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                                        <div class="quantity" style="margin:0 auto;">
                                                            <input type="text" tabindex="-1" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                                        </div>
                                                    </td>
                                                    <!--<td class="product-subtotal" style="text-align:center" data-title="VAT" >
                            <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{(item.mvat) | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                        </td>-->
                                                    <td class="product-subtotal" style="text-align:center" data-title="Total">
                                                        <span class="woocommerce-Price-amount amount">
                                                            <span class="price-color-gold">
                                                                <!--<span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity+(item.mvat) | number:2}}</span>-->

                                                                <span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}
                                                            </span>
                                                            <br />
                                                            <!--<span class="pm" style="font-size:10px;margin-bottom:0px;">+VAT</span><br />-->
                                                            <span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span>
                                                            <br />
                                                            <label ng-show="item.minstallationflag=='yes'" class="installtext" style="">Installation included</label>
                                                        </span>
                                                    </td>
                                                    <td class="product-name" style="text-align:center;word-wrap: break-word;white-space:normal;width:250px;position:relative;" data-title="Product">
                                                        <input type="checkbox" ng-if="item.maddressflag!=1" ng-disabled="item.maddressflag!=1" ng-checked="item.maddressflag!=1" ng-click="AddAddress(item,item.maddressflag)"> <span ng-if="item.maddressflag!=1">As Above</span>
                                                        <div ng-if="item.maddressflag==1" style="">
                                                            <div ng-bind-html="item.AddressDetail"></div>
                                                        </div>
                                                    </td>
                                                </tr>


                                            </tbody>
                                            <tfoot class="footertds" style="background: #f7db4f;">
                                                <tr>
                                                    <td colspan="4" align="right" style="color: #333;">Add your purchase order number:</td>
                                                    <td colspan="4" ng-init="ItemM[$index].items=value;morderref[$index].emptyref=false;">
                                                        <input type="text" style="display:none;" ng-model="ItemM[$index].items" />
                                                        <input type="text" class="form-control poinput ref{{$index}}" style="border: 1px solid #360874;" id="sref" ng-model="morderref[$index].morderref" />
                                                        <div class="invalid-feedback" ng-show="morderref[$index].emptyref">please enter your purchase order number</div>
                                                    </td>
                                                    <td></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                    </div>
                                </div>

                                <div class="row" style="width:100%;margin-top:10px;">
                                    <div class="col-lg-12">
                                        <div class="invalid-feedback" ng-show="mainemptyref">Please fill all your po no</div>
                                    </div>
                                </div>

                                <div class="row m-2">
                                    <div class="col-md-12">
                                        <div class="js-form-message" style="background:#360874;color:#fff;padding:10px;margin-bottom:20px;border-radius:6.1875rem;">

                                            <label class="radio-inline" ng-init="payment=leaseTerms.Products[0].mflexible">
                                                How do you want to pay?
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" ng-model="payment" ng-value="1" ng-click="changefield('1')" ng-required="!payment" name="optradio"> On Invoice?
                                            </label>
                                            <label class="radio-inline">
                                                or
                                            </label>
                                            <label class="radio-inline">
                                                <input type="radio" ng-model="payment" ng-value="2" ng-click="changefield('2')" ng-required="!payment" name="optradio"> Direct Debit?
                                            </label>

                                        </div>

                                    </div>

                                </div>
                                <div class="row box-shadow-1" ng-show="payment=='2' && bankfound" style="margin-left:15px;margin-right:15px;margin-top:10px">
                                    <div class="col-md-12" style="margin-top:10px;">
                                        <div class="title bold"><h6 style="color:#333;width:70%;display:inline">Your Bank Details</h6> <button class="btn btn-link pull-right border-0 btn-remove-bg-hover" style="padding-top:0px!important;cursor:pointer;" ng-click="EditBank()">Change Details</button></div>

                                    </div>
                                    <div class="col-md-12">
                                        <table class="table bnktable">
                                            <tbody>
                                                <tr>
                                                    <td style="color:#333;width:200px;">Bank Name</td>
                                                    <td><label class="form-label">{{bank.mbankname}}</label></td>
                                                    <td style="color:#333;width:200px;">Account No.</td>
                                                    <td><label class="form-label">{{bank.mbankaccount}}</label></td>
                                                </tr>
                                                <tr>
                                                    <td style="color:#333;width:200px;">Bank Sort Code</td>
                                                    <td><label class="form-label">{{bank.mbankshort}}</label></td>
                                                    <td style="color:#333;width:200px;">Account Holder</td>
                                                    <td><label class="form-label">{{bank.maccountholder}}</label></td>
                                                </tr>

                                            </tbody>
                                        </table>


                                    </div>

                                </div>
                                <div class="row box-shadow-1" ng-show="payment=='2' && !bankfound" style="margin-left:15px;margin-right:15px;margin-top:10px">
                                    <form id="form" name="bankform" ng-submit="bankupdate()">
                                        <div class="col-md-12" style="margin-top:10px;">
                                            <div class="title bold"><h6 style="color:#333;">Your Bank Details </h6></div>

                                        </div>
                                        <div class="col-md-12" style="margin-top:10px;">
                                            <hr />

                                        </div>
                                        <div class="col-md-6">
                                            <!-- Input -->
                                            <div class="js-form-message mb-6">
                                                <label class="form-label">
                                                    Bank Name
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" maxlength="100" class="form-control" ng-model="bank.mbankname" name="mbankname" placeholder="Bank Name" required="" data-msg="Please enter your bank name." data-error-class="u-has-error" data-success-class="u-has-success">
                                                <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankname.$touched) && form.mbankname.$error.required">Enter detail</div>
                                            </div>
                                            <!-- End Input -->
                                        </div>
                                        <div class="col-md-6">
                                            <!-- Input -->
                                            <div class="js-form-message mb-6">
                                                <label class="form-label">
                                                    Account Number
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" maxlength="8" ng-maxlength="8" ng-minlength="8" class="form-control" ng-model="bank.mbankaccount" name="mbankaccount" placeholder="Account Name" required="">
                                                <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankaccount.$touched) && form.mbankaccount.$error.required">Enter detail</div>
                                                <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankaccount.$touched) && (form.mbankaccount.$error.maxlength || form.mbankaccount.$error.minlength)">Invalid Account No</div>
                                            </div>
                                            <!-- End Input -->
                                        </div>
                                        <div class="col-md-6">
                                            <!-- Input -->
                                            <div class="js-form-message mb-6">
                                                <label class="form-label">
                                                    Bank Sort Code
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" maxlength="8" ng-maxlength="8" ng-minlength="1" class="form-control" ng-model="bank.mbankshort"  ng-change="adddash()" name="mbankshort" placeholder="Name" required="">
                                                <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankshort.$touched) && form.mbankshort.$error.required">Enter detail</div>
                                            </div>
                                            <!-- End Input -->
                                        </div>
                                        <div class="col-md-6">
                                            <!-- Input -->
                                            <div class="js-form-message mb-6">
                                                <label class="form-label">
                                                    Account Name
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <input type="text" maxlength="100" class="form-control" ng-model="bank.maccountholder" name="maccountholder" placeholder="Account Holder" required="" data-success-class="u-has-success">
                                                <div class="invalid-feedback" ng-show="(form.$submitted || form.maccountholder.$touched) && form.maccountholder.$error.required">Enter detail</div>
                                                
                                                
                                                
                                            </div>
                                            <!-- End Input -->
                                        </div>

                                        <div class="col-md-12">

                                            <button type="button" class="btn btn-warning pull-right" ng-click="CancelBank()">Cancel</button>
                                            <button type="submit" class="btn btn-primary pull-right" ng-disabled="bankform.$invalid">Save Details</button>
                                        </div>
                                    </form>

                                </div>
                                <div class="row mt-3 mb-3 ml-3 mr-3" style="width:98%;margin-top:10px;">
                                    <div class="col-md-12">
                                        <div class="woocommerce-notices-wrapper">
                                            <p class="mb-0 text-danger" style="font-size:12px;">*All prices are excl. of VAT</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2 mb-5 ml-3 mr-3" style="width:98%;margin-top:10px;">
                                    <div class="col-md-2 col-md-6" style="margin-left:0px;margin-right:0px;">
                                        <a href="/Leasing/ViewCart" style="margin-right:5px;" class="btn btn-warning">Back to Basket</a>

                                    </div>
                                    <div class="col-md-6 pull-right text-right">
                                        <button type="button" ng-click="BackStep('bankpage')" style="margin-right:5px;" class="btn btn-danger">Back</button>
                                        <button type="button" ng-disabled="(payment=='2' && !bankfound) || payment=='' || payment==0 || payment==null" ng-click="ContinueToAgreement()" style="margin-right:5px;" class="btn btn-primary ">Continue</button>


                                    </div>
                                </div>


                            </div>
                            <!--------------------------Payment Mode End-------------------->
                            <!-------------------Agreement Start---------------------------->
                            <iframe id="printf" name="printf" style="display:none;width:800px;top:10px;left:20px;right:20px;"></iframe>
                            <div ng-show="showagreements" class="border box-shadow-1 pt-5 mb-10">
                                <div class="row box-shadow-1 ml-3 mr-3 p-2">
                                    <div class="col-lg-12">
                                        <div class="woocommerce-notices-wrapper">
                                            <h3 class="text-center" style="color:#333;font-weight:600">{{pagetitle}}</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="row box-shadow-1" style="margin-left:15px;margin-right:15px;margin-top:10px">
                                    <div class="col-lg-12 mt-2">
                                        <div class="alert alert-success text-center pl-2 pr-2" style="font-size:1rem">
                                            <p>You are now at the final stage of electronically generating lease agreements for each of you purchase order/s</p>
                                            <p class="mt-0" style="color:#c80606;">Press "Generate lease agreement" button to generate and digitally sign the lease agreement/s</p><br />
                                            <p>Upon generating electronically duly signed lease agreement, the lessor will be immediately flagged who will in turn process the document. Upon sucessful processing, your order will be delivered to you promptly. A copy of your signed lease agreement shall be held with us at equipyourschool.co.uk and can be viewed and/or printed at any time via "My Account"->"Your lease orders"</p>
                                            <!--<p ng-bind-html="bootdetailmsg"></p>-->
                                        </div>
                                    </div>
                                    <div class="col-xs-12 mb-5 mt-3 nomobilepadding">
                                        <div class="woocommerce agreementdatatable" ng-show="multipledatas.length>0">

                                            <div class="row box-shadow-1 m-3 p-2" ng-repeat="values in (multipledatas)">
                                                <div class="col-lg-12" style="border-bottom: 1px solid #ddd;">
                                                    <table class="table table-borderless agreementordertable">
                                                        <thead>
                                                            <tr>
                                                                <td style="border-top:0px;">
                                                                    <!--<h6 style="color:#333">Order No: - {{$index+1}},<strong> {{values.Product[0].mtermp/12}} years, total {{getNewTerms(values.Product[0].mtermf)}} of £{{values.mquotetotal}} (inc VAT) </strong> <span ng-if="values.Product[0].mleadtime>leadtime">(LeadTime : {{values.Product[0].mleadtime}} days)</span></h6>-->
                                                                    <h6 style="color:#333">Lease term: <strong>{{values.Product[0].mtermp/12}} years, {{getOnlyTerms(values.Product[0].mtermf,"")}}.</strong> </h6>
                                                                    <!--<strong>No. - {{$index+1}}</strong> ({{getTerms(values.Product[0].mtermf,values.Product[0].mtermp)}} total = £{{values.mquotetotal}})-->
                                                                </td>

                                                                <td style="border-top:0px;">Total rental = <strong>£{{values.mquotetotal | number:2}} {{ getNewTerms(values.Product[0].mtermf,values.Product[0].mtermp) }}</strong> <span ng-if="values.Product[0].mleadtime>leadtime">(LeadTime : {{values.Product[0].mleadtime}} days)</span></td>
                                                                <td style="border-top:0px;vertical-align:middle;" rowspan="2" align="center"><button type="button" ng-click="SaveAndPrintAgreement(values,true,$index)" class="btn btn-primary"><i class="fa fa-print"></i> Generate lease agreement</button></td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <span style="color:#4940b4;font-size:14px;">Payment Method :-</span> {{values.mpayment==2?'Direct Debit':'On Invoice'}}
                                                                </td>
                                                                <td ng-if="values.msorderref!=null && values.msorderref!=''">
                                                                    <span style="color:#4940b4;font-size:14px;">Your PO No :-</span> {{values.msorderref}}
                                                                </td>
                                                                <td ng-if="values.msorderref==null && values.msorderref==''">
                                                                    &nbsp;
                                                                </td>
                                                            </tr>

                                                        </thead>
                                                    </table>


                                                </div>
                                                <div class="col-lg-12">
                                                    <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0" style="margin-bottom:0px;">
                                                        <thead>
                                                            <tr>
                                                                <!--<th class="product-remove">&nbsp;</th>-->
                                                                <th class="product-thumbnail">&nbsp;</th>
                                                                <th style="width:350px;" class="product-name">Product Details</th>
                                                                <!--<th style="text-align:center" class="product-name">Term</th>
                                                                <th style="text-align:center" class="product-name">Unit Rental</th>-->
                                                                <th style="text-align:center" class="product-quantity">Qty</th>
                                                                <!--<th style="text-align:center" class="product-subtotal">VAT</th>-->
                                                                <th style="text-align:center" class="product-subtotal">Total</th>
                                                                <th style="width:150px;text-align:center;" class="product-name">Delivery Address</th>


                                                            </tr>

                                                        </thead>
                                                        <tbody ng-repeat="item in values.Product">
                                                            <tr class="woocommerce-cart-form__cart-item cart_item border-0">
                                                                <!--<td class="product-remove">
                                                                    <a style="cursor:pointer;" ng-click="deleteFromCart(item.msubquoteid,$index)" class="remove" aria-label="Remove this item" data-product_id="2623" data-product_sku="5487FB8/08"><i class="fa fa-trash"></i></a>
                                                                </td>-->
                                                                <td class="product-thumbnail">
                                                                    <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                                        <img ng-src="/LeaseAdmin/Content/images/product/{{item.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" width="300" height="300">
                                                                    </a>
                                                                </td>

                                                                <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                                    <a href="/Leasing/ProductDetail?{{item.mproducturl}}" target="_blank">
                                                                        {{item.mproductname}}
                                                                    </a>
                                                                    <span style="font-size: 0.675em;" ng-if="item.warrantydetails!=null"><br />With Extended {{item.warrantydetails.mprodname}}</span>
                                                                    <span style="font-size: 0.675em;" ng-if="item.suppliername!=null"><br />Manufacturer: {{item.suppliername}}</span>
                                                                    <span style="font-size: 0.675em;color:#06429c;" ng-if="item.suppliername!=null && item.mleadtime>=0 && item.mleadtime<=leadtime"><br />Estimated Delivery: {{item.Product.mleadtime}} days</span>
                                                                    <span style="font-size: 0.675em;color:#c80606;" ng-if="item.suppliername!=null && item.mleadtime>leadtime"><br />Estimated Delivery: {{item.mleadtime}} days</span>
                                                                    <div class="offer" style='margin-top:8px; margin-bottom:0px;background:#5cb85c;color: #fff !important;font-weight: 700;padding:5px;' ng-show="item.mofferdetail!=null && item.mofferdetail!='' && item.mofferapplied">
                                                                        <span class="loop-product-categories dealdetail ng-cloak" ng-show="item.mofferapplied" style="">Applied: {{item.mofferdetail}}</span>
                                                                    </div>

                                                                </td>
                                                                <!--<td class="product-name" align="center" style="width:200px;" data-title="Term">
                                                                    <div class="terms">
                                                                        <span class="woocommerce-Price-amount amount">{{ getTerms(item.mtermf,item.mtermp) }}</span>
                                                                    </div>
                                                                </td>
                                                                <td style="text-align:center" data-title="Unit Rental">
                                                                    <span class="woocommerce-Price-amount amount"><span class="price-color-gold" style=""><span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                                                                </td>-->
                                                                <td class="product-quantity" data-title="Quantity" style="text-align:center">
                                                                    <div class="quantity" style="margin:0 auto;">
                                                                        <input type="text" tabindex="-1" readonly id="quantity_5e0706480ca03" ng-model="noOfItem[$index]" class="input-text qty text" step="1" min="1" max="500" name="cart[8e68c3c7bf14ad0bcaba52babfa470bd][qty]" value="{{item.quantity}}" ng-change="UpdateCart(item,noOfItem[$index],1)" title="Qty" size="4" inputmode="numeric" aria-labelledby="White NX Mini F1  SMART NX quantity" style="width:4em">
                                                                    </div>
                                                                </td>
                                                                <!--<td class="product-subtotal" style="text-align:center" data-title="VAT" >
                                                                    <span class="woocommerce-Price-amount amount"><span class="price-color-gold"><span class="woocommerce-Price-currencySymbol">£</span>{{(item.mvat) | number:2}}</span><br /><span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span></span>
                                                                </td>-->
                                                                <td class="product-subtotal" style="text-align:center;padding:12px 4px;" data-title="Total">
                                                                    <span class="woocommerce-Price-amount amount">

                                                                        <span class="price-color-gold">
                                                                            <!--<span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity+(item.mvat) | number:2}}</span>-->
                                                                            <span class="woocommerce-Price-currencySymbol">£</span>{{item.mprice*item.quantity | number:2}}
                                                                        </span>
                                                                        <br />

                                                                        <!--<span class="pm" style="font-size:10px;margin-bottom:0px;">+VAT</span><br />-->
                                                                        <span class="pm" style="font-size:10px">{{ getNewTerms(item.mtermf,item.mtermp) }}</span>
                                                                        <br />
                                                                        <label ng-show="item.minstallationflag=='yes'" class="installtext" style="">Installation included</label>
                                                                    </span>
                                                                </td>
                                                                <td class="product-name" style="text-align:center;word-wrap: break-word;white-space:normal;width:250px;position:relative;" data-title="Product">
                                                                    <div ng-if="item.maddressflag==1" style="">
                                                                        <div ng-bind-html="item.AddressDetail"></div>
                                                                    </div>
                                                                    <div ng-if="item.maddressflag!=1">
                                                                        <div ng-bind-html="defaultaddress"></div>
                                                                    </div>
                                                                </td>
                                                            </tr>


                                                        </tbody>
                                                        <tfoot>

                                                        </tfoot>
                                                    </table>

                                                </div>

                                            </div>


                                            <div class="woocommerce-notices-wrapper">
                                                <p class="mb-0 text-danger" style="font-size:12px;">*All prices are excl. of VAT</p>
                                            </div>



                                        </div>

                                    </div>
                                </div>
                                <div class="row mt-5 mb-5 ml-3 mr-3" style="width:98%;margin-top:10px;display:none;">
                                    <!--<div class="col-md-2 col-md-6" style="margin-left:0px;margin-right:0px;">
        <a href="/Leasing/ViewCart" style="margin-right:5px;" class="btn btn-warning">Back to Basket</a>

    </div>-->
                                    <div class="col-md-6  pull-right text-right">
                                        <!--<button type="button" ng-click="BackStep('printpage',multipledatas.length)" class="btn btn-danger mr-1">Back</button>-->
                                        <!--<button type="button" class="btn btn-primary mr-1" ng-show="multipledatas.length>1" ng-click="PrintAllAgreement()">Print all agreements</button>-->
                                        <!--<button type="button" class="btn btn-primary mr-1" ng-show="multipledatas.length<=1" ng-click="PrintAllAgreement()">Print agreement</button>-->
                                        <!--<button type="button" class="btn btn-warning mr-1" ng-disabled="!singleprint" ng-click="showfinish=true;Finish();">finish</button>-->


                                    </div>
                                </div>

                            </div>
                            <!-------------------Agreement End----------------------------->

                            <div ng-show="showUpload" class="border box-shadow-1 pt-5 mb-10">
                                <div class="row box-shadow-1" style="margin-left:15px;margin-right:15px;margin-top:10px">
                                    <div class="col-lg-12 mt-5">
                                        <div class="alert alert-success">
                                            <p ng-bind-html="bootdetailmsg"></p>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 mb-5">
                                        <div class="woocommerce" ng-show="modalAggreements.length>0">
                                            <div class="woocommerce-notices-wrapper" style="border-bottom:1px solid #a7a7a7;">
                                                <h6 class="quoteh6">* Now you can upload signed document and then send it to lessor. If you donot have facility to upload signed agreement then click finish and please send the original agreement/s duly signed to the lessor by post at address given on the agreement</h6>
                                            </div>
                                            <div class="row woocommerce-cart-form__cart-item cart_item border box-shadow-1 aggreementrow mt-5" style="margin-left:0px;margin-right:0px;" ng-repeat="item in modalAggreements track by $index ">
                                                <div class="col-12" style="padding-right:5px;border-left:0px solid #a7a7a7">
                                                    <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0">
                                                        <thead>
                                                            <tr>

                                                                <th class="product-subtotal" style="text-align:center;">Date</th>
                                                                <th style="width:150px;" class="product-name">Order No</th>
                                                                <th style="width:150px;" class="product-name">PO Number</th>
                                                                <th class="product-name">Lease Term</th>
                                                                <th class="product-subtotal">Items</th>
                                                                <th class="product-subtotal" style="text-align:center;">Total</th>
                                                                <th class="product-subtotal" style="text-align:center;"></th>

                                                            </tr>
                                                        </thead>
                                                        <tbody>

                                                            <tr id="trq{{item.mleaseid}}" ng-init="showOrder[$index]=false">

                                                                <td align="center" class="product-subtotal" style="word-wrap: break-word;white-space:normal;" data-title="Product">{{item.displaydate}}</td>
                                                                <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">{{item.mleaseno}}</td>
                                                                <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">{{item.msorderref}}</td>
                                                                <td>{{getTerms(item.Product[0].mtermf,item.Product[0].mtermp)}}</td>
                                                                <td style="white-space:nowrap" align="center" ng-show="showOrder[$index]==true;">
                                                                    <strong>{{item.Product.length}}</strong><br /><button class="iconbtn iconsmallbtn border-0" style="border-radius:0" ng-click="showOrder[$index]=false;OpenOrder1(item.Product,item.mpayment)"><i class="fa fa-eye"></i></button>
                                                                </td>
                                                                <td style="white-space:nowrap;" align="center" ng-show="showOrder[$index]==false;">
                                                                    <strong>{{item.Product.length}}</strong><br /><button class="iconbtn iconsmallbtn border-0" style="border-radius:0" ng-click="showOrder[$index]=true;OpenOrder1(item.Product,item.mpayment)"><i class="fa fa-eye"></i></button>
                                                                </td>
                                                                <!--<td style="white-space:nowrap"><strong>{{item.Product.length}}</strong><br /><button class="iconbtn iconsmallbtn border-0" style="border-radius:0" ng-click="showOrder[$index]=false;OpenOrder(item)"><i class="fa fa-eye"></i></button></td>-->
                                                                <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">£{{item.total}}<br /> <span class="pm" style="font-size:10px">{{ getNewTerms(item.Product[0].mtermf,item.Product[0].mtermp) }}</span></td>
                                                                <td align="center" data-title="Status" ng-init="uploadstate[$index]=0">
                                                                    <span ng-show="item.mprintby!='' && uploadstate[$index]==1"></span>
                                                                    <button class="btn btn-primary" ng-show="item.mprintby!='' && uploadstate[$index]==0" style="padding:0px;" title="Doc In" ng-click="UploadDoc($event,item.mleaseno,$index)">Upload signed agreement</button>
                                                                </td>


                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="col-lg-12 mt-2" ng-show="showOrder[$index]">

                                                    <!-- Card -->
                                                    <div class="card mb-3 woocommerce-cart-form__cart-item cart_item border box-shadow-1">
                                                        <div class="card-header card-collapse bg-transparent-on-hover border-bottom-dark p-0">
                                                            <div class="col-md-9">
                                                                <h3 style="color:#333;" class="text-left">Order Detail</h3>
                                                            </div>
                                                            <div class="col-md-3 mt-2 mb-1">
                                                                <button class="btn btn-primary" ng-click="printorder(item)">Print Order</button>
                                                            </div>

                                                        </div>

                                                        <div class="card-body pl-0 pb-8 pr-0">
                                                            <div class="row m-0">
                                                                <div class="col-md-12 border-bottom-gray-1">
                                                                    <h6 style="color:#333;" class="text-left">Payment Mode : {{item.mpayment=='2'?'Direct Debit':'On Invoice'}}</h6>

                                                                    <table class="table" ng-show="item.mpayment=='2'">
                                                                        <tbody>
                                                                            <tr>
                                                                                <td style="color:#333;width:200px;">Bank Name</td>
                                                                                <td><label class="form-label">{{bank.mbankname}}</label></td>
                                                                                <td style="color:#333;width:200px;">Account No.</td>
                                                                                <td><label class="form-label">{{bank.mbankaccount}}</label></td>
                                                                            </tr>
                                                                            <tr>
                                                                                <td style="color:#333;width:200px;">Bank Sort Code</td>
                                                                                <td><label class="form-label">{{bank.mbankshort}}</label></td>
                                                                                <td style="color:#333;width:200px;">Account Holder</td>
                                                                                <td><label class="form-label">{{bank.maccountholder}}</label></td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>


                                                                </div>
                                                                <div class="col-md-12">
                                                                    <hr />
                                                                </div>
                                                                <div class="col-md-12">
                                                                    <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents" cellspacing="0">
                                                                        <thead>
                                                                            <tr>
                                                                                <th class="product-thumbnail">&nbsp;</th>
                                                                                <th style="width:150px;" class="product-name">Product Details</th>
                                                                                <th class="product-price">Price</th>
                                                                                <th class="product-quantity">Quantity</th>
                                                                                <th class="product-subtotal">Total</th>
                                                                                <th class="product-notes">Status</th>

                                                                            </tr>

                                                                        </thead>
                                                                        <tbody>

                                                                            <tr ng-repeat="item2 in item.Product |  orderBy:item2.mquotestatus:false track by $index" class="woocommerce-cart-form__cart-item cart_item">

                                                                                <td class="product-thumbnail">
                                                                                    <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">
                                                                                        <img ng-src="/LeaseAdmin/Content/images/product/{{item2.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" style="width:auto;height:50px;" width="300" height="300">
                                                                                    </a>
                                                                                </td>

                                                                                <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                                                    <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">{{item2.mproductname}}</a>
                                                                                </td>
                                                                                <td class="product-price" data-title="Price">
                                                                                    <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice | number:2}}</span>

                                                                                </td>

                                                                                <td class="product-quantity" data-title="Quantity" style="width:50px;">
                                                                                    <div class="quantity" style="margin:0 auto;">
                                                                                        <span class="woocommerce-Price-amount amount">{{item2.quantity}}</span>

                                                                                    </div>
                                                                                </td>

                                                                                <td class="product-subtotal" data-title="Total">
                                                                                    <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice*item2.quantity | number:2}}</span>
                                                                                </td>
                                                                                <td data-title="Notes">
                                                                                    {{item2.mquotestatus=='ldelivered'?'Delivered':''}}
                                                                                </td>

                                                                            </tr>



                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <!-- End Card -->
                                                    <!-- Card -->


                                                </div>
                                            </div>




                                        </div>

                                    </div>

                                </div>



                                <div class="row m-2">
                                    <div class="col-lg-12">
                                        <button type="button" class="btn btn-warning pull-right ml-1" ng-click="showUpload=false;Finish()">Finish</button>


                                    </div>

                                </div>
                            </div>
                            <!----------------------Finish Start--------------------------->
                            <div ng-show="showfinish" class="border box-shadow-1 pt-5 mb-10">
                                <div class="row m-1">
                                    <div class="col-lg-12">
                                        <div class="alert alert-success">
                                            <p ng-bind-html="bootdetailmsg" style="font-size:14px;"></p><br />
                                            Go to your <a href="/MyAccount/Index" class="btn btn-primary"> Your lease order</a>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!----------------------Finish End--------------------------->
                        </div>

                        <iframe id="printf" name="printf" style="display:none;width:800px;top:10px;left:20px;right:20px;"></iframe>
                        <div ng-include id="invoice-box" src="'/templates/printorder.html'" style="display:none;"></div>
                        <div id="orderdata"></div>
                    </div><!-- .entry-content -->

                </article><!-- #post-## -->

            </main><!-- #main -->
        </div>

    </div>


</main>
<!-- ========== END MAIN CONTENT ========== -->
@section scripts{
    <script type="text/javascript">
        app.directive("compareTo", function () {
            return {
                require: "ngModel",
                scope:
                {
                    confirmPassword: "=compareTo"
                },
                link: function (scope, element, attributes, modelVal) {
                    modelVal.$validators.compareTo = function (val) {
                        return val == scope.confirmPassword;
                    };
                    scope.$watch("confirmPassword", function () {
                        modelVal.$validate();
                    });
                }
            };
        });
        app.controller('ConfirmOrderController', ['$scope', '$anchorScroll', '$http', '$rootScope', '$location', '$sce', '$cookies', 'FileUploader','CommonLeaseTerm', function ($scope, $anchorScroll, $http, $rootScope, $location, $sce, $cookies, FileUploader,CommonLeaseTerm) {
            $scope.pagetitle = "Confirm Delivery Details";
            $scope.Quotes = "";
            $scope.QuotesApprove = "";
            $scope.leadtime = 21;
            $scope.ItemM = [];
            $scope.showOrder = true;
            $scope.showbankpage = false;
            $scope.showagreements = false;
            $scope.showUpload = false;
            $scope.showfinish = false;
            $scope.printoption = true;
            $scope.payment = 0;
            $scope.multipledatas = [];
            $scope.UserContacts = [];
            $scope.loader = true;
            $scope.singleprint = false;
            $scope.singlleasenos = [];
            $scope.mcontactid = 0;
            $scope.singlecontact = "";
            $scope.selectedaddressid = 0;
            $scope.defaultaddressid = 0;
            $scope.offerapplied = [];
            $scope.inactiveproduct = [];
            var accountId = "";
            var envelopId = "";
            var documentid = "";
            $rootScope.shoppingCart = $rootScope.shoppingCart || [];
            if ($rootScope.muserid > 0 && $rootScope.savequote == 0) {
                if (!angular.isUndefined($cookies.get('leasebasket'))) {
                    $scope.Session_Id = $cookies.getObject('leasebasket');
                    $rootScope.shoppingCart.totalPrice = 0;
                    $scope.IsLogedIn = true;
                    $http.get('/api/CookieApi/GetCookieCartOrder2?id=' + $scope.Session_Id + '&mschoolid=' + $rootScope.mschoolid).success(function (data) {
                        /*$rootScope.shoppingCart = data;

                        $rootScope.shoppingCart.totalPrice = 0;
                        $rootScope.shoppingCart.totalItems = 0;

                        $scope.getTotalPrice();
                        $scope.getTotalNoOfItems();*/
                        if (data == 0) {
                            window.location = "/Leasing/ViewCart";
                            return false;
                        }
                            for (var i = 0; i < data.data.length; i++) {
                                //$scope.getSubProducts2(data[i]);
                                var termf = ".termf1" + data.data[i].mprodvarid;
                                var termp = ".termp1" + data.data[i].mprodvarid;
                                if (data.data[i].warrantydetails != null) {
                                    data.data[i].warrantydetails.mprice = CommonLeaseTerm.updateTerms(data.data[i].warrantydetails.mprice, data.data[i].mtermf, data.data[i].mtermp);
                                    data.data[i].mprice = Number(data.data[i].mprice) + Number(data.data[i].warrantydetails.mprice);

                                }
                                data.data[i].mvat = data.data[i].mprice * data.data[i].quantity * (data.data[i].mvat / 100);
                                //data[i].mvat = 0;
                                jQuery(termf).val(data.data[i].mtermf);
                                jQuery(termp).val(data.data[i].mtermp);
                                if (data.data[i].moffer > 0) {
                                    if (data.data[i].mofferqty <= data.data[i].quantity) {
                                        data.data[i].mofferdetail = "Buy " + data.data[i].mofferqty + " and " + data.data[i].mofferdetail;
                                        data.data[i].mofferapplied = true;
                                    }
                                    else {
                                        data.data[i].mofferapplied = false;
                                    }
                                } else {
                                    data.data[i].mofferapplied = false;
                                }

                            }
                            $scope.Quotes = data.data;
                            $scope.QuotesApprove = data.data;
                            $scope.inactiveproduct = data.inactiveproduct;
                            console.log("quotes");
                            console.log($scope.Quotes);
                        $scope.SaveAgreement();
                        $scope.payment = data.data[0].mflexible;
                        $http.get("/api/UserApi/GetUserAddress?getid=" + $rootScope.mschoolid).success(function (data2, status) {
                            if (data2 != null) {
                                $scope.defaultaddress = data2.address;
                                $scope.defaultaddressid = data2.id;
                            }
                        });
                        $http.get('/api/UserApi/GetUserContacts?getid=' + $rootScope.mschoolid).success(function (data2) {
                            if (data2 != null) {
                                var fc = false;
                                $scope.UserContacts = data2;
                                if (!angular.isUndefined($cookies.get('contact'))) {
                                    var id = $cookies.getObject('contact');
                                    data2.forEach(function (obj) {
                                        if (obj.Id == id) {
                                            $scope.mcontactid = id;
                                            $scope.singlecontact = obj;
                                            fc = true;
                                        }
                                    })


                                }
                                if (!fc) {
                                    $scope.mcontactid = data2[0].Id;
                                    $scope.singlecontact = data2[0];
                                    var expireDate = new Date();
                                    expireDate.setDate(expireDate.getDate() + 1);
                                    $cookies.putObject('contact', data2[0].Id, { 'expires': expireDate, 'path': '/' });
                                }
                            }
                        });

                        $http.get("/api/LeaseBankApi/GetBankById?muserid=" + $rootScope.mschoolid).success(function (data2, status) {
                            if (data != "empty") {
                                $scope.bank = data2;
                                $scope.bankfound = true;
                            } else {
                                $scope.bankfound = false;
                                $scope.bank = {
                                    "muserid": "",
                                    "mbankname": "",
                                    "mbankaccount": "",
                                    "maccountholder": "",
                                    "mbankshort": "",
                                };
                            }
                            $scope.loader = false;
                        });

                    });


                }
                else {
                    window.location = "../Leasing/";

                }
            }
            else {
                window.location = "../Leasing/";

            }
            $scope.adddash = function (eval) {
                console.log($scope.bank.mbankshort);
                let ele = $scope.bank.mbankshort;
                ele = ele.split('-').join('');    // Remove dash (-) if mistakenly entered.
                let finalVal = ele.match(/.{1,2}/g).join('-');
                $scope.bank.mbankshort = finalVal;
                
            }
            $scope.getTotalPrice = function () {
                $rootScope.shoppingCart.forEach(function (itemObj) {
                    $rootScope.shoppingCart.totalPrice = Number($rootScope.shoppingCart.totalPrice) + $scope.getItemPrice(itemObj);
                });
            };

            $scope.getTotalNoOfItems = function () {
                console.info("Shopping Cart", $rootScope.shoppingCart.length);
                $rootScope.shoppingCart.forEach(function (itemObj) {
                    $rootScope.shoppingCart.totalItems += $scope.getItemNo(itemObj);
                });
            };
            $scope.getItemPrice = function (itemObj) {
                var itemPrice = 0;
                console.log("items");
                itemPrice = (Number(itemObj.Product.mprice) * Number(itemObj.Quantity)).toFixed(2);
                return Number(itemPrice);
            };

            $scope.getItemNo = function (itemObj) {
                return itemObj.Quantity;
            };
            $scope.$watch('shoppingCart', function () {
                $rootScope.shoppingCart.totalPrice = 0;
                $rootScope.shoppingCart.totalItems = 0;
                if ($rootScope.shoppingCart.length > 0) {
                    $scope.getTotalPrice();
                    $scope.getTotalNoOfItems();

                }
                console.log('changed');
            }, true);
            $scope.GetDetail = function (id) {

                $scope.UserContacts.forEach(function (elem) {
                    if (elem.Id == id) {
                        $scope.singlecontact = elem;
                        $cookies.remove('contact');
                        var expireDate = new Date();
                        expireDate.setDate(expireDate.getDate() + 1);
                        $cookies.putObject('contact', id, { 'expires': expireDate, 'path': '/' });
                    }

                });

            }
            $scope.splitevent = "";
            $scope.SaveAgreement = function () {
                var trhtml = "";
                var showwarn = false;
                //jQuery("#leaseterm-dialog tbody").html(trhtml);
                var items = $scope.Quotes;
                $scope.splititem = [];
                if (items.length > 1) {
                    var oldleadtime = $scope.leadtime;
                    items.forEach(function (obj) {

                        if (obj.mleadtime > oldleadtime) {
                            $scope.splititem.push(obj);
                            showwarn = true;
                        }
                    });

                }
                if (showwarn && $scope.splitevent=="") {
                    $scope.leaseTerms1 = {
                        title: "Approval Required!",

                        message: "The following products have a current lead time of over " + $scope.leadtime + " days therefore they will appear on a separate Agreement to prevent delays with the other item(s) on your order",
                        message2: "Do you want to split it?",
                        moreoption: "",
                        oproduct: "",
                        buttons: [{
                            label: "Yes, Split order",
                            action: "MakeSplit",
                            item: items,
                            qty: "",
                            event: 1
                        },
                        {
                            label: "No, not to split",
                            action: "MakeSplit",
                            item: items,
                            qty: "",
                            event: 0
                        },
                        ]

                    };
                    jQuery("#leaseterm1-dialog .modal").modal('show');

                }
                else {
                    if ($scope.splitevent == "1") {
                        $scope.MakeSplit(items, '', 1);
                    } else {
                        $scope.MakeSplit(items, '', 0);
                    }

                }
                //toastr.success("Address updated successfully", "Success");
            };
            $scope.MakeSplit = function (index, quotestatus, flag) {
                $scope.splitevent = flag;
                jQuery("#leaseterm1-dialog .modal").modal('hide');
                $scope.itemsmodels = {};
                $scope.morderref = {};
                $scope.leaseTerms = {
                    title: "By confirming your order, you are booking the following stock items ready for delivery upon lease activation.",
                    Products: index,
                    Split: flag,
                    buttons: [{
                        label: "Yes",
                        action: "SaveOrder",
                        item: $scope.Quotes,
                        qty: 1,
                        event: 0,
                    }]

                };
                console.log("LeaseTerms");
                console.log($scope.leaseTerms);
            }
            $scope.mquotetotal = 0;
            $scope.ContinueToPayment = function () {


                $http.get("/api/LeaseBankApi/GetBankById?muserid=" + $rootScope.mschoolid).success(function (data, status) {
                    if (data != "empty") {
                        $scope.bank = data;
                        $scope.bankfound = true;
                    } else {
                        $scope.bankfound = false;
                        $scope.bank = {
                            "muserid": "",
                            "mbankname": "",
                            "mbankaccount": "",
                            "maccountholder": "",
                            "mbankshort": "",
                        };
                    }
                    jQuery("#order").addClass("complete");
                    jQuery("#payment1").addClass("active");
                    $scope.pagetitle = "Confirm Payment Method";

                    $scope.showOrder = false;
                    $scope.showbankpage = true;

                    jQuery(window).scrollTop(0);
                    $scope.tabloading = false;
                });
            }
            $scope.ContinueToAgreement = function () {
                $scope.multipledatas = [];
                var f = true;
                var r = "";
                console.log($scope.ItemM);
                if ($scope.ItemM.length > 0) {
                    var i = 0;
                    $scope.ItemM.forEach(function (obj) {
                        $scope.mquotetotal = 0;
                        $scope.mquotetotalwvat=0;
                        obj.items.forEach(function (obj2) {

                            if ($scope.morderref[i].morderref == "" || $scope.morderref[i].morderref == undefined) {
                                $scope.morderref[i].emptyref = true;
                                f = false;
                                r = ".ref" + i;
                                console.log(r);
                                jQuery(r).focus();

                                //return;
                                
                            }
                            else {
                                $scope.morderref[i].emptyref = false;
                            }
                            //$scope.mquotetotal = $scope.mquotetotal + Number((obj2.mprice * obj2.quantity+obj2.mvat).toFixed(2));
                            $scope.mquotetotal = $scope.mquotetotal + Number((obj2.mprice * obj2.quantity).toFixed(2));
                            $scope.mquotetotalwvat = $scope.mquotetotalwvat + Number((obj2.mprice * obj2.quantity).toFixed(2));

                        });
                        if (!f) {
                            return false;
                        }
                        var datas = {
                            "mleaseno":0,
                            "Product": obj.items,
                            "msorderref": $scope.morderref[i].morderref,
                            "mschoolid": $rootScope.mschoolid,
                            "mquotetotal": $scope.mquotetotal,
                            "mquotetotalwvat":$scope.mquotetotalwvat,
                            "mpayment": $scope.payment,
                            "muserid": $rootScope.muserid,
                            "mcontactid": $scope.mcontactid,
                            "mdefaultadd":$scope.defaultaddressid,
                        };

                        $scope.multipledatas.push(datas);

                        i++;
                    });

                }
                if (!f) {
                    jQuery(window).scrollTop(jQuery(r).offset().top-150);
                    return false;
                }
                console.log($scope.multipledatas);

                $scope.tabloading = true;
                $scope.singlleasenos = [];
                $http.post("/api/ProductApi/SaveAllOrderFromCart", $scope.multipledatas).success(function (data, status) {
                    jQuery.unblockUI();

                    if (data !== "failed") {
                        $scope.singlleasenos = data;
                        console.log($scope.singlleasenos);
                        var i = 0;
                        $scope.multipledatas.forEach(function (obj) {
                            obj.mleaseno = $scope.singlleasenos[i];
                            i++;
                        });
                        $scope.IsChecked = false;
                        $scope.IsClicked = false;
                        $scope.leaseselected = [];
                        $scope.itemsmodels = {};
                        $scope.morderref = {};
                        /*var mleaseids = {
                            muserid: $rootScope.mschoolid,
                            mleasenos: data,

                        }*/
                        $scope.mleaseall = data;
                        if (data == "empty") {
                            $scope.modalAggreements = [];

                        }
                        if (data.length <= 0) {
                            $scope.modalAggreements = [];
                        }
                        else {

                            $scope.modalAggreements = data;
                            var d = [];
                            $scope.modalAggreements.forEach(function (o) {
                                d.push(o.mleaseno);
                            });
                            $scope.mleaseall = d;
                        }
                        $scope.bootdetailmsg = "Thank you for your order. Your order will now be processed and delivered to you in due course.  Please print copy of the agreement/s you have signed pertaining to the order/s to complete the process. You can also print the agreement/s in My account -> Your lease orders.";
                        jQuery("#payment1").addClass("complete");
                        jQuery("#print").addClass("active");
                        $scope.pagetitle = "Generate lease Agreement";
                        //$rootScope.shoppingCart = [];
                        $scope.Quotes = [];
                        $cookies.remove("leasebasket", { path: '/' });
                        $cookies.remove("same");

                        $scope.showbankpage = false;
                        $scope.showagreements = true;
                        
                        jQuery(window).scrollTop(0);
                        $scope.tabloading = false;

                        //$("input[name='mleaseids']").val(JSON.stringify(data));
                        /*$http.post('/api/AggreementApi/GetListAggreementById/', mleaseids).success(function (data2) {

                            if (data2 == "empty") {
                                $scope.modalAggreements = [];

                            }
                            if (data2.length <= 0) {
                                $scope.modalAggreements = [];
                            }
                            else {

                                $scope.modalAggreements = data2;

                            }
                            $scope.bootdetailmsg = "Thank you for confirming order.Now, You can print agreements.<br/> You can also print your agreement in My account > Your lease order";
                            jQuery("#order").addClass("complete");
                            jQuery("#payment1").addClass("active");
                            $scope.tabloading = false;
                            $rootScope.shoppingCart = [];
                            $scope.Quotes = [];
                            $cookies.remove("leasebasket", { path: '/' });
                            $cookies.remove("same");
                            $scope.pagetitle = "Print Agreement";
                            jQuery(window).scrollTop(0);
                            $scope.showOrder = false;
                            $scope.showbankpage = false;
                            $scope.showagreements = true;




                        });*/
                    }
                    else {
                        toastr.warning("Something went wrong", "Warning!!");
                        $scope.tabloading = false;
                    }
                });
                
                //$scope.bootdetailmsg = "Thank you for confirming your payment detail and your delivery detail. Now print your agreement by pressing  'Print all agreement' button .<br/> You can also print your agreement in My account > Your lease order";
                //$scope.bootdetailmsg = "Thank you for your order. Now print your agreement/s and post original/s to lessor duty signed at the address printed on the page after your agreement/s. Your order/s will thereafter be processed and delivered to you in due course.<br/> You can also print your agreement in My account > Your lease order";
                
            }
            $scope.changefield = function (option) {
                $scope.payment = option;
            }

            $scope.SaveOrder = function () {
                $scope.multipledatas = [];
                var f = true;

                if ($scope.ItemM.length > 0) {
                    var i = 0;
                    $scope.ItemM.forEach(function (obj) {
                        if ($scope.morderref[i].morderref == "" || $scope.morderref[i].morderref == undefined) {
                            $scope.morderref[i].emptyref = true;
                            f = false;
                            return false;
                        }
                        else {
                            $scope.morderref[i].emptyref = false;
                        }
                        obj.items.forEach(function (obj2) {
                            if (obj2.warrantydetails != null) {
                                obj2.warrantydetails.mprice = CommonLeaseTerm.updateTerms(obj2.warrantydetails.mprice, obj2.mtermf, obj2.mtermp);
                            }
                            $scope.mquotetotal = $scope.mquotetotal + Number((obj2.mprice * obj2.quantity).toFixed(2));


                        });
                        var datas = {
                            "Product": obj.items,
                            "msorderref": $scope.morderref[i].morderref,
                            "muserid": $rootScope.mschoolid,
                            "mquotetotal": $scope.mquotetotal,
                            "mpayment": $scope.payment,
                            "mdefaultadd":$scope.defaultaddressid,
                        };
                        $scope.multipledatas.push(datas);

                        i++;
                    });

                }
                if (!f) {
                    return false;
                }
                $scope.tabloading = true;
                /*$scope.multipledatas.forEach(function (o) {
                    o.mpayment = $scope.payment;
                });*/
                console.log($scope.multipledatas);
                return false;
                $http.post("/api/ProductApi/SaveOrderFromCart", $scope.multipledatas).success(function (data, status) {
                    if (data !== "failed") {
                        $scope.IsChecked = false;
                        $scope.IsClicked = false;
                        $scope.leaseselected = [];
                        $scope.itemsmodels = {};
                        $scope.morderref = {};
                        /*var mleaseids = {
                            muserid: $rootScope.mschoolid,
                            mleasenos: data,

                        }*/
                        $scope.mleaseall = data;
                        if (data == "empty") {
                            $scope.modalAggreements = [];

                        }
                        if (data.length <= 0) {
                            $scope.modalAggreements = [];
                        }
                        else {

                            $scope.modalAggreements = data;
                            var d = [];
                            $scope.modalAggreements.forEach(function (o) {
                                d.push(o.mleaseno);
                            });
                            $scope.mleaseall = d;
                        }
                        $scope.bootdetailmsg = "Thank you for confirming your order. Now print your agreement by pressing  'Print all agreement' button .<br/> You can also print your agreement in My account > Your lease order";
                        jQuery("#order").addClass("complete");
                        jQuery("#payment1").addClass("active");
                        $scope.tabloading = false;
                        $rootScope.shoppingCart = [];
                        $scope.Quotes = [];
                        $cookies.remove("leasebasket", { path: '/' });
                        $cookies.remove("same");
                        $scope.pagetitle = "Print Agreement";
                        jQuery(window).scrollTop(0);
                        $scope.showOrder = false;
                        $scope.showbankpage = false;
                        $scope.showagreements = true;

                        //$("input[name='mleaseids']").val(JSON.stringify(data));
                        /*$http.post('/api/AggreementApi/GetListAggreementById/', mleaseids).success(function (data2) {

                            if (data2 == "empty") {
                                $scope.modalAggreements = [];

                            }
                            if (data2.length <= 0) {
                                $scope.modalAggreements = [];
                            }
                            else {

                                $scope.modalAggreements = data2;

                            }
                            $scope.bootdetailmsg = "Thank you for confirming order.Now, You can print agreements.<br/> You can also print your agreement in My account > Your lease order";
                            jQuery("#order").addClass("complete");
                            jQuery("#payment1").addClass("active");
                            $scope.tabloading = false;
                            $rootScope.shoppingCart = [];
                            $scope.Quotes = [];
                            $cookies.remove("leasebasket", { path: '/' });
                            $cookies.remove("same");
                            $scope.pagetitle = "Print Agreement";
                            jQuery(window).scrollTop(0);
                            $scope.showOrder = false;
                            $scope.showbankpage = false;
                            $scope.showagreements = true;




                        });*/
                    }
                    else {
                        toastr.warning("Something went wrong", "Warning!!");
                        $scope.tabloading = false;
                    }
                });
            };
            $scope.CancelBank = function () {
                $scope.bankfound = true;
            }
            $scope.EditBank = function () {
                //alert("true");
                $scope.bankfound = false;
            };
            $scope.ChangeState = function (o) {
                if (o == 'payment1') {
                    $scope.bootdetailmsg = "You can also upload your agreement in My account > Your lease order";
                    jQuery("#payment1").addClass("active complete");
                }
            }
            /*************Address Code*************************/
            $scope.changeAddress = function (option) {
                $scope.selectedaddressid = option;
            }
            $scope.alladdress = [];
            $scope.setItem = "";
            $scope.showAddresses = function (item) {
                var label = "Save and Close";
                var action = "SetDefaultAddress";
                $scope.setItem = "";
                $scope.selectedaddressid = $scope.defaultaddressid;
                if (item != null) {
                    label = "Set Address";
                    action = "SetAddress";
                    $scope.setItem = item;
                    $scope.selectedaddressid = item.Address;
                }
                $http.get("/api/UserApi/GetUserAddresses?getid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.alladdress = data2;
                    }
                    else {
                        $scope.alladdress = [];
                    }
                });
                $scope.leaseaddress = {
                    maddressflag: 0,
                    buttons: [{
                        label: label,
                        action: action,
                        item: $scope.alladdress,
                        qty: 1,
                        event: 0,
                        singleitem:item
                    }]
                };
                jQuery("#alladress-dialog .modal").modal('show');


            }

            $scope.SetDefaultAddress = function (item) {
                var maddresses = $scope.alladdress.filter(function (obj) {
                    console.log(obj.museraddrid + " " + $scope.selectedaddressid);
                    return obj.museraddrid == $scope.selectedaddressid;

                });

                var addr = "";
                maddresses.forEach(function (maddress) {
                    addr = maddress.maddress1;
                    if (maddress.maddress2 != null) {
                        addr = addr + "<br/>" + maddress.maddress2;
                    }
                    if (maddress.mlandmark != null) {
                        addr = addr + "<br/>" + maddress.mlandmark;

                    }
                    addr = addr + "<br/>" + maddress.mcity + (maddress.mpostcode != null ? " - " + maddress.mpostcode : "");
                    $scope.defaultaddress = addr;
                });
                $scope.defaultaddressid = $scope.selectedaddressid;
                jQuery("#alladress-dialog .modal").modal('hide');
            };
            $scope.User = {
                muid: '',
                maddress1: '',
                maddress2: '',
                mcity: '',
                mcountry: '',
                mlandmark: '',
                maddresstype: '',
                mpostcode: ''
            };
            $scope.AddNewAddress = function () {
                $http.get("/api/AccountApi/GetCountries").success(function (data, status) {

                    if (data == "empty") {
                        $rootScope.countries = [];

                    }
                    else {
                        $scope.countries = data;
                        $scope.getStates($scope.countries[229]);
                    }


                });
                jQuery("#alladress-dialog .modal").modal('hide');
                jQuery("#addnewaddress-dialog .modal").modal('show');
                jQuery("#addnewaddress-dialog").addClass("modal-open")

            }
            $scope.submitText = "Save";
            $scope.SaveData = function (isValid) {
                if ($scope.submitText == 'Save') {
                    $scope.rsubmitted = true;
                    $scope.message = '';
                    $scope.User.muid = $rootScope.mschoolid;
                    if (isValid) {
                        $scope.submitText = 'Please Wait...';
                        //$scope.User = data;
                        $http({

                            method: "POST",

                            url: "/User/SaveUserAddress",

                            data: $scope.User
                        }).success(function (data) {
                            if (data["msg"] == "Success") {
                                $scope.Message = "Address save successfully";
                                toastr.success($scope.Message, "Success");
                                jQuery("#addnewaddress-dialog .modal").modal('hide');
                                jQuery("#alladress-dialog").addClass("modal-open")
                                if ($scope.setItem != "") {
                                    $scope.showAddresses($scope.setItem);
                                }
                                else {
                                    $scope.showAddresses();
                                }

                                //$scope.SaveCart();
                            }
                            else {
                                $scope.IsError = true;
                                alert('Invalid Credential!');
                            }

                            $scope.user = null;

                        }).error(function () {

                            alert('failed');

                        })

                    }
                    else {
                        jQuery('input.ng-invalid').first().focus();
                        $scope.message = 'Please fill required fields value';
                        $scope.rsubmitted = false;
                    }
                }
            }
            $scope.addressess = [];
            $scope.allAddress = [];
            $scope.getaddbtntxt = "Find the address";
            $scope.getaddressdisable = false;
            $scope.getAddress = function (postcode) {
                var apikey = "gpVL4Uf-OECpRvzOjZnKWA33077";
                $scope.getaddressdisable = true;
                $scope.getaddbtntxt = "Loading..";
                $http.get("https://api.getaddress.io/find/" + postcode + "?api-key=" + apikey + "&expand=true&sort=true").success(function (data, status) {
                    if (data != null) {
                        $scope.User.mpostcode = data["postcode"];
                        $scope.allAddress = data["addresses"];
                        var i = 0;
                        $scope.allAddress.forEach(function (obj) {
                            var newobj = {
                                Code: i,
                                Name: jQuery.grep(obj.formatted_address, Boolean).join(", ")
                            };
                            $scope.addressess.push(newobj);
                            i++;
                        })

                    }
                    else {
                        $scope.getaddbtntxt = "Find the address";
                        $scope.getaddressdisable = false;
                    }
                    $scope.getaddbtntxt = "Find the address";
                    $scope.getaddressdisable = false;


                });
            }
            $scope.getSelectedAddress = function (id) {

                console.log(id.Code);
                var d = $scope.allAddress[id.Code];
                $scope.User.maddress1 = d["line_1"];
                $scope.User.maddress2 = d["line_2"];
                $scope.User.mcity = d["town_or_city"];

            }
            $scope.getStates = function (countryid) {
                $scope.User.mcountry = countryid.Code;
                $http.get("/api/AccountApi/GetStates?cnid=" + countryid.Code).success(function (data, status) {

                    if (data == "empty") {
                        $rootScope.states = [];

                    }
                    else {
                        $scope.states = data;
                    }


                }).error(function () {

                    alert('failed');

                });
            }
            $scope.AddAddress = function (item, s) {
                $scope.selectedaddressid = item.Address;
                if (s != 1) {

                    $scope.leaseaddress = {
                        maddressflag: item.maddressflag,
                        buttons: [{
                            label: "SetAddress",
                            action: "SetAddress",
                            item: item,
                            qty: item.msubquoteid,
                            event: 0,
                        }]
                    };
                    //jQuery("#alternative_address").val(item.Address);
                    //jQuery("#leaseaddress-dialog .modal").modal('show');
                    $scope.showAddresses(item);
                    jQuery("#alladress-dialog .modal").modal('show');
                }
                else {
                    item.maddressflag = 0;
                }
            }
            $scope.UpdateAddress = function (item, s) {
                var address = jQuery("#alternative_address").val();
                address = address.replace(/\n/g, '<br>\n');
                var data = {
                    "id": item.msubquoteid,
                    "address": address
                };
                $http.post('/api/CookieApi/UpdateCartAddress', data).success(function (data) {
                    item.Address = address;
                    item.maddressflag = 1;

                });
                //jQuery("#alternative_address").val('');
                jQuery("#leaseaddress-dialog .modal").modal('hide');

            }
            $scope.SetAddress = function (a, b, c, item) {
                console.log(item);
                if ($scope.defaultaddressid == $scope.selectedaddressid) {
                    var cs = "." + item.msubquoteid + "check";
                    jQuery(cs).prop('checked', true);
                }else{
                var address = $scope.selectedaddressid;

                //address = address.replace(/\n/g, '<br>\n');
                var data = {
                    "id": item.msubquoteid,
                    "address": address
                };
                $http.post('/api/CookieApi/UpdateCartAddress', data).success(function (data) {
                    var maddresses = $scope.alladdress.filter(function (obj) {
                        console.log(obj.museraddrid + " " + $scope.selectedaddressid);
                        return obj.museraddrid == $scope.selectedaddressid;

                    });

                    var addr = "";
                    maddresses.forEach(function (maddress) {
                        addr = maddress.maddress1;
                        if (maddress.maddress2 != null) {
                            addr = addr + "<br/>" + maddress.maddress2;
                        }
                        if (maddress.mlandmark != null) {
                            addr = addr + "<br/>" + maddress.mlandmark;

                        }
                        addr = addr + "<br/>" + maddress.mcity + (maddress.mpostcode != null ? " - " + maddress.mpostcode : "");
                        item.AddressDetail = addr;
                    })
                    item.Address = $scope.selectedaddressid;
                    item.maddressflag = 1;

                });
                }
                //jQuery("#alternative_address").val('');
                jQuery("#alladress-dialog .modal").modal('hide');

            }
            $scope.RemoveAddress = function (item) {
                $http.get('/api/CookieApi/RemoveCartAddress?id=' + item.msubquoteid).success(function (data) {
                    item.Address = "";
                    item.maddressflag = 0;

                });


            }
            $scope.DefaultCheck = function (item) {
                console.log(item);
                if (item.Address == "" || item.Address == null) {
                    var cs = "." + item.msubquoteid + "check";
                    jQuery(cs).prop('checked', true);

                }
                else {

                }

            }
            $scope.clearaddress = function () {
                jQuery("#alternative_address").val('');


            }
            $scope.bankupdate = function () {
                $scope.bank.muserid = $rootScope.mschoolid;
                $http({

                    method: "POST",

                    url: "/api/LeaseBankApi/BankUpdate",

                    data: $scope.bank
                }).success(function (data) {
                    if (data == "success") {
                        toastr.success("detail updated successfully", "Success");
                        $scope.bankfound = true;
                    }
                    else {
                        toastr.success("something went wrong!", "Warning");
                        $scope.bankfound = false;
                    }
                });
            };
            $scope.printorder = function (index) {
                $scope.tabloading = true;
                $scope.print = index;
                setTimeout(function () {
                    var data = jQuery("#invoice-box").html();
                    f
                    console.log(data);
                    if (data != "empty") {
                        var DocumentContainer = jQuery("#invoice-box").html();
                        var height = jQuery("#invoice-box").height();
                        var html = '<html><head>' +
                                       '</head><body style="background:#ffffff;">' +
                                       jQuery("#invoice-box").html() +
                                       '</body></html>';
                        var myFrame = jQuery("#printf").contents().find('body');
                        var textareaValue = data;
                        myFrame.html(textareaValue);
                        window.frames["printf"].focus();
                        window.frames["printf"].print();
                    }

                }, 100);
                $scope.tabloading = false;


            };
            var pdf, page_section, HTML_Width, HTML_Height, top_left_margin, PDF_Width, PDF_Height, canvas_image_width, canvas_image_height, Total_height = 0;
            function calculatePDF_height_width(selector, index) {
                page_section = jQuery(selector).eq(index);
                HTML_Width = page_section.width();
                HTML_Height = page_section.height();
                top_left_margin = 15;
                PDF_Width = HTML_Width + (top_left_margin * 2);
                PDF_Height = (PDF_Width * 1.2) + (top_left_margin * 2);
                canvas_image_width = HTML_Width;
                canvas_image_height = HTML_Height;
                Total_height = Total_height + HTML_Height;
            }

            $scope.SaveAndPrintAgreement = function (singleorder, flag,$index) {
                $scope.tabloading = true;
                $scope.printoption = flag;
                jQuery.blockUI();
                $scope.newsinglleasenos = [];
                $scope.bootmsg = "Please wait. Your Lease Agreement is being generated";
                $scope.bootdetailmsg = "Please print,  sign and send  the agreement/s in the said file to the lessor at address given on the agreement/s";
                //$scope.showmodel = true;
                $scope.hideclose = false;
                /*jQuery("#msgModal").modal({
                    backdrop: 'static',
                    show: true,
                    keyboard: false
                });*/
                $scope.newsinglleasenos.push($scope.singlleasenos[$index]);
                /*$http.post("/api/ProductApi/SaveSingleOrderFromCart", singleorder).success(function (data2, status) {
                    jQuery.unblockUI();

                    if (data2 != "failed") {
                        $scope.singlleasenos.push(data2);
                      */
                //$scope.remainids = $scope.singlleasenos;
                        $http({
                            method: "POST",
                            url: "/Order/LoadOrders/",
                            data: { "mleaseids": $scope.newsinglleasenos, "remainids": $scope.singlleasenos }
                        }).success(function (data) {
                            if (data["url"] != "" && data["url"] != null) {
                                $scope.singlleasenos.splice($index, 1);

                                var DocumentContainer = data;
                                jQuery("#msgModal").modal("hide");
                                //var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                                var blobURL = data["url"];
                                //iframe.src = blobURL;
                                accountId = data["accountId"];
                                envelopId = data["envelopid"];
                                documentid = data["mleaseid"];
                                var iframe = document.getElementById('printf3');
                                iframe.src = "";
                                iframe.src = blobURL + "#zoom=100";
                                window.addEventListener("message", sendMessage, false);
                                iframe.onload = function () {
                                    window.addEventListener("message", sendMessage, false);
                                }
                                //jQuery("#agreementmodal .modal-body").html(data);
                                jQuery("#agreementmodal2 .modal").modal({
                                    "show": true
                                }).on("hidden.bs.modal", function () {
                                    var iframe = document.getElementById('printf3');
                                    iframe.src = "";
                                    $scope.$apply(function () {
                                        jQuery.unblockUI();
                                        $scope.tabloading = false;
                                        $scope.loader = false;
                                        $scope.multipledatas.splice($index, 1);
                                        $scope.ItemM.splice($index, 1);
                                        $scope.singlleasenos.splice($index, 1);
                                        console.log($scope.multipledatas);
                                        if ($scope.multipledatas.length <= 0) {
                                            $rootScope.shoppingCart = [];
                                            $scope.Quotes = [];
                                            $cookies.remove("leasebasket", { path: '/' });
                                            $cookies.remove("same");
                                            $scope.showfinish = true;
                                            //$scope.ContinueToUpload();
                                            $scope.Finish();
                                        } else {
                                            var i = 0;
                                            $scope.Quotes = [];
                                            $scope.QuotesApprove = [];
                                            var data55 = [];
                                            $scope.multipledatas.forEach(function (obj) {
                                                $scope.mquotetotal = 0;
                                                $scope.mquotetotalwvat = 0;
                                                data55.push(obj.Product[0]);
                                                //$scope.morderref[i].morderref = obj.msorderref;
                                                //$scope.payment = obj.payment;
                                                i++;
                                            });
                                            $scope.Quotes = data55;
                                            $scope.QuotesApprove = data55;
                                        }
                                    })

                                    $scope.singleprint = true;
                                    $scope.tabloading = false;
                                    jQuery("#agreementmodal2 .modal").off("hidden.bs.modal");
                                });
                            
                            } else {
                                if (data["message"] != "" && data["message"] != null) {
                                    alert(data["message"]);
                                } else {
                                    alert("Something went wrong!Please try again.");
                                }
                                jQuery("#msgModal").modal("hide");
                                $scope.tabloading = false;
                                $scope.loader = false;
                                jQuery.unblockUI();
                            }

                        })
                    //}
                //});


            };
            function sendMessage(e) {
                //jQuery("#agreementmodal2 .modal").modal('hide');
                console.log(e);
                //var iframe = document.getElementById('printf3');
                //iframe.src = "";
                //alert("Signed Done");
                //if (event.origin != "http://localhost:15000") {
                    if (event.data == "Envelope sent") {
                        alert("Done");
                    }
                    if (envelopId != null && envelopId != "") {
                        $http({
                            method: "POST",
                            url: "/Order/LoadDocument/",
                            data: { "accountId": accountId, "envelopId": envelopId, documentid: documentid }
                        }).success(function (data) {
                            if (data != "") {
                                var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                                var iframe = document.getElementById('printf3');
                                iframe.src = blobURL + "#zoom=100";
                                envelopId = "";
                            }

                        });

                    }
                //}
                
                
            }
            $scope.ContinueToUpload = function () {
                $scope.tabloading = true;
                var mleaseids = {
                    muserid: $rootScope.mschoolid,
                    mleasenos: $scope.singlleasenos,

                }
                $http.post("/api/AggreementApi/GetListAggreementById", mleaseids).success(function (data, status) {
                    if (data == "empty") {
                        $scope.modalAggreements = [];

                    }
                    if (data.length <= 0) {
                        $scope.modalAggreements = [];
                    }
                    else {

                        $scope.modalAggreements = data;
                        jQuery("#print").addClass("complete");
                        jQuery("#agreement").addClass("active");
                        $scope.pagetitle = "Upload Agreement";
                        $scope.showagreements = false;

                        $scope.modalAggreements.forEach(function (o) {
                            o.mprintby = $rootScope.muserid;
                        })
                        $scope.showUpload = true;
                        jQuery(window).scrollTop(0);
                        $scope.tabloading = false;

                    }

                });
            }
            $scope.getLeasePdf = function (mleaseid, flag) {
                $scope.tabloading = true;
                $scope.printoption = flag;

                $http.post("/api/AggreementApi/updateLastPrint?mleaseid=" + mleaseid + "&muserid=" + $rootScope.muserid).success(function (data, status) {
                    $http({
                        method: "POST",
                        url: "/Order/LoadOrder/",
                        data: { "mleaseid": mleaseid }
                    }).success(function (data) {
                        jQuery("#agreementmodal .modal-body").html(data);
                        jQuery("#agreementmodal .modal").modal({

                            "show": true
                        });
                        $scope.tabloading = false;
                        $scope.modalAggreements.forEach(function (o) {
                            if (o.mleaseid == mleaseid) {
                                o.mprintby = $rootScope.muserid;
                            }

                        })
                        $scope.singleprint = true;
                        //$scope.setActiveTab(3);
                    });
                });
            };
            function b64toBlob(b64Data, contentType, sliceSize){
                const byteCharacters = atob(b64Data);
                const byteArrays = [];
                sliceSize = 512;
                for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                    const slice = byteCharacters.slice(offset, offset + sliceSize);

                    const byteNumbers = new Array(slice.length);
                    for (let i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }

                    const byteArray = new Uint8Array(byteNumbers);
                    byteArrays.push(byteArray);
                }

                const blob = new Blob(byteArrays, {type: contentType});
                return blob;
            }
            jQuery("#agreementmodal .modal").on("shown.bs.modal", function () {
                jQuery.blockUI();
                jQuery("#agreementmodal .modal-body").block({
                    message: '<h6>Please wait..</h6>'
                    //message: jQuery("#message");
                });

                var iframe = document.getElementById('printf2');
                iframe.src = "";
                var pagecount = jQuery("#pgcount").val();
                if (pagecount > 2) {

                    html2canvas(jQuery(".print-wrap:eq(0)")[0], {
                        imageTimeout: 2000,
                        scale: 2,
                        scrollX: 0,
                        scrollY: -10,
                        removeContainer: true,
                    }).then(function (canvas) {
                        canvas.getContext('2d').scale(2, 2);
                        calculatePDF_height_width(".print-wrap", 0);
                        pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);

                        var imgData = canvas.toDataURL("image/jpeg", 1.0);
                        pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                        html2canvas(jQuery(".print-wrap:eq(1)")[0], {
                            imageTimeout: 2000,
                            scale: 2,
                            scrollX: 0,
                            scrollY: 0,
                            removeContainer: true,
                        }).then(function (canvas) {
                            canvas.getContext('2d').scale(2, 2);
                            calculatePDF_height_width(".print-wrap", 1);

                            var imgData = canvas.toDataURL("image/jpeg", 1.0);
                            pdf.addPage(PDF_Width, PDF_Height);
                            pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                            html2canvas(jQuery(".print-wrap:eq(2)")[0], {
                                imageTimeout: 2000,
                                scale: 2,
                                scrollX: 0,
                                scrollY: 0,
                                removeContainer: true,
                            }).then(function (canvas) {
                                canvas.getContext('2d').scale(2, 2);
                                calculatePDF_height_width(".print-wrap", 1);
                                pdf.addPage(PDF_Width, PDF_Height);

                                calculatePDF_height_width(".print-wrap", 2);

                                var imgData = canvas.toDataURL("image/jpeg", 1.0);
                                pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                                setTimeout(function () {

                                    var blob = pdf.output("blob");

                                    //Getting URL of blob object
                                    var blobURL = URL.createObjectURL(blob);
                                    iframe.src = blobURL;

                                    //var downloadLink = document.getElementById('exportpdfnew');
                                    //downloadLink.href = blobURL;
                                    //Showing PDF generated in iFrame element
                                    let objFra = document.getElementById('printf2');
                                    jQuery("#printf2").css("height", Total_height);
                                    jQuery("#printf2").slideDown();
                                    jQuery("#grid").hide();
                                    jQuery("#agreementmodal .modal-body").unblock();
                                    jQuery("#agreementmodal .modal-body").unblockUI();
                                }, 50);

                            });
                        });

                    });
                } else {
                    html2canvas(jQuery(".print-wrap:eq(0)")[0], {
                        imageTimeout: 2000,
                        scale: 2,
                        scrollX: 0,
                        scrollY: -10,
                        removeContainer: true,
                    }).then(function (canvas) {
                        canvas.getContext('2d').scale(2, 2);
                        calculatePDF_height_width(".print-wrap", 0);
                        pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
                        console.log(canvas);
                        var imgData = canvas.toDataURL("image/jpeg", 1.0);
                        pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                        html2canvas(jQuery(".print-wrap:eq(1)")[0], {
                            imageTimeout: 2000,
                            scale: 2,
                            scrollX: 0,
                            scrollY: 0,
                            removeContainer: true,
                        }).then(function (canvas) {
                            canvas.getContext('2d').scale(2, 2);
                            calculatePDF_height_width(".print-wrap", 1);

                            var imgData = canvas.toDataURL("image/jpeg", 1.0);
                            pdf.addPage(PDF_Width, PDF_Height);
                            pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                            setTimeout(function () {

                                //pdf.autoPrint({ variant: 'non-confirm' });
                                //pdf.output('blob');
                                var blob = pdf.output("blob");

                                //Getting URL of blob object
                                var blobURL = URL.createObjectURL(blob);
                                iframe.src = blobURL;

                                //var downloadLink = document.getElementById('exportpdfnew');
                                //downloadLink.href = blobURL;
                                //Showing PDF generated in iFrame element
                                let objFra = document.getElementById('printf2');
                                jQuery("#printf2").css("height", Total_height);
                                jQuery("#printf2").slideDown();
                                jQuery("#grid").hide();
                                jQuery("#agreementmodal .modal-body").unblock();
                                jQuery("#agreementmodal .modal-body").unblockUI();
                            }, 50);

                        });
                    });
                }
            });
            jQuery('#agreementmodal .modal').on('hidden.bs.modal', function () {
                jQuery("#agreementmodal .modal-body").html('');
                $scope.DocUpload = false;

            });
            $scope.BackStep = function (step,cnt) {
                var msg = "";
                var p = "";

                switch (step) {
                    case 'bankpage':
                        jQuery("#order").removeClass("complete");
                        jQuery("#payment1").removeClass("active");
                        jQuery("#order").addClass("active");
                        $scope.pagetitle = "Confirm Delivery Details";

                        $scope.showOrder = true;
                        $scope.showbankpage = false;

                        jQuery(window).scrollTop(0);
                        break;
                    case 'printpage':
                        jQuery("#cnt").html(cnt);
                        jQuery("#confirmmodal .modal").modal({

                            "show": true
                        }).on("#continue").click(function () {
                            $scope.$apply(function () {
                                $scope.showagreements = false;
                                $scope.showbankpage = true;
                                $scope.pagetitle = "Confirm Payment Method";
                            });

                            jQuery("#confirmmodal .modal").modal('hide');
                            jQuery("#payment1").removeClass("complete");
                            jQuery("#print").removeClass("active");
                            jQuery("#payment1").addClass("active");


                            jQuery(window).scrollTop(0);

                        });
                        break;
                }
            }
            $scope.PrintAllAgreement = function () {
                $scope.tabloading = true;
                jQuery.blockUI();

                //$http.post("api/AggreementApi/updateallLastPrint/", mleaseids).success(function (data, status) {
                $http.post("/api/ProductApi/SaveOrderFromCart", $scope.multipledatas).success(function (data, status) {
                    if (data !== "failed") {
                        $scope.IsChecked = false;
                        $scope.IsClicked = false;
                        $scope.leaseselected = [];  
                        $scope.itemsmodels = {};
                        $scope.morderref = {};
                        /*var mleaseids = {
                            muserid: $rootScope.mschoolid,
                            mleasenos: data,

                        }*/
                        var d = [];
                        $scope.mleaseall = data;
                        if (data == "empty") {
                            $scope.modalAggreements = [];

                        }
                        if (data.length <= 0) {
                            $scope.modalAggreements = [];
                        }
                        else {

                            $scope.modalAggreements = data;

                            $scope.modalAggreements.forEach(function (o) {
                                d.push(o.mleaseno);
                            });
                            $scope.mleaseall = d;
                        }
                        $scope.bootmsg = "Please wait while your Agreement is going to ready for print..";
                        //$scope.bootdetailmsg = "Please print,  sign and send  the agreement/s in the said file to the lessor at address given on the agreement/s";
                        //$scope.showmodel = true;
                        $scope.hideclose = false;
                        jQuery("#msgModal").modal({
                            backdrop: 'static',
                            show: true,
                            keyboard: false
                        });
                        $http({
                            method: "POST",
                            url: "/Order/LoadOrders/",
                            data: { "mleaseids": d }
                        }).success(function (data) {
                            //console.log(data.result);
                            jQuery.unblockUI();

                            //get the file name for download
                            @*if (data.fileName != "") {
                            window.location.href = "@Url.RouteUrl(new
                            { Controller = "Order", Action = "Download"})/?file=" + data.fileName;
                        }*@
                            if (data["url"] != "" && data["url"] != null) {
                                var DocumentContainer = data;
                                jQuery("#msgModal").modal("hide");
                                //var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                                var blobURL = data["url"];
                                //iframe.src = blobURL;
                                accountId = data["accountId"];
                                envelopId = data["envelopid"];
                                documentid = data["mleaseid"];
                                var iframe = document.getElementById('printf3');
                                iframe.src = blobURL + "#zoom=100";
                                window.addEventListener("message", sendMessage, false);
                                iframe.onload = function () {
                                    window.addEventListener("message", sendMessage, false);
                                }
                                //jQuery("#agreementmodal .modal-body").html(data);
                                jQuery("#agreementmodal2 .modal").modal({
                                    "show": true
                                }).on("hide.bs.modal", function () {
                                    $scope.showfinish = true;
                                    $scope.Finish();
                                    jQuery(window).scrollTop(0);
                                    $scope.tabloading = false;

                                });
                                //WindowObject.close();
                            }
                            jQuery("#print").addClass("complete");
                            jQuery("#agreement").addClass("active");
                            $scope.singleprint = true;
                            $scope.pagetitle = "Upload Agreement";
                            $scope.showagreements = false;

                            $scope.modalAggreements.forEach(function (o) {
                                o.mprintby = $rootScope.muserid;
                            })
                            $rootScope.shoppingCart = [];
                            $scope.Quotes = [];
                            $cookies.remove("leasebasket", { path: '/' });
                            $cookies.remove("same");
                            //$scope.bootdetailmsg = "Thank you for order with us. You can now check your agreement status inside Myaccount-> Generated Agreement.";
                            //$scope.showUpload = true;

                        });
                    }
                });
            };
            $scope.agordermsorderref = "";
            $scope.OpenOrder = function (item, msorderref) {
                $scope.agorder = item;
                $scope.agordermsorderref = msorderref;
                jQuery("#agreementorder-dialog .modal").modal('show');
            }
            $scope.Finish = function () {
                $scope.loader = true;
                window.location.href = '/MyAccount/Index';
                jQuery("#agreement").addClass("active");
                jQuery("#agreement").addClass("complete");
                $scope.showUpload = false;

                $scope.pagetitle = "Thank You";
                $scope.bootdetailmsg = "Thank you. You can track your agreement status  Myaccount-> Your lease order.";
                $scope.showfinish = true;
                jQuery(window).scrollTop(0);
                $scope.tabloading = false;
            }
            $scope.deleteFromCart = function (index) {

                $scope.confirmationDialogConfig = {
                    title: "Warning!!!",
                    message: "Are you sure you want to delete?",
                    buttons: [{
                        label: "Delete",
                        action: "delete",
                        step: step,
                        index: index
                    }]
                };
                $scope.showDialog(true);
            };
            $scope.deleteFromCart = function (getid, itemind) {
                var id = $cookies.getObject('leasebasket');
                var idex=0;
                var index = jQuery.map($scope.Quotes, function (n, kin) {
                    if(n.msubquoteid==getid){
                        return kin;
                    }
                });


                //let index = 0;// $scope.Quotes.findIndex(record => record.msubquoteid === getid);
                $http.get('/api/CookieApi/GetCartDelete?id=' + getid).success(function (data) {
                    if (data == "delete") {
                        var i = 0;
                        var k = -1;
                        $scope.ItemM.forEach(function (obj) {
                            var ind = jQuery.map(obj.items, function (n, kin) {
                                if (n.msubquoteid == getid) {
                                    return kin;
                                }
                            });// obj.items.findIndex(record => record.msubquoteid === getid);
                            if (ind >= 0) {
                                obj.items.splice(ind, 1);

                            }
                            if (obj.items.length <= 0) {
                                k = i;
                            }
                            i++;
                        });
                        if (k > -1) {
                            $scope.ItemM.splice(k, 1);

                        }
                        $scope.Quotes.splice(index, 1);
                        $http.get('/api/CookieApi/GetCookieCart?id=' + id).success(function (data2) {
                            if (data2 == "empty") {
                                $scope.loader = true;
                                $cookies.remove("leasebasket", { path: '/' });
                                window.location = "../Leasing/";
                            } else {
                                $rootScope.shoppingCart = data2;

                                $rootScope.shoppingCart.totalPrice = 0;
                                $rootScope.shoppingCart.totalItems = 0;
                                $scope.getTotalPrice();
                                $scope.getTotalNoOfItems();

                            }

                            // $scope.loader = false;
                        });

                        toastr.success("Product remove from Your Basket", "Success");
                    }

                });
            };

            $scope.executeleaseAction = function (action, passdata, step, getid,singleitem) {
                if (typeof $scope[action] === "function") {
                    $scope[action](passdata, step, getid,singleitem);
                }
            };
            $scope.showleaseDialog = function (flag) {
                jQuery("#leaseconfirmation-dialog .modal").modal(flag ? 'show' : 'hide');
            };
            $scope.showDialog = function (flag) {
                jQuery("#confirmation-dialog .modal").modal(flag ? 'show' : 'hide');
            };



            /*********************************Upload DOC************************************/
            $scope.index = -1;
            $scope.UploadDoc = function ($event, mleaseno) {
                $event.stopPropagation();
                $scope.tabloading = true;
                $scope.mleaseno = mleaseno;

                jQuery("#docinmodal").modal({
                    backdrop: 'static',
                    keyboard: false,
                    "show": true
                });
                $scope.tabloading = false;

            }
            $scope.mleaseno = "";
            $scope.leasedocid = "";
            var uploader = $scope.uploader =

                        new FileUploader({
                            //url: window.location.protocol + '//' + window.location.host + window.location.pathname + '/api/Upload/UploadFile'

                            url: '/api/AgreementApi/UploadFile',

                        });


            // }


            // FILTERS
            uploader.filters.push({
                name: 'extensionFilter',
                fn: function (item, options) {
                    var filename = item.name;
                    var extension = filename.substring(filename.lastIndexOf('.') + 1).toLowerCase();
                    if (extension == "jpg" || extension == "png" || extension == "JPG" || extension == "jpeg" || extension == "JPEG" || extension == "pdf")
                        return true;
                    else {
                        toastr.error("Invalid file format. Please select a file with pdf/jpg/JPEG or rtf format  and try again.", "Warning");
                        return false;
                    }
                }
            });

            uploader.filters.push({
                name: 'sizeFilter',
                fn: function (item, options) {
                    var fileSize = item.size;
                    fileSize = parseInt(fileSize) / (1024 * 1024);
                    if (fileSize <= 1)
                        return true;
                    else {
                        toastr.error("Selected file exceeds the MB file size limit. Please choose a new file and try again.", "Warning");
                        return false;
                    }
                }
            });

            uploader.filters.push({
                name: 'itemResetFilter',
                fn: function (item, options) {
                    if (this.queue.length < 5)
                        return true;
                    else {
                        toastr.error("You have exceeded the limit of uploading files.", "Warning");
                        return false;
                    }
                }
            });

            // CALLBACKS

            uploader.onWhenAddingFileFailed = function (item, filter, options) {
                console.info('onWhenAddingFileFailed', item, filter, options);
            };
            uploader.onAfterAddingFile = function (fileItem) {
                //alert('Files ready for upload.');
            };

            uploader.onSuccessItem = function (fileItem, response, status, headers) {
                $scope.uploader.queue = [];
                $scope.uploader.progress = 0;

                console.info('onCompleteItem', response);
                if (response != "empty") {
                    var ordersdata = {
                        "mleaseno": $scope.mleaseno,
                        "mdocname": response,
                        "muserid": $rootScope.muserid,
                    };
                    jQuery.ajax({
                        url: '/api/AgreementApi/SaveDocIn',
                        type: 'POST',
                        data: { "ordersdata": ordersdata },
                        success: function (data) {
                            //$("#docinmodal")
                            if (data == "Success") {
                                toastr.success("Thank you for your delivery review!", "Success");
                                //$scope.setActiveTab(3);
                                jQuery("#docinmodal").modal('hide');

                                $scope.DocUpload = true;
                                jQuery.unblockUI();
                                //$scope.uploadstate[$scope.index] = 1;

                            }
                            else {
                                toastr.error("Please try again", "warning");
                            }
                        }
                    });
                }
                //$scope.userdatas.com_logo = response["data"]["filename"];
                //toastr.success("Selected file has been uploaded successfully.", "Warning");
            };
            jQuery('#docinmodal').on('hidden.bs.modal', function () {
                jQuery("#docinmodal").modal('hide');
                $scope.DocUpload = false;

            });
            uploader.onErrorItem = function (fileItem, response, status, headers) {
                toastr.error("We were unable to upload your file. Please try again.", "Sorry");
            };
            uploader.onCancelItem = function (fileItem, response, status, headers) {
                toastr.success("File uploading has been cancelled.", "Success");
            };

            uploader.onAfterAddingAll = function (addedFileItems) {
                console.info('onAfterAddingAll', addedFileItems);
            };
            uploader.onBeforeUploadItem = function (item) {
                console.info('onBeforeUploadItem', item);
            };
            uploader.onProgressItem = function (fileItem, progress) {
                console.info('onProgressItem', fileItem, progress);
                jQuery.blockUI();
            };
            uploader.onProgressAll = function (progress) {
                console.info('onProgressAll', progress);
            };

            uploader.onCompleteItem = function (fileItem, response, status, headers) {
                console.info('onCompleteItem', fileItem, response, status, headers);
            };
            uploader.onCompleteAll = function () {
                console.info('onCompleteAll');
            };
            $scope.UploadDoc = function ($event, mleaseno, $index) {
                $event.stopPropagation();
                $scope.tabloading = true;
                //mApp.block("#m_blockui_2_portlet");
                $scope.mleaseno = mleaseno;
                $scope.index = $index;
                jQuery("#docinmodal").modal({
                    backdrop: 'static',
                    keyboard: false,
                    "show": true
                });
                $scope.tabloading = false;
                //mApp.unblock("#m_blockui_2_portlet");
            }



            /*************************Term Operations*****************************************/
            $scope.getVolumeSum = function (items) {
                /*return items
                    .map(function (x) { return (x.mprice * x.quantity+x.mvat).toFixed(2); })
                    .reduce(function (a, b) { return (Number(a) + Number(b)).toFixed(2); });*/
                return items
                    .map(function (x) { return (x.mprice * x.quantity).toFixed(2); })
                    .reduce(function (a, b) { return (Number(a) + Number(b)).toFixed(2); });
            };
            $scope.getAnnualMsg = function (key,value) {
                var str = key.split(',');
                if (str[0] != 12) {
                    var saving = 0;
                    var oldvalue = 0;
                    value.forEach(function (obj) {
                        switch (mtermf) {
                            case 1:
                                oldvalue = Number(oldvalue)+(obj.mprice*12);
                                break;
                            case 3:
                                oldvalue = Number(oldvalue) + (obj.mprice * 4);
                                break;
                            case 4:
                                oldvalue = Number(oldvalue) + (obj.mprice * 3);
                                break;
                            case 6:
                                oldvalue = Number(oldvalue) + (obj.mprice * 2);
                                break;
                        }
                        var mbaseprice = (obj.mprice * obj.mtermp * 0.9) / obj.mtermf;
                        saving = ((saving) + Number((mbaseprice * 12) / (obj.mtermp * 0.9))).toFixed(2);


                    })
                    return "If you make payment annually then you can save £"+saving+"per annum";
                }

            };
            $scope.getTermData = function (key) {

                var str = key.split(',');
                var term = $scope.getTerms(Number(str[0]), Number(str[1]));
                return term;
            };
            $scope.getTermDataOnly = function (key) {
                var str = key.split(',');
                var term = $scope.getOnlyTerms(Number(str[0]), Number(str[1]));
                return term;
            };

            $scope.getOnlyTerms = function (mtermf, mtermp) {
                var msg = "";
                var p = "";

                switch (mtermf) {
                    case 1:
                        msg = p + "monthly";
                        break;
                    case 3:
                        msg = p + "quarterly";
                        break;
                    case 4:
                        msg = p + "termly";
                        break;
                    case 6:
                        msg = p + "bi-annually";
                        break;
                    case 12:
                        msg = p + "annually";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getNewTerms = function (mtermf, mtermp) {
                var msg = "";
                var p = "";

                switch (mtermf) {
                    case 1:
                        msg = p + " per month";
                        break;
                    case 3:
                        msg = p + " per quarter";
                        break;
                    case 4:
                        msg = p + " per term";
                        break;
                    case 6:
                        msg = p + " per bi-annual";
                        break;
                    case 12:
                        msg = p + " per annum";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getTerms = function (mtermf, mtermp) {
                var msg = "";
                var p = "";
                if (mtermp != null) {
                    p = mtermp / 12;
                }

                switch (mtermf) {
                    case 1:
                        msg = p + " years monthly";
                        break;
                    case 3:
                        msg = p + " years quarterly";
                        break;
                    case 4:
                        msg = p + " years termly";
                        break;
                    case 6:
                        msg = p + " years bi-annually";
                        break;
                    case 12:
                        msg = p + " years annually";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getPeriodInWords = function (mtermf) {
                switch (mtermf) {
                    case 1:
                        msg = "One";
                        break;
                    case 2:
                        msg = "Four";
                        break;
                    case 3:
                        msg = "Three";
                        break;
                    case 4:
                        msg = "Four";
                        break;
                    case 5:
                        msg = "Five";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
        }]);


    </script>
    <script>
        jQuery(function () {
            jQuery("#loginform1").on("submit", function (event) {
                event.preventDefault();

                var $this = jQuery(this);
                console.log($this.serializeArray());
                var frmValues = $this.serializeArray().filter(function (elem) {
                    return jQuery.trim(elem.value) != "";
                });
                var a = jQuery(this), l = jQuery(this).closest("form");

                jQuery.ajax({
                    type: "post",
                    url: "/User/UserLogin",
                    data: frmValues,
                    beforeSend: function () {
                        // setting a timeout
                        jQuery('html').addClass('m-page--loading');
                        jQuery('.m-blockui #loadtext').html('Please wait..');
                        //$('.m-page-loader.m-page-loader--base').addClass('myclass');
                    }, success: function (data) {

                        if (data["msg"] == "Success") {
                            jQuery('html').addClass('m-page--loading');
                            jQuery('#loadtext').html('Synchronising your account..');
                            //$('.m-page-loader.m-page-loader--base').addClass('myclass');
                            window.location.href = "/Dashboard";
                        } else {
                            jQuery(".loginerror").html("Invalid Username and Password");
                            jQuery(".loginerror").addClass("in");
                        }
                    }
                })

            });

        });
    </script>
}