@{
    ViewBag.Title = "My Account";
    Layout = "~/Views/Shared/_FrontLayout.cshtml";
    //var id = ViewBag.Id;
    var activetab = ViewBag.activetab;
    var ngpattern = @"/^(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z/\d$@$!%*#?&]{8,20}$/";
}

<style>
    #progressbar li{
        font-size:12px;
    }
    .smallprogress #progressbar li{
        width:20%
    }
    #progressbar li::after {
    height:1px;
    }
   .smallprogress #progressbar li::before {
        font-family: FontAwesome;
content: "\f00c";
width: 16px;
height: 15px;
line-height: 13px;
display: inline-block;
float: right;
margin: 10px 0 0px 0;
font-size: 12px;
position: absolute;
bottom: -8px;
right: -2px;
    }
    .approvedtd td {
        background: #ffd89c;
        border: 1px solid #bba7a7;
    }

    .lapprovedtd td {
        background: #d4edda;
        border: 1px solid #bba7a7;
    }

    .lpendingtd td {
        background: #fff3cd;
        border: 1px solid #bba7a7;
    }

    .lrejectedtd td {
        background: #f8d7da;
        border: 1px solid #bba7a7;
    }

    table.cart .actions {
        padding-top: 0 !important;
    }

    .tab-pane {
        padding: 1rem;
    }

    .md-tabs {
        position: relative;
        z-index: 1;
        padding: .7rem;
        margin-right: 1rem;
        margin-bottom: -20px;
        margin-left: 1rem;
        background-color: #fff;
        border: 0;
        border-radius: .25rem;
        -webkit-box-shadow: 0 5px 11px 0 rgba(0,0,0,0.18), 0 4px 15px 0 rgba(0,0,0,0.15);
        box-shadow: 0 5px 11px 0 rgba(0,0,0,0.18), 0 4px 15px 0 rgba(0,0,0,0.15);
    }

    .indigo1 {
        background-color: #3f51b5 !important;
    }

    .md-tabs .nav-link {
        color: #082044;
        border: 0;
        -webkit-transition: all .4s;
        transition: all .4s;
    }

    .nav-tabs .nav-link {
        border: 1px solid transparent;
        border-top-left-radius: .25rem;
        border-top-right-radius: .25rem;
    }

    .nav-link {
        display: block;
        padding: .5rem 1rem;
    }

    .nav-tabs .nav-link:hover, .nav-tabs .nav-link.active:focus, .nav-tabs .nav-link.active:hover {
        border-color: #3f51b5;
    }

    .nav-tabs .nav-item {
        background: rgba(0,0,0,0.05);
        display: block;
        position: relative;
    }

        .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link {
            color: #fff !important;
            background-color: #082044 !important;
            border-color: #e7eaf3 #e7eaf3 #fff;
        }

    .entry-content .card {
        font-weight: 400;
        border: 0;
        -webkit-box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
        box-shadow: 0 2px 5px 0 rgba(0,0,0,0.16), 0 2px 10px 0 rgba(0,0,0,0.12);
    }

    table.cart .actions {
        padding-top: 0 !important;
    }

    .btndropdown .btn, .open > .btn.dropdown-toggle, .open > .button.dropdown-toggle, .open > .dropdown-toggle.hero-action-btn, .open > button.dropdown-toggle {
        background-color: #4d44bd;
        border-color: #4940b4;
        border-radius: 0px;
        color: #fff;
    }


    .btndropdown .dropdown-menu {
        margin-top: 0px;
    }

    .btndropdown .dropdown-item {
        cursor: pointer;
    }

    #datepicker .input-group-addon, #datepicker .input-group-btn {
        width: 9% !important;
        padding: 0.67rem .75rem !important;
    }


    .quoteh6 {
        text-align: left;
        color: #8a0808 !important;
        padding-bottom: 15px;
        font-size: 0.8rem;
    }

    .col-xs-3.quoteh6.border, .col-xs-9.border.quoteh6 {
        padding-top: 15px;
    }

    {
        padding-top: 15px;
    }



    .agreementform {
        color: #333;
    }

    .agreementtable {
        background-color: #082044;
    }

    .panel-group .panel {
        border-radius: 0;
        box-shadow: none;
        border: 1px solid #EEEEEE;
        margin-top: 10px;
    }

    .panel-default > .panel-heading {
        padding: 0;
        border-radius: 0;
        color: #212121;
        /*background-color: #FAFAFA;*/
        /*border-color: #EEEEEE;*/
    }

    .panel-title {
        font-size: 14px;
    }

        .panel-title > a {
            display: block;
            padding: 15px;
            text-decoration: none;
        }

    .more-less {
        float: right;
        color: #212121;
        margin-top: 10px;
        margin-right: 10px;
    }

    .panel-default > .panel-heading + .panel-collapse > .panel-body {
        border-top-color: #EEEEEE;
    }

    .nav-tabs .nav-link .tab-items-count {
        border: 1px solid #fe5300;
        background: #fe5300;
        border-radius: 50%;
        position: absolute;
        top: -8px;
        right: 0px;
        color: #fff;
    }

    .nav-tabs .nav-link.active1 .tab-items-count {
        background: #fff;
        color: #333;
    }



    #agreementmodal p {
        margin-bottom: 0px;
    }

    .price-color-gold {
        color: #000 !important;
    }

    .maintable {
        border-collapse: separate;
        border-spacing: 0 0em;
    }

    .nav-item1 a, li .dropdown-title {
        font-size: 1em;
    }

    .sidebar-navbar.view-all .dropdown-toggle::after {
        content: "\f105";
    }

    .nav-item1 {
        margin: 0px !important;
    }

        .nav-item1.active {
            background: #520fad;
        }

        .nav-item1 a:before {
            content: "\f105";
            font-size: 1.00012rem;
            line-height: 1;
            order: -1;
            margin-left: 0;
            margin-right: .5rem;
            display: inline-block;
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }

        .nav-item1.active a {
            color: #fff;
        }

        .nav-item1:hover {
            background: #7c15be;
            color: #fff;
        }

            .nav-item1:hover a {
                color: #fff;
            }

    .invalid-feedback {
        display: block;
        margin-left: 10px;
        text-align: left;
    }

    #grid table {
        border: inherit;
        color: #333 !important;
    }

        #grid table td, #grid table th {
            border: inherit;
            padding: 0px;
        }

    #grid .table3 td, #grid .table3 th, #grid .border {
        border: 1px solid !important;
    }

    .nodata p {
        font-size: 1.2em;
    }

    #agreementmodal form {
        margin-bottom: 0px !important;
    }

    #generatedAgreementmodal .modal-lg {
        width: 80%;
        max-width: 80%;
    }

    #msgModal:before {
        content: '';
        display: inline-block;
        height: 100%;
        vertical-align: middle;
    }

    #msgModal .modal-dialog {
        display: inline-block;
        vertical-align: middle;
        left: 18%;
    }

    #msgModal .modal-content {
        -webkit-animation-name: modal-animation;
        -webkit-animation-duration: 0.5s;
        animation-name: modal-animation;
        animation-duration: 0.5s;
    }

    @@media(min-width:1100px) {
        #reviewModal .modal-lg {
            width: 600px;
        }

        #agreementmodal .modal-lg {
            width: 90%;
            min-height:700px;
            max-width: 90%;
        }
        
        #leaseterm-dialog .modal-lg {
            width: 70%;
            max-width: 100%;
        }
    }

    .panel-table {
        margin-bottom: 0px;
    }

        .panel-table thead th, .panel-table tbody td {
            border-top: none;
            border-bottom: none;
            color: #333;
            padding: 4px .75rem;
        }

    .aggreementrow table tbody td {
        padding: 4px .75rem !important;
        border-top: 0px !important;
    }

    .aggreementrow .btn {
        padding: 3px 15px !important;
        cursor: pointer !important;
        font-size:12px;
    }

    .profile-tab label {
        font-weight: 600;
        color: #333;
    }
    .profile-tab .unbold{
        font-weight: 500!important;
    }
    .profile-tab .viewprofile label {
        margin-bottom: 1rem;
    }

    .viewprofile .row {
        margin-left: 0px;
        margin-right: 0px;
        margin-top: 5px;
    }

        .viewprofile .row hr {
            margin-top: 0px;
            margin-bottom: 10px;
        }

    .tab-pane.fadein.active {
        min-height: 500px;
    }

    .blockUI.blockMsg.blockElement {
        top: 50px !important;
    }

    /**************New Design****************/
    .fontcolorgrey{
        color:#747474;
    }
    .fontcolorblack{
        color:#363636;
    }
    .quoteprogress{
        display:inline;
    }
    #msform{
        margin-top:10px;
    }
    .progresslabel{
        padding-top:12px;
        margin-bottom:0px;
        padding-right:5px;
        font-size:12px;
    }
    .smallprogress hr{
        margin-top:3px;
        margin-bottom:3px;
    }
    #progressbar li::after {
        z-index:0;
    }
    .smallprogress #progressbar li::before{
        z-index:1;
    }
    table.cart th,table.cart td{
        padding:.1rem .75rem 
    }
    table.cart thead th{
        border-bottom:0px;
        font-size:0.75em;
    }
    table.cart tbody > tr > td{
        vertical-align:top;
        color:#272727;
    }
    .aggreementrow .btn-success:hover{
        background-color: #7c15be !important;
border-color: #7c15be !important;
box-shadow: 0 4px 11px rgba(124, 21, 190, 0.17);
    }
    .aggreementrow .vieworder{
        color:#333!important;
    }
    .aggreementrow .vieworder:hover,.aggreementrow .vieworder:active{
        color:#fff!important;
    }
    .orderd h6{
        font-size:12px;
    }
    .orderd .table1 tr td{
        font-size:12px;
    }
    .orderd .table1 tbody td {
        padding-left:0px!important;
    }
    .orderd .table1{
        margin-bottom:0.3em;
    }
    .orderview hr{
        margin-top:0.3em;
        margin-bottom:0.6em;
    }
    table.cart .product-thumbnail img{
        max-width:inherit;
    }
    .btn-link:hover{
        border:none;
    }
    @@media(max-width:999px){
        .progresslabel{
            display:none!important;
        }
        .actiontd:before{
            display:none;
        }
        
    }
    .lg-15{
        flex:0 0 15%;
        max-width:15%;

    }
    .lg-20{
        flex:0 0 20%;
        max-width:20%;
    }
</style>
<link rel="stylesheet" href="~/Content/bootstrap/datepicker.css" />


<div id="content" class="site-content" tabindex="-1" ng-controller="QuotationController">
    <div class="se-pre-con" ng-show="loader">

    </div>
    <div class="container">
        <div id="addnewaddress-dialog">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title ng-binding">New Address</h4>
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        </div>
                        <form class="rform js-validate" name="form" ng-submit="SaveData(form.$valid)" novalidate>
                            <div class="modal-body">

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="js-form-message mb-2">
                                            <label></label>
                                            <div id="postcode_lookup1" ng-init="postcode='';selectedAddress=''">
                                                <input type="text" id="getaddress_input" placeholder="Enter your Postcode" ng-model="postcode" class="form-control postcode-autocomplete" name="getaddress_input" autocomplete="off">
                                                <button id="getaddress_button" type="button" class="btn btn-primary" ng-click="getAddress(postcode)" ng-disabled="getaddressdisable">{{getaddbtntxt}}</button>


                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-7" ng-show="addressess.length>0">
                                        <div class="js-form-message mb-2">
                                            <select id="getaddress_dropdown" ng-options="address as address.Name for address in addressess track by address.Code" class="form-control js-select selectpicker dropdown-select" ng-model="selectedAddress" ng-change="getSelectedAddress(selectedAddress)" data-msg="Please select country." data-error-class="u-has-error" data-success-class="u-has-success"
                                                    data-live-search="true"
                                                    data-style="form-control border-color-1 font-weight-normal">
                                                <option value="">Select address</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Address line 1
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" id="line1" maxlength="100" class="form-control" ng-model="User.maddress1" name="streetAddress" placeholder="" aria-label="470 Lucy Forks" required="" data-msg="Please enter a valid address." data-error-class="u-has-error" data-success-class="u-has-success">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.streetAddress.$touched) && form.streetAddress.$error.required">Enter Street Address</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>

                                    <div class="col-md-4">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Address line 2
                                            </label>
                                            <input type="text" id="line2" maxlength="100" class="form-control" ng-model="User.maddress2" placeholder="" aria-label="YC7B 3UT" data-msg="Please enter a valid address." data-error-class="u-has-error" data-success-class="u-has-success">

                                        </div>
                                        <!-- End Input -->
                                    </div>

                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                City
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" id="town" maxlength="50" class="form-control" ng-model="User.mcity" name="cityAddress" placeholder="" aria-label="London" required="" data-msg="Please enter a valid address." data-error-class="u-has-error" data-success-class="u-has-success" autocomplete="off">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.cityAddress.$touched) && form.cityAddress.$error.required">Enter City</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>

                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Postcode/Zip
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" maxlength="9" id="postcode" class="form-control" ng-model="User.mpostcode" name="postcode" placeholder="" required="" data-msg="Please enter a postcode or zip code." data-error-class="u-has-error" data-success-class="u-has-success">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.postcode.$touched) && form.postcode.$error.required">Enter Postcode</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Country
                                                <span class="text-danger">*</span>
                                            </label>
                                            <select name="country" ng-init="mcountry = {Code:230}" ng-options="country as country.Name for country in countries track by country.Code" class="form-control js-select selectpicker dropdown-select" ng-model="mcountry" ng-change="getStates(mcountry)" required="" data-msg="Please select country." data-error-class="u-has-error" data-success-class="u-has-success"
                                                    data-live-search="true"
                                                    data-style="form-control border-color-1 font-weight-normal">
                                                <option value="">Select country</option>
                                            </select>
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.country.$touched) && form.country.$error.required">Select Country from list</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>

                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                State
                                                <!--<span class="text-danger">*</span>-->
                                            </label>
                                            <select ng-options="state as state.Name for state in states track by state.Code" class="form-control js-select selectpicker dropdown-select" ng-model="mstate" data-msg="Please select states." data-error-class="u-has-error" data-success-class="u-has-success"
                                                    data-live-search="true"
                                                    data-style="form-control border-color-1 font-weight-normal">
                                                <option value="">Select State</option>
                                            </select>

                                        </div>
                                        <!-- End Input -->
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" ng-disabled="form.$invalid" class="btn btn-primary-dark-w btn-block btn-pill font-size-20 mb-3 py-3">{{submitText}}</button>
                                <button type="button" class="btn btn-secondary" ng-repeat="button in leaseaddress.buttons" ng-click="DefaultCheck(button.item)" data-dismiss="modal">Close</button>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="alladress-dialog">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title ng-binding">Choose Address</h4>

                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="row mb-2">
                                <div class="col-lg-12">
                                    <button class="btn btn-primary pull-right" ng-click="AddNewAddress()">Add New</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 mb-5" ng-repeat="addr in alladdress">
                                    <label class="m-option">
                                        <span class="m-option__control">
                                            <span class="m-radio m-radio--state-brand">
                                                <input type="radio" name="billing_delivery" ng-model="selectedaddressid" ng-change="changeAddress(addr.museraddrid)" ng-value="addr.museraddrid">
                                                <span></span>
                                            </span>
                                        </span>
                                        <span class="m-option__label">
                                            <span class="m-option__body">
                                                <span ng-show="addr.maddress1">{{addr.maddress1}}<br /></span>
                                                <span ng-show="addr.maddress2">{{addr.maddress2}}<br /></span>
                                                <span>{{addr.mcity}} - {{addr.mpostcode}}</span>
                                            </span>
                                        </span>
                                    </label>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" ng-repeat="button in leaseaddress.buttons" ng-click="executeleaseAction(button.action,button.item,button.qty,button.event,button.singleitem)" class="btn btn-primary ng-binding ng-scope">{{button.label}}</button>
                            <button type="button" class="btn btn-secondary" ng-repeat="button in leaseaddress.buttons" ng-click="DefaultCheck(button.singleitem)" data-dismiss="modal">Close</button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="addnewcontact-dialog">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title ng-binding">New Contact</h4>
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        </div>
                        <form class="rform js-validate" name="cform" ng-submit="CSaveData(cform.$valid)" novalidate>
                            <div class="modal-body">

                                <div class="row">


                                    <div class="col-md-4">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                First Name
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="usercontacts.cusername" name="CName" placeholder="First Name" />
                                            <div class="invalid-feedback" ng-show="(cform.$submitted || cform.CName.$touched) && cform.CName.$error.required">Enter detail</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-4">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                SurName
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="usercontacts.csurname" name="CSName" placeholder="SurName" />
                                            <div class="invalid-feedback" ng-show="(cform.$submitted || cform.CSName.$touched) && cform.CSName.$error.required">Enter detail</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>

                                    <div class="col-md-4">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Position
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="usercontacts.cposition" name="CPosition" placeholder="Position">

                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="w-100"></div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Phone

                                            </label>
                                            <input type="text" maxlength="20" class="form-control" ng-model="usercontacts.cphone" name="CPhone" placeholder="Phone">

                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-2">
                                            <label class="form-label">
                                                Email Address

                                            </label>
                                            <input type="text" maxlength="150" class="form-control" ng-model="usercontacts.cemailaddress" name="CEmail1" placeholder="Email address">

                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-12">
                                        <!--<button type="button" ng-click="deleteRow($index)" class="btn btn-link pull-right" style="padding:0px 5px!important;">Delete Data</button>-->
                                    </div>

                                    <div class="col-md-12">
                                        <hr />
                                    </div>
                                    <div class="w-100"></div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="submit" ng-disabled="cform.$invalid && crsubmitted" class="btn btn-primary-dark-w btn-block btn-pill font-size-20 mb-3 py-3">{{csubmitText}}</button>
                                <button type="button" class="btn btn-secondary" ng-repeat="button in leaseaddress.buttons" ng-click="DefaultCheck(button.item)" data-dismiss="modal">Close</button>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
<div id="leaseaddress-dialog">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title ng-binding">Alternative Address</h4>
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="span5"><textarea id="alternative_address"></textarea></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" ng-repeat="button in leaseaddress.buttons" ng-click="executeleaseAction(button.action,button.item,button.qty,button.event)" class="btn btn-primary ng-binding ng-scope">Update Address</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="leasebank-dialog">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title ng-binding">Payment Option</h4>
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="js-form-message" style="background:#e0dede;padding:10px;margin-bottom:30px;border-radius:6.1875rem;">

                                        <label class="radio-inline ">
                                            How do you want to pay?
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" ng-model="payment" value="1" ng-click="changefield('1')" ng-required="!payment" name="optradio"> On Invoice?
                                        </label>
                                        <label class="radio-inline">
                                            or
                                        </label>
                                        <label class="radio-inline">
                                            <input type="radio" ng-model="payment" value="2" ng-click="changefield('2')" ng-required="!payment" name="optradio"> Direct Debit?
                                        </label>

                                    </div>

                                </div>

                            </div>
                            <div class="row box-shadow-1" ng-show="payment=='2' && bankfound" style="margin-left:15px;margin-right:15px;margin-top:10px">
                                <div class="col-md-12" style="margin-top:10px;">
                                    <div class="title bold">Your Bank Detail <button class="btn btn-link pull-right border-0 btn-remove-bg-hover" style="padding-top:0px!important;cursor:pointer;" ng-click="EditBank()">Change Detail</button></div>

                                </div>
                                <div class="col-md-12">
                                    <table class="table">
                                        <tbody>
                                            <tr>
                                                <td style="color:#333;width:200px;">Bank Name</td>
                                                <td><label class="form-label">{{bank.mbankname}}</label></td>
                                            </tr>
                                            <tr>
                                                <td style="color:#333;width:200px;">Account No.</td>
                                                <td><label class="form-label">{{bank.mbankaccount}}</label></td>
                                            </tr>
                                            <tr>
                                                <td style="color:#333;width:200px;">Account Holder</td>
                                                <td><label class="form-label">{{bank.maccountholder}}</label></td>
                                            </tr>
                                            <tr>
                                                <td style="color:#333;width:200px;">Bank Sort Code</td>
                                                <td><label class="form-label">{{bank.mbankshort}}</label></td>
                                            </tr>
                                        </tbody>
                                    </table>


                                </div>

                            </div>
                            <div class="row box-shadow-1" ng-show="payment=='2' && !bankfound" style="margin-left:15px;margin-right:15px;margin-top:10px">
                                <form id="form" ng-submit="bankupdate()">
                                    <div class="col-md-12" style="margin-top:10px;">
                                        <div class="title bold">Your Bank Detail </div>

                                    </div>
                                    <div class="col-md-12" style="margin-top:10px;">
                                        <hr />

                                    </div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-6">
                                            <label class="form-label">
                                                Bank Name
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="bank.mbankname" name="mbankname" placeholder="Bank Name" required="" data-msg="Please enter your bank name." data-error-class="u-has-error" data-success-class="u-has-success">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankname.$touched) && form.mbankname.$error.required">Enter detail</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-6">
                                            <label class="form-label">
                                                Account Number
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="bank.mbankaccount" name="mbankaccount" placeholder="Account Name" required="">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankaccount.$touched) && form.mbankaccount.$error.required">Enter detail</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-6">
                                            <label class="form-label">
                                                Account Name
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="bank.maccountholder" name="maccountholder" placeholder="Account Holder" required="" data-success-class="u-has-success">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.maccountholder.$touched) && form.maccountholder.$error.required">Enter detail</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-6">
                                        <!-- Input -->
                                        <div class="js-form-message mb-6">
                                            <label class="form-label">
                                                Bank Sort Code
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" maxlength="100" class="form-control" ng-model="bank.mbankshort" name="mbankshort" placeholder="Name" required="">
                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.mbankshort.$touched) && form.mbankshort.$error.required">Enter detail</div>
                                        </div>
                                        <!-- End Input -->
                                    </div>
                                    <div class="col-md-12">

                                        <button type="button" class="btn btn-warning pull-right" ng-click="CancelBank()">Cancel</button>
                                        <button type="submit" class="btn btn-primary pull-right">Save Detail</button>
                                    </div>
                                </form>

                            </div>

                            <div class="span5"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="continue" class="btn btn-primary" ng-disabled="payment=='2' && !bankfound">Continue</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="generatedAgreementmodal">
            <div class="modal fade confirmation-dialog" role="dialog" style="overflow-y:scroll">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Generated Agreements</h4>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="alert alert-success">
                                        <p ng-bind-html="bootdetailmsg"></p>
                                    </div>
                                </div>
                                <div class="col-xs-12">
                                    <div class="woocommerce" ng-show="modalAggreements.length>0">
                                        <div class="woocommerce-notices-wrapper" style="border-bottom:1px solid #a7a7a7;">
                                            <h6 class="quoteh6">*  Print and send the original signed copy to the lessor at address stated in the agreement</h6>
                                        </div>
                                        <div class="row woocommerce-cart-form__cart-item cart_item border box-shadow-1 aggreementrow mt-5" style="margin-left:0px;margin-right:0px;" ng-repeat="item in modalAggreements track by $index ">
                                            <!--<div class="col-4" style="padding-left:5px;">
                                                <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0">
                                                    <thead>
                                                        <tr>
                                                            <th style="text-align:center">Order No</th>
                                                            <th style="text-align:center">Items</th>
                                                            <th style="text-align:center">Po Number</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                        <tr ng-init="total=0;period=0;freq=0" ng-repeat="item in item.Product">
                                                            <td align="center">{{item.magreementno}}</td>
                                                            <td align="center">{{item.length}}</td>
                                                            <td align="center"><button class="btn btn-primary border-0" style="border-radius:0" ng-click="OpenOrder(value)">{{item.length}}</button></td>
                                                            <td align="center">{{item.msorderno}}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>-->
                                            <div class="col-12" style="padding-right:5px;border-left:0px solid #a7a7a7">
                                                <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0">
                                                    <thead>
                                                        <tr>

                                                            <th class="product-subtotal" style="text-align:center;">Date</th>
                                                            <th style="width:150px;" class="product-name">Aggreement No</th>
                                                            <th class="" style="white-space:nowrap">Lessor</th>
                                                            <th class="product-name">Lease Term</th>
                                                            <th class="product-subtotal">Items</th>
                                                            <th class="product-subtotal" style="text-align:center;">Total</th>
                                                            <th class="product-subtotal" style="text-align:center;">Printed By</th>
                                                            <th class="product-subtotal" style="text-align:center;">Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                        <tr id="trq{{item.mleaseid}}">

                                                            <td align="center" class="product-subtotal" style="word-wrap: break-word;white-space:normal;" data-title="Product">{{item.displaydate}}</td>
                                                            <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;width:200px;" data-title="Product">{{item.mleaseno}}</td>
                                                            <td style="white-space:nowrap">Compu Lease</td>
                                                            <td>{{getTerms(item.Product[0].mtermf,item.Product[0].mtermp)}}</td>
                                                            <td style="white-space:nowrap"><button class="btn btn-primary border-0" style="border-radius:0" ng-click="OpenOrder(item.Product)">{{item.Product.length}}</button></td>
                                                            <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">£{{item.total}}<br /> <span class="pm" style="font-size:10px">{{ getNewTerms(item.Product[0].mtermf,item.Product[0].mtermp) }}</span></td>
                                                            <td align="center">{{item.mprintby}}<br />{{item.mprintdate |  date:"dd/MM/yyyy"}}</td>
                                                            <td align="center" data-title="Status">
                                                                <button type="button" class="btn btn-danger rounded" ng-click="getLeasePdf(item.mleaseid)" title="View Aggreement"> <i class="fa fa-print"></i></button>

                                                            </td>


                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>




                                    </div>

                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <!--<form method="post" action="Order/LoadOrders">
                                <input type="hidden" name="mleaseids" value="" />
                                <button type="submit" class="btn btn-warning" >Print all agreement</button>
                            </form>-->
                            <button type="button" class="btn btn-warning" ng-click="PrintAllAgreement()">Print all agreement</button>
                            <button type="button" class="btn btn-default" style="background:#333;" data-dismiss="modal">Cancel</button>

                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div id="agreementmodal">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>


                            <div class="row" style="width:100%;">
                                <div class="col-lg-6">
                                    <h4 class="modal-title ng-binding">Lease Agreement</h4>
                                </div>
                                <div class="col-lg-6">
                                    <!--<button type="submit" class="btn btn-primary" onclick="doPrint()">Print Agreement</button>

                                    <form method="post" action="/Order/Export" style="display:inline-block;margin-left:10px;">
                                        <input type="hidden" name="html" />

                                        <button type="submit" class="btn btn-primary" id="exportpdfnew">Export Agreement</button>
                                    </form>
                                        -->


                                </div>
                            </div>
                        </div>
                        <div class="modal-body">
                            <iframe id="printf3" style="width:100%;height:100%;"></iframe>
                        </div>
                        <div class="modal-footer">
                            <div class="row">
                                <div class="col-lg-12">
                                    <!--<button type="submit" class="btn btn-primary" onclick="doPrint()">Print Agreement</button>


                                    -->
                                    <button type="button" data-dismiss="modal" class="btn" style="background:#000;">Cancel</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="orderconfirmmodal">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title ng-binding">Order Confirmation</h4>
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-success">
                                <strong>Your Order No: {{ordermodal.OrderNo}}</strong>
                                <p>Thank you for confirming order. This will now be process by the lessor.<br />You can check your order status in My account > Orders</p>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id="exportpdf2">Print Aggreement</button>
                            <button type="button" data-dismiss="modal" class="btn" style="background:#000;">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
       

        <div class="modal fade" id="quoteModal" role="dialog">
            <div class="modal-dialog modal-lg">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Quotation Info</h4>
                        <button type="button" class="close mdclose" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">

                    </div>
                    <div class="modal-footer">
                        <a class="btn btn-primary text-black exportpdfnew" style="cursor:pointer;color:#333;">Print</a>
                        <a class="btn btn-danger downloadpdfnew" style="cursor: pointer; color: #333;">Download PDF</a>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="rquoteModal" role="dialog">
            <div class="modal-dialog modal-lg">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Reference Products</h4>
                        <button type="button" class="close mdclose" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="displayview"></div>
                        <div id="nondisplayview" style="display:none;"></div>
                    </div>
                    <div class="modal-footer">
                        <a id="" class="btn btn-primary-dark exportpdf" style="cursor:pointer">Print</a>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="msgModal" role="dialog">
            <div class="modal-dialog modal-lg modal-dialog-centered">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header" ng-show="hideclose">
                        <button type="button" class="close mdclose" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body" style="padding:0px;">
                        <div class="alert alert-success" style="margin-bottom:0px;" role="alert">
                            <h6 class="alert-heading">{{bootmsg}}</h6>
                            <p ng-bind-html="bootdetailmsg"></p>

                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="modal fade" id="reviewModal" role="dialog">
            <div class="modal-dialog modal-lg">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">User Review</h4>
                        <button type="button" class="close mdclose" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <label>Whether goods receive in good condition?(Please tick) : </label>
                                <input type="radio" ng-model="condition" name="rdoResult" ng-value="1" checked> Yes
                                <input type="radio" ng-model="condition" name="rdoResult" ng-value="0"> No
                            </div>
                            <div class="col-xs-12">
                                <label>Select Date: </label>
                                <div id="datepicker" class="input-group date" data-date-format="mm-dd-yyyy">
                                    <input class="form-control" type="text" readonly />
                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                </div>

                                <!--<label>Confim Delivery Notes</label>
                                <textarea class="form-control p-5" rows="4" name="text" ng-model="reviewnote" placeholder="Notes about your order, e.g. special notes for delivery."></textarea>-->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a ng-click="SaveReview()" class="btn btn-primary-dark" style="cursor:pointer">Save Delivery Review</a>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="confirmation-dialog">
            <div class="modal fade confirmation-dialog" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">{{confirmationDialogConfig.title}}</h4>
                        </div>
                        <div class="modal-body">
                            <div class="span5">{{confirmationDialogConfig.message}}</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" style="background:#333;" data-dismiss="modal">Cancel</button>
                            <button type="button" ng-repeat="button in confirmationDialogConfig.buttons" ng-click="executeDialogAction(button.action,button.index,button.step)" class="btn btn-primary">{{button.label}}</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="docinmodal" class="modal fade" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="row" style="width:100%;">
                            <button type="button" class="close mdclose" data-dismiss="modal">×</button>
                            <div class="col-lg-9">
                                <h6 style="color:#333">
                                    Upload signed document

                                </h6>

                            </div>

                            <input type="hidden" id="reload" value="" />
                        </div>
                    </div>

                    <div class="modal-body" ng-init="ScanCopy=1" style="padding:0 22px;">
                        <div class="row m-2" ng-show="DocUpload">

                            <div class="col-lg-6">
                                <button type="button" class="btn btn-primary" ng-click="ScanCopy=1">Upload scanned doc</button>
                            </div>
                            <div class="col-lg-6">
                                <button type="button" class="btn btn-primary" ng-click="ScanCopy=2">Do not have scanner?</button>
                            </div>

                        </div>
                        <div class="row" ng-show="ScanCopy=='2'">
                            <div class="col-lg-12">
                                <hr />
                            </div>

                            <div class="col-lg-12">
                                <div class="alert alert-success">
                                    <p>Oh! Not to worry. Just send your signed copy to the lessor at below address.</p><br />
                                    <p><strong>17 The Avenue, London NW6 7NR, UK</strong></p>
                                </div>
                            </div>
                        </div>
                        <form ng-show="ScanCopy=='1'" method="post" ng-submit="UploadDocs()" name="f1">
                            <div ng-show="!DocUpload">
                                <div class="row form-group mt-2">
                                    <div class="col-lg-3">
                                        <label for="exampleInputinvoiceserialnumber">Doc Id</label>
                                    </div>
                                    <div class="col-lg-9">
                                        <input type="text" class="form-control m-input--air" ng-model="mleaseno" name="mleaseno" value="{{mleaseno}}" />
                                        <!--<input type="text" class="form-control m-input--air" compare-to="mleaseno" name="leasedocid" ng-model="leasedocid" placeholder="Doc Id" required>
                                        <div class="form-control-feedback" style="color:#b20606" ng-show="f1.leasedocid.$dirty && f1.leasedocid.$error.compareTo">Enter correct  doc id</div>-->
                                    </div>
                                </div>
                                <div class="row form-group">
                                    <div class="col-lg-3">
                                        <label for="exampleInputEmail1">Document</label>

                                    </div>
                                    <div class="col-lg-9">
                                        <div class="custom-file">

                                            <input type="file" class="custom-file-input" nv-file-select="" uploader="uploader" />
                                            <label class="custom-file-label" for="customFile">Choose file</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12" ng-show="DocUpload">
                                <div class="alert alert-success">
                                    <p><strong>Oh! Great.</strong> Now,please send your signed copy to the lessor at below address.</p><br />
                                    <p><strong>17 The Avenue, London NW6 7NR, UK</strong></p>
                                </div>
                            </div>


                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" data-dismiss="modal" class="btn btn-danger">Close</button>
                        <button type="submit" ng-disabled="DocUpload || f1.leasedocid.$error.compareTo" class="btn btn-primary" id="uploaddoc" ng-click="uploader.queue[0].upload()">Upload Doc</button>
                    </div>

                </div>
            </div>
        </div>

        <nav class="woocommerce-breadcrumb"><a href="@Url.Action("Index","Home")">Home</a><span class="delimiter"><i class="fa fa-angle-right"></i></span><span ng-bind="breadcum"></span></nav><div class="site-content-inner">
            <div id="primary" class="content-area">
                <main id="main" class="site-main">


                    <article id="post-3134" class="post-3134 page type-page status-publish hentry">

                        <header class="entry-header">
                            <h1 class="entry-title" ng-bind="pagetitle">Your Lease Basket</h1>
                        </header><!-- .entry-header -->
                        <div class="entry-content" ng-if="!loader">
                            <div id="dataloading" class="se-pre-con" ng-show="dataloading" style="z-index:11111091;">

                            </div>
                            <div class="row">
                                <div class="d-xl-block col-xl-3 col-wd-2gdot5">
                                    <div class="mb-6 border border-width-2 border-color-3 borders-radius-6 box-shadow-1">
                                        <!-- List -->
                                        <ul id="sidebarNav" class="list-unstyled mb-0 sidebar-navbar view-all">
                                            <li><div class="dropdown-title font-weight-bold">My Account</div></li>
                                            <!--<li class="nav-item1" ng-class="getTabClass(1)">
                                                <a ng-class="getTabClass(1)" ng-click="setActiveTab(1)" id="print-tab-md" data-toggle="tab" href="#print-md" role="tab" aria-controls="home-md"
                                                   aria-selected="true">
                                                    Lease Basket({{tabCount[1]}})
                                                </a>


                                            </li>-->
                                            <!--<li class="nav-item1" ng-class="getTabClass(2)">
                                                <a ng-class="getTabClass(2)" ng-click="setActiveTab(2)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Orders({{tabCount[2]}})
                                                </a>


                                            </li>-->
                                            <li class="nav-item1" ng-class="getTabClass(7)">
                                                <a ng-class="getTabClass(7)" ng-click="setActiveTab(7)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    My Profile
                                                </a>


                                            </li>
                                            <li class="nav-item1" ng-class="getTabClass(12)">
                                                <a ng-class="getTabClass(12)" ng-click="setActiveTab(12)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Pending Signature Leases({{pendingagreecounter}})
                                                </a>


                                            </li>
                                            <li class="nav-item1" ng-class="getTabClass(3)">
                                                <a ng-class="getTabClass(3)" ng-click="setActiveTab(3)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Your lease orders({{agreecounter}})
                                                </a>


                                            </li>

                                            <li class="nav-item1" ng-class="getTabClass(4)">
                                                <a ng-class="getTabClass(4)" ng-click="setActiveTab(4)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Your actives Leases
                                                </a>


                                            </li>

                                            <li class="nav-item1" ng-class="getTabClass(5)">
                                                <a ng-class="getTabClass(5)" ng-click="setActiveTab(5)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Wishlist
                                                </a>


                                            </li>
                                            <li class="nav-item1" ng-class="getTabClass(6)">
                                                <a ng-class="getTabClass(6)" ng-click="setActiveTab(6)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Messages({{msgcounter}})
                                                </a>


                                            </li>
                                            <li class="nav-item1" ng-class="getTabClass(10)">
                                                <a ng-class="getTabClass(10)" ng-click="setActiveTab(10)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    My Contacts
                                                </a>


                                            </li>
                                            <li class="nav-item1" ng-class="getTabClass(8)">
                                                <a ng-class="getTabClass(8)" ng-click="setActiveTab(8)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    My Addresses
                                                </a>


                                            </li>

                                            <li class="nav-item1" ng-class="getTabClass(9)">
                                                <a ng-class="getTabClass(9)" ng-click="setActiveTab(9)" id="lessor-tab-md" data-toggle="tab" href="#order-md" role="tab" aria-controls="order-md"
                                                   aria-selected="false">
                                                    Settings
                                                </a>


                                            </li>
                                            <li class="nav-item1" ng-class="getTabClass(11)">
                                                <a ng-click="Logout()" ng-class="getTabClass(11)" href="javascript:;">
                                                    Logout
                                                </a>


                                            </li>
                                        </ul>
                                        <!-- End List -->
                                    </div>
                                </div>
                                <div class="tab-content col-xl-9 col-wd-9gdot5">
                                    <!--<div id="tabloading" class="se-pre-con" style="left: 16px;top: 41px;width: 98%;height: 98%;z-index:111;" ng-show="tabloading">
                                    </div>-->

                                    <div id="tabloading" class="se-pre-con2" style="left: 0%;top: 0px;width: 80%;height: 98%;z-index:111;position:absolute;background-color:transparent;" ng-show="tabloading">
                                    </div>
                                    <div ng-class="getTabPaneClass(12)" id="aggreement-md" role="tabpanel" aria-labelledby="aggreement-tab-md" class="border box-shadow-1 mb-2">
                                        <div class="row">
                                            <div ng-show="PendingSignAggreements.length<0" class="col-xs-12 nodata">
                                                <div>

                                                    <p>No agreements</p>
                                                    <hr>
                                                    <!--<p class="mb-0">Go to <a href="/Leasing/" class="btn btn-secondary">Shop</a></p>-->
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="woocommerce" ng-show="PendingSignAggreements.length>0">
                                                    <div class="woocommerce-notices-wrapper" style="border-bottom:1px solid #a7a7a7;">
                                                        <h6 class="quoteh6">*  Sign the pending agreements</h6>
                                                    </div>
                                                    <div class="woocommerce-cart-form__cart-item cart_item border box-shadow-1 aggreementrow mt-5" ng-repeat="item in PendingSignAggreements | orderBy:item.mleaseno:false track by $index " style="border-color:#7092be!important">
                                                        <div class="row ml-0 mr-0" style="background:#efefef">
                                                            <div class="col-lg-12 pt-2 pb-2" style="border-bottom:1px solid #7092be">
                                                                <div class="col-lg-2 lg-15 pl-2 pr-2">
                                                                    <div class="fontcolorgrey">
                                                                        <span style="font-size:12px;">Order No: </span><span style="color:#000;font-weight:600;font-size:15px;">{{item.mleaseno}}</span>
                                                                    </div>

                                                                </div>
                                                                <div class="col-lg-2 lg-15 pl-2 pr-2">
                                                                    <div class="fontcolorgrey">
                                                                        <span style="font-size:12px;">Date: </span><span style="color:#000;font-weight:600">{{item.displaydate}}</span>
                                                                    </div>

                                                                </div>
                                                                <div class="col-lg-2  lg-20 pl-2 pr-2">
                                                                    <div class="fontcolorgrey">
                                                                        <span style="font-size:12px;">Lease Term: </span><span style="font-size:14px;color:#082044;font-weight:600">{{getTerms(item.Product[0].mtermf,item.Product[0].mtermp)}}</span>
                                                                    </div>

                                                                </div>
                                                                <div class="col-lg-3 pl-2 pr-2">
                                                                    <div class="fontcolorgrey">
                                                                        <span style="font-size:12px;">Total Rental : </span><span style="font-size:14px;color:#082044;font-weight:600">£{{item.total}} {{ getNewTerms(item.Product[0].mtermf,item.Product[0].mtermp) }}</span>
                                                                    </div>

                                                                </div>
                                                                <div class="col-lg-3 pl-2 pr-2">
                                                                    <div class="pull-right fontcolorgrey">
                                                                        <span style="font-size:12px;">Your PO Number: </span><span style="color:#000;font-weight:600">{{item.msorderref}}</span> &nbsp;&nbsp;&nbsp;<button class="btn btn-danger border-0" style="border-radius:0" ng-click="OpenPurchaseOrder(item.msorderref)">View</button>
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-6 pl-2">
                                                                    <p class="mb-0" style="color:#08387f;font-size:12px;">Estimated Delivery Date : {{item.mest| date:'dd/MM/yyyy'}}</p>
                                                                </div>
                                                                <div class="col-md-6 pr-2 text-right">
                                                                    <p class="mb-0" style="font-size:12px;color:#126add;text-align:right">Agreement signed by {{item.mprintby}} {{item.mdisplaydate |  date:"dd/MM/yyyy"}}</p>

                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div class="mb-1 pb-3">
                                                            <div class="col-12 mb-1 text-xl-right" style="display:none;" ng-show="item.mprintby!='' && item.mprintby!=null">
                                                                <hr />
                                                                <button class="btn btn-primary" style="padding:0px;" title="Upload signed agreement" ng-show="item.mdocname=='' &&  uploadindex[$index]" ng-click="UploadDoc($event,item.mleaseno)">Upload signed agreement</button>
                                                                <button class="btn btn-primary" style="padding:0px;" title="Skip" ng-show="item.mdocname=='' && item.msend!=2  && !skipindex[$index]" ng-click="skipindex[$index]=true;uploadindex[$index]=false;">I cannot Upload</button>
                                                                <div ng-show="item.msend!=2 && (skipindex[$index] || item.mdocname!='') && (item.mest==null || item.mest=='')">
                                                                    <p class="mb-2">Please send orginal signed agreement to lessor at following address:</p>
                                                                    <p><strong>17 The Avenue, London NW6 7NR, UK</strong></p>
                                                                </div>
                                                                <button class="btn btn-primary" ng-show="item.msend!=2 && (skipindex[$index] || item.mdocname!='') && (item.mest==null || item.mest=='')" style="padding:0px;" title="Mark Send" ng-click="updateSend(item.mleaseno,item)">Signed agreement sent by post</button>
                                                                <hr />
                                                            </div>
                                                            <div class="row mb-1 text-xl-right pl-0 pr-0 ml-2 mr-2 pb-1" style="background:#fff;">
                                                                <div class="col-12 ml-0 mr-0 pl-0" ng-init="showOrder[item.mleaseno]=true;" style="margin:0 auto;text-align:right;padding-right:0px;border-left:0px solid #a7a7a7">

                                                                    <button type="button" class="btn btn-success" style="border-radius:0;" ng-click="loadDocusign(item.menvelopid,item.mleaseno)" title="View Aggreement"> Sign this  Agreement</button>
                                                                    <button class="btn btn-secondary" style="border-radius:0" ng-click="printorder(item)">Print this Order</button>
                                                                    <button type="button" class="btn btn-primary vieworder" style="border-radius:0;" ng-hide="showOrder[item.mleaseno]" ng-click="OpenOrderNew($event,item.mleaseno,true)">View Order</button>
                                                                    <button type="button" class="btn btn-primary vieworder" style="border-radius:0;" ng-show="showOrder[item.mleaseno]" ng-click="OpenOrderNew($event,item.mleaseno,false)">Hide Order</button>
                                                                    <button type="button" class="btn btn-danger" style="border-radius:0;" ng-click="deleteagreement(item.menvelopid,item.mleaseno)" title="Delete Aggreement"> Delete this  Agreement</button>
                                                                </div>
                                                                <div class="col-12 mt-2 orderview pl-0 pr-0" ng-show="showOrder[item.mleaseno]">

                                                                    <!-- Card -->
                                                                    <div class="card mb-1 woocommerce-cart-form__cart-item cart_item border box-shadow-1">
                                                    
                                                                        <div class="col-md-12">
                                                                            <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents" style="margin-bottom:0.75rem" cellspacing="0">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th class="product-thumbnail">&nbsp;</th>
                                                                                        <th class="product-name">Product Details</th>
                                                                                        <!--<th class="product-price">Unit Price</th>-->
                                                                                        <th class="product-quantity">Quantity</th>
                                                                                        <!--<th class="product-subtotal">VAT</th>-->
                                                                                        <th class="product-subtotal">Rental</th>
                                                                                        <th class="product-notes">Status</th>
                                                                                        <!--<th class="product-notes"></th>-->
                                                                                    </tr>

                                                                                </thead>
                                                                                <tbody>

                                                                                    <tr ng-repeat="item2 in item.Product |  orderBy:item2.mquotestatus:false track by $index" class="woocommerce-cart-form__cart-item cart_item">

                                                                                        <td class="product-thumbnail">
                                                                                            <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">
                                                                                                <img ng-src="/LeaseAdmin/Content/images/product/{{item2.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" style="width:auto;height:50px;" width="300" height="300">
                                                                                            </a>
                                                                                        </td>

                                                                                        <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                                                            <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">{{item2.mproductname}}</a>
                                                                                            <span style="font-size: 0.85em;" ng-if="item2.suppliername!=null"><br />Supplier : {{item2.suppliername}}</span>
                                                                                            <!--<br/><button class="btn btn-link" style="border-radius:0;padding-left:0px!important;font-size:11px;padding-top:1px!important;padding-bottom:1px;" ng-click="showOrder[$index]=true;" ng-disabled="item2.mquotestatus!='ldelivered'">Supplier Review</button>-->
                                                                                        </td>
                                                    
                                                                                        <td class="product-quantity" data-title="Quantity" style="width:50px;">
                                                                                            <div class="quantity" style="margin:0 auto;">
                                                                                                <span class="woocommerce-Price-amount amount">{{item2.quantity}}</span>

                                                                                            </div>
                                                                                        </td>
                                                                                        <!--<td class="product-subtotal" data-title="VAT">
                                                            <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mvat | number:2}}</span>
                                                        </td>-->
                                                                                        <td class="product-subtotal" data-title="Total">
                                                                                            <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice*item2.quantity | number:2}}</span>
                                                                                        </td>
                                                                                        <td data-title="Notes">
                                                                                            {{item2.status=='a'?'Allocated':item2.status=='rd'?'Dispatched':item2.status=='di'?'Delivered':'Pending'}}
                                                                                        </td>
                                                                                    </tr>



                                                                                </tbody>
                                                                            </table>
                                                                        </div>
                                                                        <div class="col-md-12">
                                                                            <hr />
                                                                        </div>
                                                                        <div class="card-body pl-0 pb-1 pr-0 pt-1">
                                                                            <div class="row m-0">

                                                                                <div class="col-md-12 border-bottom-gray-1 orderd">
                                                                                    <div class="col-md-6 pl-0">
                                                                                        <h6 style="color:#333;" class="text-left"><span class="fontcolorgrey">Payment Mode :</span> {{item.mpayment=='2'?'Direct Debit':'On Invoice'}}</h6>

                                                                                    </div>
                                                                                    <div class="col-md-6 pr-0">
                                                                                        <p class="mb-0 text-primary text-blue" style="font-size:12px;">*All prices are excl. of VAT</p>

                                                                                    </div>

                                                                                    <table class="table table1" ng-show="item.mpayment=='2'">
                                                                                        <tbody>
                                                                                            <tr>
                                                                                                <td style="color:#333;"><span class="fontcolorgrey">Bank Name :</span> {{bank.mbankname}}</td>
                                                                                                <td style="color:#333;"><span class="fontcolorgrey">Account No :</span> {{bank.mbankaccount}}</td>
                                                                                                <td style="color:#333;"><span class="fontcolorgrey">Account Holder :</span> {{bank.maccountholder}}</td>
                                                                                                <td style="color:#333;"><span class="fontcolorgrey">Sort Code :</span> {{bank.mbankshort}}</td>

                                                                                            </tr>

                                                                                        </tbody>
                                                                                    </table>


                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                    <!-- End Card -->
                                                                    <!-- Card -->


                                                                </div>
                                                            </div>



                                                        </div>
                                                    </div>

                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div ng-class="getTabPaneClass(3)" id="aggreement-md" role="tabpanel" aria-labelledby="aggreement-tab-md" class="border box-shadow-1 mb-2">
                                        <div class="row">
                                            <div ng-show="Aggreements.length<0" class="col-xs-12 nodata">
                                                <div>

                                                    <p>No agreements</p>
                                                    <hr>
                                                    <!--<p class="mb-0">Go to <a href="/Leasing/" class="btn btn-secondary">Shop</a></p>-->
                                                </div>
                                            </div>
                                            <div class="col-xs-12">
                                                <div class="woocommerce" ng-show="Aggreements.length>0">
                                                    <div class="woocommerce-notices-wrapper" style="border-bottom:1px solid #a7a7a7;">
                                                        <h6 class="quoteh6">*  Print and send the original signed copy to the lessor at address stated in the agreement</h6>
                                                    </div>
                                                    <div class="woocommerce-cart-form__cart-item cart_item border box-shadow-1 aggreementrow mt-5" ng-repeat="item in Aggreements | orderBy:item.mleaseno:false track by $index " style="border-color:#7092be!important">
                                                        <div class="row ml-0 mr-0" style="background:#efefef">
                                                           <div class="col-lg-12 pt-2 pb-2" style="border-bottom:1px solid #7092be">
                                                               <div class="col-lg-2 lg-15 pl-2 pr-2">
                                                                   <div class="fontcolorgrey">
                                                                       <span style="font-size:12px;">Order No: </span><span style="color:#000;font-weight:600;font-size:15px;">{{item.mleaseno}}</span>
                                                                   </div>

                                                               </div>
                                                               <div class="col-lg-2 lg-15 pl-2 pr-2">
                                                                   <div class="fontcolorgrey">
                                                                       <span style="font-size:12px;">Date: </span><span style="color:#000;font-weight:600">{{item.displaydate}}</span>
                                                                   </div>
                                                                   
                                                               </div>
                                                               <div class="col-lg-2  lg-20 pl-2 pr-2">
                                                                   <div class="fontcolorgrey">
                                                                       <span style="font-size:12px;">Lease Term: </span><span style="font-size:14px;color:#082044;font-weight:600">{{getTerms(item.Product[0].mtermf,item.Product[0].mtermp)}}</span>
                                                                   </div>

                                                               </div>
                                                               <div class="col-lg-3 pl-2 pr-2">
                                                                   <div class="fontcolorgrey">
                                                                       <span style="font-size:12px;">Total Rental : </span><span style="font-size:14px;color:#082044;font-weight:600">£{{item.total}} {{ getNewTerms(item.Product[0].mtermf,item.Product[0].mtermp) }}</span>
                                                                   </div>

                                                               </div>
                                                               <div class="col-lg-3 pl-2 pr-2">
                                                                   <div class="pull-right fontcolorgrey">
                                                                       <span style="font-size:12px;">Your PO Number: </span><span style="color:#000;font-weight:600">{{item.msorderref}}</span> &nbsp;&nbsp;&nbsp;<button class="btn btn-danger border-0" style="border-radius:0" ng-click="OpenPurchaseOrder(item.msorderref)">View</button>
</div>
                                                               </div>
                                                               <div class="col-lg-6 pl-2">
                                                                   <p class="mb-0" style="color:#08387f;font-size:12px;">Estimated Delivery Date : {{item.mest| date:'dd/MM/yyyy'}}</p>
                                                                </div>
                                                               <div class="col-md-6 pr-2 text-right">
                                                                   <p class="mb-0" style="font-size:12px;color:#126add;text-align:right">Agreement signed by {{item.mprintby}} {{item.mdisplaydate |  date:"dd/MM/yyyy"}}</p>

                                                               </div>
                                                           </div> 
                                                            
                                                        </div>
                                                    <div class="mb-1 pb-3">
                                                            <div class="col-12 mb-1 smallprogress pb-2 pt-2" ng-init="skipindex[$index]=false;item.msend==2?uploadindex[$index]=false:uploadindex[$index]=true;">
                                                            <form id="msform">
                                                                <label class="fontcolorblack pull-left progresslabel" style="display:inline">Order Status:</label>
                                                                <ul id="progressbar" class="quoteprogress">

                                                                    <li class="active complete">Order Received</li>
                                                                    <li class="active" ng-class="item.malloc=='a' || item.malloc=='sd' || item.malloc=='rd' || item.malloc=='di' || item.malloc=='de' || item.malloc=='c'?'complete':''">Order allocated</li>
                                                                    <li class="active" ng-class="item.malloc=='di' || item.malloc=='de' || item.malloc=='c'?'complete':''">Order dispatched</li>
                                                                    <li class="active" ng-class="item.malloc=='de' || item.malloc=='c'?'complete':''">Order delivered</li>
                                                                    <!--<li class="active complete">Agreement Signed</li>
                                                                    <li ng-class="item.mprintby!=null?'active complete':'active'">Product Shipped</li>-->
                                                                    <!--<li ng-class="item.mdocname!=''?'active complete':item.mprintby!=null && uploadindex[$index]==true?'active':''">
                                                                        <a style="cursor:pointer;" ng-show="item.msend==2 && item.mdocname==''" href="javascript:;" ng-click="uploadindex[$index]=true;">Upload Signed<br /> Agreement</a>
                                                                        <span ng-show="(item.msend!=2 && item.mdocname=='') || item.mdocname!=''">Upload Signed<br /> Agreement</span>
                                                                    </li>
                                                                    <li ng-class="(item.msend!='' && item.msend!=null && item.msend==2) || (item.mest!=null && item.mest!='') ?'active complete':skipindex[$index]?'active':''">Send Agreement<br /> to lessor</li>
                                                                        -->
                                                                    <!--<li ng-class="item.mest!=null?'active complete':item.msend!='' && item.msend!=null && item.msend==2 && !uploadindex[$index]?'active':''"><span ng-show="item.mest==null">Product Delivered</span><span ng-show="item.mest!=null">Estimated Delivery<br />{{item.mest| date:'dd/MM/yyyy'}}</span></li>-->
                                                                </ul>
                                                                <div class="popover__wrapper " style="display:none;">
                                                                    <a href="javascript:;" class="poplink" onclick="openpopover(this)">
                                                                        <h2 class="popover__title">Check Progress</h2>
                                                                    </a>

                                                                    <div class="popover__content">

                                                                    </div>
                                                                </div>
                                                            </form>
                                                            
                                                        </div>
                                                        <div class="col-12 mb-1 text-xl-right" style="display:none;" ng-show="item.mprintby!='' && item.mprintby!=null">
                                                            <hr />
                                                            <button class="btn btn-primary" style="padding:0px;" title="Upload signed agreement" ng-show="item.mdocname=='' &&  uploadindex[$index]" ng-click="UploadDoc($event,item.mleaseno)">Upload signed agreement</button>
                                                            <button class="btn btn-primary" style="padding:0px;" title="Skip" ng-show="item.mdocname=='' && item.msend!=2  && !skipindex[$index]" ng-click="skipindex[$index]=true;uploadindex[$index]=false;">I cannot Upload</button>
                                                            <div ng-show="item.msend!=2 && (skipindex[$index] || item.mdocname!='') && (item.mest==null || item.mest=='')">
                                                                <p class="mb-2">Please send orginal signed agreement to lessor at following address:</p>
                                                                <p><strong>17 The Avenue, London NW6 7NR, UK</strong></p>
                                                            </div>
                                                            <button class="btn btn-primary" ng-show="item.msend!=2 && (skipindex[$index] || item.mdocname!='') && (item.mest==null || item.mest=='')" style="padding:0px;" title="Mark Send" ng-click="updateSend(item.mleaseno,item)">Signed agreement sent by post</button>
                                                            <hr />
                                                        </div>
                                                        <div class="row mb-1 text-xl-right pl-0 pr-0 ml-2 mr-2 pb-1" style="background:#fff;">
                                                            
                                                            @*<div class="col-9 ml-0 mr-0 pl-0" style="padding-right:0px;border-left:0px solid #a7a7a7">

    <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable mb-0" cellspacing="0">
         <thead>
             <tr>

                 <th style="width:100px;" class="product-name">Order No</th>
                 <!--<th class="product-name">Lease Term</th>-->
                 <th class="product-subtotal" style="text-align:center">Items</th>
                 <th class="product-name" style="text-align:center;">Rental</th>
                 <th class="product-subtotal" style="text-align:center;">Agreement Generated By</th>
                 <!--<th class="product-subtotal" style="text-align:center;"></th>-->

             </tr>
         </thead>
         <tbody>
             <tr id="trq{{item.mleaseid}}" >

                 <td class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Order No">{{item.mleaseno}}</td>
                 <td data-title="Items" class="viewitem" style="white-space:nowrap" align="center">
                     <strong>{{item.Product.length}}</strong><br />

                 </td>
                 <td data-title="Items" class="viewitem" style="white-space:nowrap;" align="center" ng-show="showOrder[$index]==false;">
                     <strong>{{item.Product.length}}</strong><br />
                 </td>
                 <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Total">£{{item.total}}<br /> <span class="pm" style="font-size:10px">{{ getNewTerms(item.Product[0].mtermf,item.Product[0].mtermp) }}</span></td>
                 <td align="center" data-title="Print By">{{item.mprintby}}<br /><span class="pm" style="font-size:10px">{{item.mprintdate |  date:"dd/MM/yyyy"}}</span></td>

             </tr>
         </tbody>
     </table>
                                                            </div>*@
                                                            <div class="col-12 ml-0 mr-0 pl-0" ng-init="showOrder[item.mleaseno]=true;" style="margin:0 auto;text-align:right;padding-right:0px;border-left:0px solid #a7a7a7">
                                                                
                                                                <!--<button type="button" class="btn btn-success" style="border-radius:0;" ng-click="getLeasePdf(item.mleaseid)" title="View Aggreement"> View this  Agreement</button>-->
                                                                <button type="button" class="btn btn-success" style="border-radius:0;" ng-click="getDocusignpdf(item.menvelopid,item.mleaseno,item.mleaseid)" title="View Aggreement"> View this  Agreement</button>
                                                                <button class="btn btn-secondary" style="border-radius:0" ng-click="printorder(item)">Print this Order</button>
                                                                <button type="button" class="btn btn-primary vieworder" style="border-radius:0;" ng-hide="showOrder[item.mleaseno]" ng-click="OpenOrderNew($event,item.mleaseno,true)">View Order</button>
                                                                <button type="button" class="btn btn-primary vieworder" style="border-radius:0;" ng-show="showOrder[item.mleaseno]" ng-click="OpenOrderNew($event,item.mleaseno,false)">Hide Order</button>
                                                            </div>
                                                            <div class="col-12 mt-2 orderview pl-0 pr-0" ng-show="showOrder[item.mleaseno]">

                                                                <!-- Card -->
                                                                <div class="card mb-1 woocommerce-cart-form__cart-item cart_item border box-shadow-1">
                                                                    <!--<div class="card-header card-collapse bg-transparent-on-hover border-bottom-dark p-0">
                                                                        <div class="col-md-9">
                                                                            <h6 style="color:#333;padding-top:7px;" class="text-left">Order Detail</h6>
                                                                        </div>
                                                                        <div class="col-md-3 mt-2 mb-1">
                                                                            <button class="btn btn-primary vieworder" style="border-radius:0" ng-click="printorder(item)">Print Order</button>
                                                                        </div>

                                                                    </div>-->


                                                                    
                                                                    <div class="col-md-12">
                                                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents" style="margin-bottom:0.75rem" cellspacing="0">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="product-thumbnail">&nbsp;</th>
                                                                                    <th class="product-name">Product Details</th>
                                                                                    <!--<th class="product-price">Unit Price</th>-->
                                                                                    <th class="product-quantity">Quantity</th>
                                                                                    <!--<th class="product-subtotal">VAT</th>-->                                                                                    <th class="product-subtotal">Rental</th>
                                                                                    <th class="product-notes">Status</th>
                                                                                    <!--<th class="product-notes"></th>-->
                                                                                </tr>

                                                                            </thead>
                                                                            <tbody>

                                                                                <tr ng-repeat="item2 in item.Product |  orderBy:item2.mquotestatus:false track by $index" class="woocommerce-cart-form__cart-item cart_item">

                                                                                    <td class="product-thumbnail">
                                                                                        <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">
                                                                                            <img ng-src="/LeaseAdmin/Content/images/product/{{item2.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" style="width:auto;height:50px;" width="300" height="300">
                                                                                        </a>
                                                                                    </td>

                                                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                                                        <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">{{item2.mproductname}}</a>
                                                                                        <span style="font-size: 0.85em;" ng-if="item2.suppliername!=null"><br />Supplier : {{item2.suppliername}}</span>
                                                                                        <!--<br/><button class="btn btn-link" style="border-radius:0;padding-left:0px!important;font-size:11px;padding-top:1px!important;padding-bottom:1px;" ng-click="showOrder[$index]=true;" ng-disabled="item2.mquotestatus!='ldelivered'">Supplier Review</button>-->
                                                                                    </td>
                                                                                    <!--<td class="product-price" data-title="Price">
                                                                                        <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice | number:2}}</span>

                                                                                    </td>-->

                                                                                    <td class="product-quantity" data-title="Quantity" style="width:50px;">
                                                                                        <div class="quantity" style="margin:0 auto;">
                                                                                            <span class="woocommerce-Price-amount amount">{{item2.quantity}}</span>

                                                                                        </div>
                                                                                    </td>
                                                                                    <!--<td class="product-subtotal" data-title="VAT">
                                                                                        <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mvat | number:2}}</span>
                                                                                    </td>-->
                                                                                    <td class="product-subtotal" data-title="Total">
                                                                                        <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice*item2.quantity | number:2}}</span>
                                                                                    </td>
                                                                                    <td data-title="Notes">
                                                                                        {{item2.status=='a'|| item2.status=='rd'||item2.status=='sd'?'Allocated':item2.status=='di'?'Dispatched':item2.status=='de'?'Delivered':'Being Processed'}}
                                                                                    </td>
                                                                                    @*<td data-title="Action">
                                                                <button class="btn btn-primary vieworder" style="border-radius:0"  ng-disabled="item2.mquotestatus!='ldelivered'">Product Review</button>

                                                                <!--<div class="btndropdown dropdown" ng-show="item2.mquotestatus=='ldelivered'">
        <button class="btn btn-brand dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Action
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a ng-click="confirmDeliveryModal(item2.msubquoteid,$index)" class="dropdown-item">Mark Shipped</a>
            <a ng-show="item2.mquotestatus=='confirmed'" class="dropdown-item" href="#">Request to Return</a>
            <a class="dropdown-item" href="#">Product Review</a>
            <a class="dropdown-item" href="#">Supplier Review</a>
        </div>
    </div>-->

                                                            </td>*@
                                                                                </tr>



                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <hr />
                                                                    </div>
                                                                    <div class="card-body pl-0 pb-1 pr-0 pt-1">
                                                                        <div class="row m-0">
                                                                            
                                                                            <div class="col-md-12 border-bottom-gray-1 orderd">
                                                                                <div class="col-md-6 pl-0">
                                                                                    <h6 style="color:#333;" class="text-left"><span class="fontcolorgrey">Payment Mode :</span> {{item.mpayment=='2'?'Direct Debit':'On Invoice'}}</h6>

                                                                                </div>
                                                                                <div class="col-md-6 pr-0">
                                                                                    <p class="mb-0 text-primary text-blue" style="font-size:12px;">*All prices are excl. of VAT</p>

                                                                                </div>
                                                                                
                                                                                <table class="table table1" ng-show="item.mpayment=='2'">
                                                                                    <tbody>
                                                                                        <tr>
                                                                                            <td style="color:#333;"><span class="fontcolorgrey">Bank Name :</span> {{bank.mbankname}}</td>
                                                                                            <td style="color:#333;"><span class="fontcolorgrey">Account No :</span> {{bank.mbankaccount}}</td>
                                                                                            <td style="color:#333;"><span class="fontcolorgrey">Account Holder :</span> {{bank.maccountholder}}</td>
                                                                                            <td style="color:#333;"><span class="fontcolorgrey">Sort Code :</span> {{bank.mbankshort}}</td>
                                                                                            
                                                                                        </tr>
                                                                                        
                                                                                    </tbody>
                                                                                </table>


                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                                <!-- End Card -->
                                                                <!-- Card -->


                                                            </div>
                                                        </div>



                                                    </div>
                                                </div>

                                                <div id="successmsg" class="row" ng-show="showmsg">
                                                    <div class="col-xs-12">
                                                        <div class="alert alert-success" role="alert">
                                                            <h4 class="alert-heading">Well done!</h4>
                                                            <p>Your leasing order successfully saved! Now you can check your order status from your order page.<br />Now,you can view your orders from Go to My Account -> Your order or click below</p>
                                                            <hr>
                                                            <p class="mb-0">Go to <a ng-click="setActiveTab(4)" class="btn btn-primary" style="cursor:pointer;">Your Orders</a></p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div ng-class="getTabPaneClass(4)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1">
                                    <div class="row">
                                        <div ng-show="ActiveAggreements.length<0" class="col-xs-12 nodata">
                                            <div>

                                                <p>No active lease</p>
                                                <hr>
                                                <!--<p class="mb-0">Go to <a href="/Leasing/" class="btn btn-secondary">Shop</a></p>-->
                                            </div>
                                        </div>
                                        <div class="col-xs-12">
                                            <div class="woocommerce" ng-show="ActiveAggreements.length>0">
                                                <div class="row woocommerce-cart-form__cart-item cart_item border box-shadow-1 aggreementrow mt-5" style="margin-left:0px;margin-right:0px;" ng-repeat="item in ActiveAggreements track by $index ">
                                                    <div class="col-12" style="padding-right:5px;border-left:0px solid #a7a7a7">
                                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents maintable" cellspacing="0">
                                                            <thead>
                                                                <tr>

                                                                    <th class="product-subtotal" style="text-align:center;">Date</th>
                                                                    <th style="width:100px;" class="product-name">Order No</th>
                                                                    <th style="width:100px;" class="product-name">Your PO No</th>
                                                                    <th class="product-name">Lease Term</th>
                                                                    <th class="product-subtotal">Items</th>
                                                                    <th class="product-subtotal" style="text-align:center;">Total</th>
                                                                    <th class="product-subtotal" style="text-align:center;">Printed By</th>
                                                                    <th class="product-subtotal" style="text-align:center;">Print Agreement</th>
                                                                    <th class="product-subtotal" style="text-align:center;"></th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>

                                                                <tr id="trq{{item.mleaseid}}" ng-init="showOrder2[$index]=false">

                                                                    <td align="center" class="product-subtotal" style="word-wrap: break-word;white-space:nowrap;" data-title="Product">{{item.displaydate}}</td>
                                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">{{item.mleaseno}}</td>
                                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">{{item.msorderref}}</td>
                                                                    <td>{{getTerms(item.Product[0].mtermf,item.Product[0].mtermp)}}</td>
                                                                    <td style="white-space:nowrap" align="center" ng-show="showOrder2[$index]==true;">
                                                                        <strong>{{item.Product.length}}</strong><br /><button class="iconbtn iconsmallbtn border-0" style="border-radius:0" ng-click="showOrder2[$index]=false;OpenOrder(item.Product,item.mpayment)"><i class="fa fa-eye"></i></button>
                                                                    </td>
                                                                    <td style="white-space:nowrap;" align="center" ng-show="showOrder2[$index]==false;">
                                                                        <strong>{{item.Product.length}}</strong><br /><button class="iconbtn iconsmallbtn border-0" style="border-radius:0" ng-click="showOrder2[$index]=true;OpenOrder(item.Product,item.mpayment)"><i class="fa fa-eye"></i></button>
                                                                        <!--<button class="iconbtn btn-primary border-0" style="border-radius:0" ng-show="showOrder[$index]==false;" ng-click="showOrder[$index]=true;OpenOrder(item.Product,item.mpayment)">{{item.Product.length}}</button>
                                                                        <button class="iconbtn btn-primary border-0" style="border-radius:0" ng-show="showOrder[$index]==true;" ng-click="showOrder[$index]=false;OpenOrder(item.Product,item.mpayment)">{{item.Product.length}}</button>-->
                                                                    </td>
                                                                    <td align="center" class="product-name" style="word-wrap: break-word;white-space:normal;width:100px;" data-title="Product">£{{item.total}}<br /> <span class="pm" style="font-size:10px">{{ getNewTerms(item.Product[0].mtermf,item.Product[0].mtermp) }}</span></td>
                                                                    <td align="center">{{item.mprintby}}<br />{{item.mprintdate |  date:"dd/MM/yyyy"}}</td>
                                                                    <td align="center" data-title="Status">

                                                                        <button type="button" class="iconbtn btn-danger rounded" ng-click="getLeasePdf(item.mleaseid)" title="View Aggreement"> <i class="fa fa-print"></i></button>

                                                                    </td>
                                                                    <td align="center">
                                                                        <button class="btn btn-primary" ng-show="showOrder2[$index]==false" ng-click="showOrder2[$index]=true;">View Order</button>
                                                                        <button class="btn btn-primary" ng-show="showOrder2[$index]==true" ng-click="showOrder2[$index]=false;">View Order</button>
                                                                    </td>

                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <div class="col-lg-12 mt-2" ng-show="showOrder2[$index]">

                                                        <!-- Card -->
                                                        <div class="card mb-3 woocommerce-cart-form__cart-item cart_item border box-shadow-1">
                                                            <div class="card-header card-collapse bg-transparent-on-hover border-bottom-dark p-0">
                                                                <div class="col-md-12">
                                                                    <h3 style="color:#333;">Order Detail</h3>
                                                                </div>



                                                            </div>

                                                            <div class="card-body pl-0 pb-8 pr-0">
                                                                <div class="row m-0">
                                                                    <div class="col-md-12 border-bottom-gray-1">
                                                                        <h6 style="color:#333;">Payment Mode : {{item.mpayment=='2'?'Direct Debit':'On Invoice'}}</h6>

                                                                        <table class="table" ng-show="item.mpayment=='2'">
                                                                            <tbody>
                                                                                <tr>
                                                                                    <td style="color:#333;width:200px;">Bank Name</td>
                                                                                    <td><label class="form-label">{{bank.mbankname}}</label></td>
                                                                                    <td style="color:#333;width:200px;">Account No.</td>
                                                                                    <td><label class="form-label">{{bank.mbankaccount}}</label></td>
                                                                                </tr>
                                                                                <tr>
                                                                                    <td style="color:#333;width:200px;">Account Holder</td>
                                                                                    <td><label class="form-label">{{bank.maccountholder}}</label></td>
                                                                                    <td style="color:#333;width:200px;">Bank Sort Code</td>
                                                                                    <td><label class="form-label">{{bank.mbankshort}}</label></td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>


                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <hr />
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <table class="shop_table shop_table_responsive cart woocommerce-cart-form__contents" cellspacing="0">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="product-thumbnail">&nbsp;</th>
                                                                                    <th style="width:150px;" class="product-name">Product Details</th>
                                                                                    <th class="product-price">Price</th>
                                                                                    <th class="product-quantity">Quantity</th>
                                                                                    <th class="product-subtotal">VAT</th>
                                                                                    <th class="product-subtotal">Total</th>
                                                                                    <th class="product-notes">Notes</th>
                                                                                    <th class="product-notes"></th>
                                                                                </tr>

                                                                            </thead>
                                                                            <tbody>

                                                                                <tr ng-repeat="item2 in item.Product |  orderBy:item2.mquotestatus:false track by $index" class="woocommerce-cart-form__cart-item cart_item">

                                                                                    <td class="product-thumbnail">
                                                                                        <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">
                                                                                            <img ng-src="/LeaseAdmin/Content/images/product/{{item2.subpicname || 'leasenoimage.png'}}" class="attachment-woocommerce_thumbnail size-woocommerce_thumbnail" alt="" style="width:auto;height:50px;" width="300" height="300">
                                                                                        </a>
                                                                                    </td>

                                                                                    <td class="product-name" style="word-wrap: break-word;white-space:normal;" data-title="Product">
                                                                                        <a href="/Leasing/ProductDetail?{{item2.mproducturl}}" target="_blank">{{item2.mproductname}}</a>
                                                                                    </td>
                                                                                    <td class="product-price" data-title="Price">
                                                                                        <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice | number:2}}</span>

                                                                                    </td>

                                                                                    <td class="product-quantity" data-title="Quantity" style="width:50px;">
                                                                                        <div class="quantity" style="margin:0 auto;">
                                                                                            <span class="woocommerce-Price-amount amount">{{item2.quantity}}</span>

                                                                                        </div>
                                                                                    </td>
                                                                                    <td class="product-subtotal" data-title="VAT">
                                                                                        <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mvat | number:2}}</span>
                                                                                    </td>
                                                                                    <td class="product-subtotal" data-title="Total">
                                                                                        <span class="woocommerce-Price-amount amount"><span class="woocommerce-Price-currencySymbol">£</span>{{item2.mprice*item2.quantity+item2.mvat | number:2}}</span>
                                                                                    </td>
                                                                                    <td data-title="Notes">
                                                                                        {{item2.mnotes}}
                                                                                    </td>
                                                                                    <td data-title="Action">
                                                                                        <button class="btn btn-primary" ng-click="showOrder[$index]=true;" ng-disabled="item2.mquotestatus!='ldelivered'">Product Review</button>
                                                                                        <button class="btn btn-primary" ng-click="showOrder[$index]=true;" ng-disabled="item2.mquotestatus!='ldelivered'">Supplier Review</button>
                                                                                        <!--<div class="btndropdown dropdown" ng-show="item2.mquotestatus=='ldelivered'">
                                                                                            <button class="btn btn-brand dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                                                Action
                                                                                            </button>
                                                                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                                                                <a ng-click="confirmDeliveryModal(item2.msubquoteid,$index)" class="dropdown-item">Mark Shipped</a>
                                                                                                <a ng-show="item2.mquotestatus=='confirmed'" class="dropdown-item" href="#">Request to Return</a>
                                                                                                <a class="dropdown-item" href="#">Product Review</a>
                                                                                                <a class="dropdown-item" href="#">Supplier Review</a>
                                                                                            </div>
                                                                                        </div>-->

                                                                                    </td>
                                                                                </tr>



                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </div>
                                                        <!-- End Card -->
                                                        <!-- Card -->


                                                    </div>
                                                </div>




                                            </div>




                                        </div>
                                        <
                                        <div id="successmsg" class="row" ng-show="showmsg">
                                            <div class="col-xs-12">
                                                <div class="alert alert-success" role="alert">
                                                    <h4 class="alert-heading">Well done!</h4>
                                                    <p>Your leasing order successfully saved! Now you can check your order status from your order page.<br />Now,you can view your orders from Go to My Account -> Your order or click below</p>
                                                    <hr>
                                                    <p class="mb-0">Go to <a ng-click="setActiveTab(4)" class="btn btn-primary" style="cursor:pointer;">Your Orders</a></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div ng-class="getTabPaneClass(5)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1">
                                    <div class="row">
                                        <div class="col-xl-12 nodata">
                                            <p> No wishlist found</p>
                                        </div>
                                    </div>
                                </div>
                                <div ng-class="getTabPaneClass(6)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1">
                                    <div class="row">
                                        <div class="col-xl-12 nodata">
                                            <p> No message found</p>
                                        </div>
                                    </div>
                                </div>
                                <div ng-class="getTabPaneClass(7)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1 profile-tab">
                                    <div class="viewprofile" ng-show="!edituser && !tabloading">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="border-bottom border-color-1 mb-3">

                                                    <h3 class="section-title mb-0 pb-0">
                                                        Your details
                                                        <button class="btn btn-primary pull-right" style="cursor:pointer;" ng-click="showhideprofile(1)" ng-show="!edituser">Edit Profile</button>
                                                    </h3>

                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>School Name</label>
                                            </div>
                                            <div class="col-md-8">
                                                <label class="unbold">{{userd.morgname}}</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12"><hr /></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label >Name</label>
                                            </div>
                                            <div class="col-md-8">
                                                <label class="unbold">{{userd.mname}} {{userd.msname}}</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12"><hr /></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Email(UserName)</label>
                                            </div>
                                            <div class="col-md-8">
                                                <label class="unbold">{{userd.museridemail}}</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12"><hr /></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Position</label>
                                            </div>
                                            <div class="col-md-8">
                                                <label class="unbold">{{userd.mposition}}</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12"><hr /></div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Contact Number</label>
                                            </div>
                                            <div class="col-md-8">
                                                <label class="unbold">{{userd.mphone}}</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12"><hr /></div>
                                        </div>


                                    </div>
                                    <div class="editprofile" ng-show="edituser">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="border-bottom border-color-1 mb-5">

                                                    <h3 class="section-title mb-0 pb-2">
                                                        Your details
                                                        <button class="btn btn-primary pull-right" style="cursor:pointer;" ng-click="showhideprofile(2)" ng-show="edituser">Back</button>
                                                    </h3>

                                                </div>
                                            </div>

                                        </div>
                                        <form class="rform js-validate" name="form" ng-submit="UserSaveData(form.$valid)" novalidate>

                                            <div>


                                                <div class="row">
                                                    <!-- Title -->
                                                    <!-- End Title -->
                                                    <!-- Billing Form -->
                                                    <div class="col-md-12">
                                                        <p style="color:#ae0404">All fields mark (*) are compulsory</p>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <!-- Input -->
                                                        <div class="js-form-message mb-6">
                                                            <label class="form-label">
                                                                School Name
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="text" class="form-control" ng-model="userd.morgname" name="companyName" placeholder="Company Name" aria-label="Company Name" data-msg="Please enter a company name." validate-on="blur" required required-message="'Please enter father name.'" data-error-class="u-has-error" data-success-class="u-has-success">
                                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.companyName.$touched) && form.companyName.$error.required">Enter detail</div>

                                                        </div>

                                                        <!-- End Input -->
                                                    </div>
                                                    <div class="col-md-3">
                                                        <!-- Input -->
                                                        <div class="js-form-message mb-6">
                                                            <label class="form-label">
                                                                First Name
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="text" maxlength="100" class="form-control" ng-model="userd.mname" name="Name" placeholder="First Name" aria-label="Wayley" required="" data-msg="Please enter your last name." data-error-class="u-has-error" data-success-class="u-has-success">
                                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.Name.$touched) && form.Name.$error.required">Enter detail</div>
                                                        </div>
                                                        <!-- End Input -->
                                                    </div>
                                                    <div class="col-md-3">
                                                        <!-- Input -->
                                                        <div class="js-form-message mb-6">
                                                            <label class="form-label">
                                                                SurName
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="text" maxlength="100" class="form-control" ng-model="userd.msname" name="SName" placeholder="SurName" aria-label="Wayley" required="" data-msg="Please enter your last name." data-error-class="u-has-error" data-success-class="u-has-success">
                                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.SName.$touched) && form.SName.$error.required">Enter detail</div>
                                                        </div>
                                                        <!-- End Input -->
                                                    </div>

                                                    <div class="w-100"></div>
                                                    <div class="col-md-6">
                                                        <!-- Input -->
                                                        <div class="js-form-message mb-6">
                                                            <label class="form-label">
                                                                Position
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="text" maxlength="100" class="form-control" ng-model="userd.mposition" name="Position" placeholder="Position" aria-label="Wayley" required="" data-msg="Please enter your last name." data-error-class="u-has-error" data-success-class="u-has-success">
                                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.Position.$touched) && form.Position.$error.required">Enter detail</div>
                                                        </div>
                                                        <!-- End Input -->
                                                    </div>

                                                    <div class="col-md-6">
                                                        <!-- Input -->
                                                        <div class="js-form-message mb-6">
                                                            <label class="form-label">
                                                                Contact Number
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="text" maxlength="20" class="form-control" ng-model="userd.mphone" name="Phone" required placeholder="Phone" aria-label="+1 (062) 109-9222" data-msg="Please enter your last name." data-error-class="u-has-error" data-success-class="u-has-success">
                                                            <div class="invalid-feedback" ng-show="(form.$submitted || form.Phone.$touched) && form.Phone.$error.required">Enter detail</div>
                                                        </div>
                                                        <!-- End Input -->
                                                    </div>
                                                    <div class="w-100"></div>

                                                    <div class="col-md-12">
                                                        <!-- Input -->
                                                        <div class="js-form-message mb-6">
                                                            <label class="form-label">
                                                                Email address (Login Id)
                                                                <span class="text-danger">*</span>
                                                            </label>
                                                            <input type="email" maxlength="150" disabled class="form-control" ng-model="userd.museridemail" ng-change="checkuser(userd.museridemail,'0')" name="emailA" placeholder="jackwayley@gmail.com" aria-label="jackwayley@gmail.com" required="" data-msg="Please enter a valid email address." data-error-class="u-has-error" data-success-class="u-has-success">

                                                        </div>
                                                        <!-- End Input -->
                                                    </div>
                                                </div>


                                            </div>

                                            <div class="row" ng-show="form.$submitted && (!validuser)">
                                                <div class="w-100"></div>

                                                <div class="col-md-12">
                                                    <div class="alert alert-danger">
                                                        Please fill  all * mark information or fill correct information in the form.
                                                    </div>
                                                </div>
                                            </div>



                                            <div class="row">
                                                <div class="w-100"></div>
                                                <div class="col-md-12">
                                                    <button type="submit" ng-disabled="form.$invalid || rsubmitted" class="btn btn-primary-dark-w btn-block btn-pill font-size-20 mb-3 py-3">{{usubmitText}}</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>

                                </div>
                                <div ng-class="getTabPaneClass(8)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1">
                                    <div class="row mb-2">
                                        <div class="col-lg-12">
                                            <button class="btn btn-primary pull-right" ng-click="AddNewAddress()">Add New</button>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 m-1 border box-shadow-1" ng-repeat="addr in alladdress">
                                            <div class="header-icons myheadricons">

                                                <div class="header-icon ml-0 mr-3" style="height:auto;" data-placement="bottom" data-toggle="tooltip" data-title="Compare" data-original-title="" title="">
                                                    <a href="javascript:;" ng-show="addr.maddresstype!='Default'" ng-click="SetDefaultAddress(addr.museraddrid)">
                                                        Set Default
                                                    </a>
                                                    <span ng-show="addr.maddresstype=='Default'" style="color:#b7b7b7;">Default Address</span>
                                                </div>
                                                <div class="header-icon ml-0 mr-3" style="height:auto;" data-toggle="tooltip" data-placement="bottom" data-title="Wishlist" data-original-title="" title="">
                                                    <a href="javascript:;" title="Edit Address" ng-click="ChangeAddress(addr.museraddrid)" style="font-size:8px;">
                                                        <i class="fa fa-edit"></i>
                                                    </a>
                                                </div>
                                                <div class="header-icon ml-0 mr-3" style="color:#333;height:auto;" data-toggle="tooltip" data-placement="bottom" data-title="Notification" data-original-title="" title="">
                                                    <a href="javascript:;" title="Delete Address" ng-click="DeleteAddress(addr.museraddrid)" style="font-size: 1em;">
                                                        X

                                                    </a>
                                                </div>

                                            </div>
                                            <hr class="mt-1 mb-1" />
                                            <label class="m-option w-100 border-0">
                                                <span class="m-option__label">
                                                    <span class="m-option__body">
                                                        <span ng-show="addr.maddress1">{{addr.maddress1}}<br /></span>
                                                        <span ng-show="addr.maddress2">{{addr.maddress2}}<br /></span>
                                                        <span>{{addr.mcity}} - {{addr.mpostcode}}</span><br />

                                                    </span>
                                                </span>
                                            </label>

                                        </div>
                                    </div>
                                </div>
                                <div ng-class="getTabPaneClass(10)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1">
                                    <div class="row mb-2">
                                        <div class="col-lg-12">
                                            <button class="btn btn-primary pull-right" ng-click="AddNewContact()">Add New</button>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-3 m-1 border box-shadow-1" ng-repeat="cnt in allcontacts">
                                            <div class="header-icons myheadricons">

                                                <div class="header-icon ml-0 mr-3" style="height:auto;" data-placement="bottom" data-toggle="tooltip" data-original-title="" title="">
                                                    <a href="javascript:;" ng-show="cnt.cdefault!=1" ng-click="SetDefaultContact(cnt.Id)">
                                                        Set Default
                                                    </a>
                                                    <span ng-show="addr.maddresstype=='Default'" style="color:#b7b7b7;">Default Address</span>
                                                </div>
                                                <div class="header-icon ml-0 mr-3" style="height:auto;" data-toggle="tooltip" data-placement="bottom" data-original-title="" title="">
                                                    <a href="javascript:;" title="Edit Contact" ng-click="ChangeContact(cnt.Id)" style="font-size:8px;">
                                                        <i class="fa fa-edit"></i>
                                                    </a>
                                                </div>
                                                <div class="header-icon ml-0 mr-3" ng-hide="allcontacts.length<=1" style="height:auto;" style="color:#333" data-toggle="tooltip" data-placement="bottom" data-title="Notification" data-original-title="" title="">
                                                    <a href="javascript:;" title="Delete Address" ng-click="DeleteContact(cnt.Id)" style="font-size: 1em;">
                                                        X

                                                    </a>
                                                </div>

                                            </div>
                                            <hr class="mt-1 mb-1" />
                                            <label class="m-option w-100 border-0">
                                                <span class="m-option__label">
                                                    <span class="m-option__body">
                                                        <span ng-show="cnt.cusername">{{cnt.cusername}} {{cnt.csurname}}<br /></span>
                                                        <span ng-show="cnt.cposition">{{cnt.cposition}}</span><br />
                                                        <span ng-show="cnt.cemailaddress">{{cnt.cemailaddress}}<br /></span>
                                                        <span ng-show="cnt.cphone">{{cnt.cphone}}</span><br />

                                                    </span>
                                                </span>
                                            </label>

                                        </div>
                                    </div>
                                </div>
                                <div ng-class="getTabPaneClass(9)" id="order-md" role="tabpanel" aria-labelledby="order-tab-md" class="border box-shadow-1">
                                    <div class="row">
                                        <div class="col-xl-12 nodata">
                                            <p> Data available soon</p>
                                        </div>
                                    </div>
                                </div>



                            </div>

                        </div>
            </div>

            <iframe id="printf" name="printf" style="display:none;width:800px;top:10px;left:20px;right:20px;"></iframe>
            <div ng-include id="invoice-box" src="'/templates/printorder.html'" style="display:none;"></div>


            </article>
            </main>
        </div>
    </div>
</div>
</div>
@section scripts{
    <script src="~/Content/js/pdf/jspdf.customfonts.min.js"></script>

    <script src="~/Content/js/pdf/poscript.js"></script>
    <script src="~/Content/bootstrap/bootstrap-datepicker.js"></script>
    <script src="~/Content/js/jspdf.min.js"></script>
    <script src="~/Content/js/html2canvas.js"></script>
    @if (ViewBag.msg == "Success")
    {
        <script>

            toastr.success("agreement send status updated successfully", "Success");


        </script>
    }

    <script type="text/javascript">
        jQuery(".popover__title").click(function () {
            alert("click");
        })
        function openpopover(e) {
            //alert("hello");
            var data = jQuery(e).parent().prev("ul").html();
            jQuery(e).parent().addClass("content");
            var popovercontent = jQuery(e).parent().find(".popover__content");
            popovercontent.html("");
            //popovercontent.append();
            popovercontent.append("<div class='popover__close' onclick='closepopover(this)'>X</div><ul id='progressbar' class='quoteprogress'>" + data + "</ul>");
            //popovercontent.append("</ul>");

            //alert(data);
        }
        function closepopover(e) {

            jQuery(e).parent().parent().removeClass("content");
        }
        app.directive("compareTo", function () {
            return {
                require: "ngModel",
                scope:
                {
                    confirmPassword: "=compareTo"
                },
                link: function (scope, element, attributes, modelVal) {
                    modelVal.$validators.compareTo = function (val) {
                        return val == scope.confirmPassword;
                    };
                    scope.$watch("confirmPassword", function () {
                        modelVal.$validate();
                    });
                }
            };
        });
        app.controller('QuotationController', ['filterFilter', '$anchorScroll', '$scope', '$http', '$rootScope', '$location', '$sce', '$cookies', '$window', 'FileUploader','$filter', function (filterFilter, $anchorScroll, $scope, $http, $rootScope, $location, $sce, $cookies, $window, FileUploader,$filter) {
            $scope.tab = "@activetab";
            $rootScope.Quotations = [];
            $scope.emptyaggreement = false;
            $scope.emptyactiveaggreement = false;
            $scope.PendingSignAggreements = [];
            $scope.Aggreements = [];
            $scope.ActiveAggreements = [];
            $scope.aggreements = [];
            $scope.IsLogedIn = false;
            $scope.loader = true;
            $scope.dataloading = false;
            $scope.tabloading = false;
            $scope.generateagreement = false;
            $scope.msubquote = 0;
            $scope.position = 0;
            $scope.bootmsg = "";
            $scope.bootdetailmsg = "";
            $scope.boottab = 0;
            $scope.replaceProduct = 0;
            $scope.showmodel = "";
            $scope.nextstep = true;
            $scope.edate = "@(DateTime.Now.ToString("yyyy-MM-dd"))";
            $scope.condition = "";
            $scope.morder1 = 0;
            $scope.sizes = [{ code: 1, name: 'Monthly' }, { code: 3, name: 'Quaterly' }, { code: 4, name: 'Termly' }, { code: 6, name: 'Bi-annually' }, { code: 12, name: 'Annually' }]
            $scope.periods = [{ code: 60, name: '5 years' }, { code: 48, name: '4 years' }, { code: 36, name: '3 years' }, { code: 24, name: '2 years' }, { code: 12, name: '1 years' }]
            $scope.selected = [];
            $scope.leaseselected = [];
            $scope.mnotes = "";
            $scope.SelectedQuotesApprove = [];
            $scope.UserData = [];
            $scope.agreementdata = [];
            $scope.IsChecked = {};
            $scope.IsClicked = false;
            $scope.getSubProducts = [];
            $scope.tabCount = ["", "", "", "", ""];
            $scope.breadcum = "Your Lease Basket";
            $scope.pagetitle = "Your Lease Basket";
            $scope.msgcounter = 0;
            $scope.agreecounter = 0;
            $scope.pendingagreecounter = 0;
            $scope.schoolReference = "";
            $scope.mainemptyref = false;
            $scope.leadtime = 14;
            $scope.deliverytime = 3;
            $scope.itemsmodels = {};
            $scope.morderref = {};
            $scope.payment = 1;
            $scope.ItemM = [];
            $scope.modalAggreements = [];
            $scope.bankfound = false;
            $scope.mleaseall = {};
            $scope.hideclose = false;
            $scope.ScanCopy = 0;
            $scope.DocUpload = false;
            $scope.edituser = false;
            $scope.showOrder = [];
            $scope.bank = {
                "muserid": "",
                "mbankname": "",
                "mbankaccount": "",
                "maccountholder": "",
                "mbankshort": "",
            };
            var accountId = "";
            var envelopId = "";
            var documentid = "";
            $scope.min = function (arr) {
                
                return ($filter('min')($filter('map')(arr, '-mleaseno')));
            }

            $http.get("/api/LeaseBankApi/GetBankById?muserid=" + $rootScope.mschoolid).success(function (data, status) {
                if (data != "empty") {
                    $scope.bank = data;
                    $scope.bankfound = true;
                } else {
                    $scope.bank = {
                        "muserid": "",
                        "mbankname": "",
                        "mbankaccount": "",
                        "maccountholder": "",
                        "mbankshort": "",
                    };
                }
            });
            //$scope.item = {};
            $scope.toggleIcon = function ($event) {
                console.log($event.target);
                jQuery($event.target).parent().find(".more-less").toggleClass('fa-plus fa-minus');
            };
            $scope.leaseModal = {
                title: "Warning!!!",
                message: "Are you sure you want to delete?",
                buttons: [{
                    label: "Delete",
                    action: "delete"
                }]
            };
            $scope.confirmationDialogConfig = {
                title: "Caution!!!",
                message: "Are you sure you want to delete?",
                buttons: [{
                    label: "Delete",
                    action: "delete"
                }]
            };
            if ($rootScope.muserid > 0) {
                $scope.IsLogedIn = true;
            }
            else {
                $window.location.href = "/Leasing/";
            }
            function initTabs() {
                tabClasses = ["nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link", "nav-link","nav-link"];
                tabPaneClasses = ["", "", ""];

            }

            function getCounter() {
                $http.get('/api/QuotationApi/GetTotalNumberId?getid=' + $rootScope.mschoolid).success(function (data) {
                    if (data.length > 0) {
                        $scope.agreecounter = data[0];
                        $scope.pendingagreecounter = data[3];
                        $scope.tabCount[1] = data[1];
                        $scope.tabCount[2] = data[2];
                        //$scope.tabCount[3] = data[3];
                        //$scope.tabCount[4] = data[4];
                    }
                });
            }

            //loadquotes();

            function loadquotes() {
                //alert("called");
                $http.get('/api/QuotationApi/GetQuoteById?getid=' + $rootScope.mschoolid).success(function (data) {
                    console.log(data);
                    if (data.length <= 0) {
                        $scope.emptyquote = true;
                        $scope.Quotes = [];
                    }
                    else {
                        $scope.leaseselected = [];
                        $scope.emptyquote = false;
                        $scope.Quotes = data;
                        $scope.QuotesApprove = data;
                        setTimeout(function () {
                            for (var i = 0; i < data.length; i++) {
                                //$scope.getSubProducts2(data[i]);
                                var termf = ".termf1" + data[i].mprodvarid;
                                var termp = ".termp1" + data[i].mprodvarid;

                                jQuery(termf).val(data[i].mtermf);
                                jQuery(termp).val(data[i].mtermp);
                            }
                        }, 100);

                    }
                    //getCounter();
                    $scope.loader = false;


                });

            }
            $scope.getVolumeSum = function (items) {
                return items
                    .map(function (x) { return (x.mprice * x.quantity).toFixed(2); })
                    .reduce(function (a, b) { return (Number(a) + Number(b)).toFixed(2); });
            };
            function getpendingsignaggreements() {
                $scope.tabloading = true;
                $http.get('/api/AggreementApi/GetPendingSignAggreementById?getid=' + $rootScope.mschoolid).success(function (data) {

                    if (data == "empty") {
                        //$scope.emptyaggreement = false;
                        $scope.PendinSignAggreements = [];

                    }
                    if (data.length <= 0) {
                        //$scope.emptyaggreement = false;
                        $scope.PendingSignAggreements = [];
                    }
                    else {
                        //$scope.emptyaggreement = false;

                        $scope.PendingSignAggreements = data;

                    }
                    getCounter();
                    $scope.loader = false;
                    $scope.tabloading = false;


                });
            }
            function getaggreements() {
                $scope.tabloading = true;
                $http.get('/api/AggreementApi/GetAggreementById?getid=' + $rootScope.mschoolid).success(function (data) {

                    if (data == "empty") {
                        $scope.emptyaggreement = false;
                        $scope.Aggreements = [];

                    }
                    if (data.length <= 0) {
                        $scope.emptyaggreement = false;
                        $scope.Aggreements = [];
                    }
                    else {
                        $scope.emptyaggreement = false;

                        $scope.Aggreements = data;
                        
                    }
                    getCounter();
                    $scope.loader = false;
                    $scope.tabloading = false;


                });
            }
            $scope.getactiveaggreements = function () {
                $scope.tabloading = true;
                $http.get('/api/AggreementApi/GetActiveAggreementById?getid=' + $rootScope.mschoolid).success(function (data) {
                    console.log(data);

                    if (data == "empty") {
                        $scope.emptyactiveaggreement = false;
                        $scope.ActiveAggreements = [];

                    }
                    if (data.length <= 0) {
                        $scope.emptyactiveaggreement = false;
                        $scope.ActiveAggreements = [];
                    }
                    else {
                        $scope.emptyactiveaggreement = false;

                        $scope.ActiveAggreements = fnConverDate(data);

                    }
                    getCounter();
                    $scope.tabloading = false;


                });
            }
            $scope.getSchoolRef = function (getid) {
                //$scope.tabloading = true;
                console.info("GetId", getid);
                /*$http.get('/api/OrderApi/GetSchoolOrderRef?getid=' + getid).success(function (data) {
                     return data;

                 });*/
            }

            $scope.getTabClass = function (tabNum) {
                return tabClasses[tabNum];
            };

            $scope.getTabPaneClass = function (tabNum) {
                return "tab-pane fade" + tabPaneClasses[tabNum];
            }
            //loadcompareproducts();

            $scope.agorder = [];
            $scope.OpenOrderNew = function ($event, $index, flag) {
                $scope.dataloading = true;
                $event.preventDefault();
                $scope.showOrder[$index] = flag;
                $scope.dataloading = false;
                
            }
            $scope.OpenOrder = function (item, mpayment, msorderref) {
                $scope.agorder = item;
                $scope.payment = mpayment;
                $scope.msorderref = msorderref
                $http.get("/api/LeaseBankApi/GetBankById?muserid=" + $rootScope.mschoolid).success(function (data, status) {
                    if (data != "empty") {
                        $scope.bank = data;
                        $scope.bankfound = true;
                    } else {
                        $scope.bank = {
                            "muserid": "",
                            "mbankname": "",
                            "mbankaccount": "",
                            "maccountholder": "",
                            "mbankshort": "",
                        };
                    }
                });
                //jQuery("#agreementorder-dialog .modal").modal('show');
            }
            $scope.OpenPurchaseOrder = function (msorderref) {
                $scope.dataloading = true;
                $scope.msorderref = msorderref
                $http({
                    method: "POST",
                    url: "/Order/ViewPurchaseOrder/",
                    data: { "msorderref": msorderref, "mschoolid": $rootScope.mschoolid }
                }).success(function (data) {
                    jQuery("#agreementmodal .modal-title").html("Purchse Order");
                    var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                    //iframe.src = blobURL;
                    var iframe = document.getElementById('printf3');
                    iframe.src = blobURL + "#zoom=100";
                    
                    jQuery("#agreementmodal .modal").modal({

                        "show": true
                    });

                    $scope.dataloading = false;
                    //$scope.setActiveTab(3);
                });
                //jQuery("#agreementorder-dialog .modal").modal('show');
            }
            $scope.deleteagreement = function (msorderref, mleaseno) {
                if (confirm("Do you want to delete this agreement?")) {
                    $scope.dataloading = true;
                    //$scope.msorderref = msorderref
                    $http({
                        method: "POST",
                        url: "/Order/DeletePendingDocument/",
                        data: { "envelopId": msorderref, "documentid": mleaseno }
                    }).success(function (data) {
                        console.log(data);
                        if (data["st"] == "done") {
                            getpendingsignaggreements();
                            $scope.dataloading = false;
                        }
                        
                    });
                }
                
            };
            $scope.loadDocusign = function (msorderref, mleaseno) {
                $scope.dataloading = true;
                //$scope.msorderref = msorderref
                $http({
                    method: "POST",
                    url: "/Order/PendingDocument/",
                    data: { "envelopId": msorderref, "documentid": mleaseno }
                }).success(function (data) {

                    if (data["url"] != "" && data["url"] != null && data["st"]=="pending") {
                        var DocumentContainer = data;
                        var blobURL = data["url"];
                        //iframe.src = blobURL;
                        accountId = data["accountId"];
                        envelopId = data["envelopid"];
                        documentid = data["mleaseid"];
                        jQuery("#agreementmodal .modal-title").html("Lease Agreements");
                        //jQuery("#agreementmodal .modal-body").html(data);
                        //var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                        //iframe.src = blobURL;
                        var iframe = document.getElementById('printf3');
                        iframe.src = blobURL + "#zoom=100";
                        window.addEventListener("message", sendMessage, false);

                        jQuery("#agreementmodal .modal").modal({

                            "show": true
                        }).on("hide.bs.modal", function () {
                            getpendingsignaggreements();
                        });

                        $scope.dataloading = false;
                        
                    } else if (data["st"] == "done") {
                        alert("You already sign this agreement.");
                        var blobURL = URL.createObjectURL(b64toBlob(data["url"], "application/pdf"));
                        var iframe = document.getElementById('printf3');
                        iframe.src = blobURL + "#zoom=100";
                        jQuery("#agreementmodal .modal-title").html("Lease Agreements");
                        jQuery("#agreementmodal .modal").modal({

                            "show": true
                        });

                        getpendingsignaggreements();

                        $scope.dataloading = false;
                    }
                    else {
                        alert("Something went wrong!Please try again.");
                        jQuery("#msgModal").modal("hide");
                        $scope.dataloading = false;
                    }
                            
                }).failed(function () {
                    alert("Your request is failed. Please try again.");
                });
                    
               
                //jQuery("#agreementorder-dialog .modal").modal('show');
            }
            $scope.getDocusignpdf = function (msorderref, mleaseno,mleaseid) {
                $scope.dataloading = true;
                //$scope.msorderref = msorderref
                $http.post("/api/AggreementApi/updateLastPrint?mleaseid=" + mleaseid + "&muserid=" + $rootScope.muserid).success(function (data, status) {
                    $http({
                        method: "POST",
                        url: "/Order/getDocusignpdf/",
                        data: { "envelopId": msorderref, "documentid": mleaseno }
                    }).success(function (data) {

                        if (data["url"] != "" && data["url"] != null && data["st"] == "done") {
                            var DocumentContainer = data;

                            var blobURL = URL.createObjectURL(b64toBlob(data["url"], "application/pdf"));
                            var iframe = document.getElementById('printf3');
                            iframe.src = blobURL + "#zoom=100";
                            jQuery("#agreementmodal .modal-title").html("Lease Agreements");
                            jQuery("#agreementmodal .modal").modal({

                                "show": true
                            });

                            $scope.dataloading = false;

                        }
                        else {
                            alert("Something went wrong!Please try again.");
                            jQuery("#msgModal").modal("hide");
                            $scope.dataloading = false;
                        }

                    })
                });

                //jQuery("#agreementorder-dialog .modal").modal('show');
            }
            function sendMessage(e) {
                //jQuery("#agreementmodal2 .modal").modal('hide');
                $http({
                    method: "POST",
                    url: "/Order/LoadDocument/",
                    data: { "accountId": accountId, "envelopId": envelopId, documentid: documentid }
                }).success(function (data) {
                    var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                    var iframe = document.getElementById('printf3');
                    iframe.src = blobURL + "#zoom=100";
                });

            }
            $scope.getorders = function () {
                $scope.tabloading = true;
                $http.get('/api/OrderApi/GetNewOrder?getid=' + $rootScope.mschoolid).success(function (data) {

                    if (data.length <= 0) {
                        $scope.emptyorder = false;
                        $scope.Orders = [];
                    }
                    else {
                        $scope.Orders = data;
                        $scope.emptyorder = false;
                    }
                    // getCounter();
                    $scope.tabloading = false;


                });
            }

            /***********************Date Conversiong**********************/
            var iso8601RegEx = /(19|20|21)\d\d([-/.])(0[1-9]|1[012])\2(0[1-9]|[12][0-9]|3[01])T(\d\d)([:/.])(\d\d)([:/.])(\d\d)/;

            function fnConverDate(input) {
                if (typeof input !== "object") return input;

                for (var key in input) {
                    if (!input.hasOwnProperty(key)) continue;

                    var value = input[key];
                    var type = typeof value;
                    var match;
                    if (type == 'string' && (match = value.match(iso8601RegEx))) {
                        input[key] = new Date(value)
                    }
                    else if (type === "object") {
                        fnConverDate(value);
                    }
                }
            }

            $scope.toggle = function (item, list, quote) {
                var idx = list.indexOf(item);
                quote.Selected = !quote.Selected;
                if (idx > -1) {
                    list.splice(idx, 1);

                }
                else {
                    list.push(item);


                }
            };

            $scope.exists = function (item, list, quote) {
                return list.indexOf(item) > -1;
            };
            $scope.leasetoggle = function (item, list, quote) {

                var idx = list.indexOf(item);
                quote.Selected = !quote.Selected;

                if (idx > -1) {
                    list.splice(idx, 1);

                }
                else {
                    list.push(item);

                }
            };
            $scope.leaseexists = function (item, list) {
                return list.indexOf(item) > -1;
            };
            $rootScope.shoppingCart.totalPrice = 0;

            $scope.updatetermdata = function (item, code) {

                item.termdata = { code: code };
                console.log("termdata" + item.termdata);
            }

            $scope.updatenwterm = function (termfreq, item, oldtermf, oldp, termperiod, qty, step) {


                var freq = termfreq;
                var period = termperiod;
                var oldf = oldtermf;
                var oldp = oldp;
                var oldprice = item.mprice;
                var mbaseprice = (item.mprice * oldp * 0.9) / oldf;
                console.log("BasePrice:" + mbaseprice);
                console.log("TermFreq: " + termfreq + " oldtermf: " + oldtermf + " oldp: " + oldp + " termperiod :" + termperiod + " qty: " + qty);
                item.mtermf = freq;
                item.mtermp = period;

                item.mprice = Number((mbaseprice * freq) / (period * 0.9));
                $scope.UpdateTotal(oldprice, item.mprice, item, step);
                $scope.UpdateSubCart(item.msubquoteid, freq, period);
                console.log(item);
                //console.log($scope.Quotes);
                //$scope.UpdateCart(item, qty);
            }

            $scope.updateterm = function (termfreq, item, termperiod, qty, step) {
                var freq = termfreq.code;
                var period = termperiod.code;
                var oldf = item.mtermf;
                var oldp = item.mtermp;
                var oldprice = item.mprice;
                var mbaseprice = (item.mprice * oldp * 0.9) / oldf;
                item.mtermf = freq;
                item.mtermp = period;

                item.mprice = (mbaseprice * freq) / (period * 0.9);
                $scope.UpdateTotal(oldprice, item.mprice, item, step);

                //$scope.UpdateCart(item, qty);
            }
            $scope.UpdateSubCart = function (id, mterf, mtermp) {
                if ($scope.getSubProducts.length > 0) {
                    $scope.getSubProducts.forEach(function (obj) {
                        if (obj.mprodid == id) {
                            obj.mterf = mterf;
                            obj.mtermp = mtermp;
                            obj.mprice = (obj.mbasicprice * mterf) / (mtermp * 0.9);
                        }

                    });
                }

            }
            $scope.UpdateTotal = function (oldprice, newprice, item, step) {
                var passdata = item;
                $http.post("/api/QuotationApi/updateQuoteDatas", passdata).success(function (data, status) {
                    if (step == 1) {

                        $scope.Quotes.mquotetotal = $scope.Quotes.mquotetotal - Number(oldprice) + Number(newprice);

                    }
                    else if (step == 2) {
                        $scope.PrintedQuotes.mquotetotal = $scope.PrintedQuotes.mquotetotal - Number(oldprice) + Number(newprice);
                    }
                });
            };
            $scope.UpdateCart = function (item, no, step) {
                var oldprice = item.mprice;
                item.quantity = no;
                var newprice = item.mprice * no;
                $scope.UpdateTotal(oldprice, newprice, item, step);

            };
            $scope.getTermData = function (key) {

                var str = key.split(',');
                var term = $scope.getTerms(Number(str[0]), Number(str[1]));
                return term;
            };
            $scope.getTermDataOnly = function (key) {
                var str = key.split(',');
                var term = $scope.getOnlyTerms(Number(str[0]), Number(str[1]));
                return term;
            };

            $scope.getOnlyTerms = function (mtermf, mtermp) {
                var msg = "";
                var p = "";

                switch (mtermf) {
                    case 1:
                        msg = p + "monthly";
                        break;
                    case 3:
                        msg = p + "quarterly";
                        break;
                    case 4:
                        msg = p + "termly";
                        break;
                    case 6:
                        msg = p + "bi-annually";
                        break;
                    case 12:
                        msg = p + "annually";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getNewTerms = function (mtermf, mtermp) {
                var msg = "";
                var p = "";

                switch (mtermf) {
                    case 1:
                        msg = p + " per month";
                        break;
                    case 3:
                        msg = p + " per quarter";
                        break;
                    case 4:
                        msg = p + " per term";
                        break;
                    case 6:
                        msg = p + " per bi-annual";
                        break;
                    case 12:
                        msg = p + " per annum";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getTerms = function (mtermf, mtermp) {
                var msg = "";
                var p = "";
                if (mtermp != null) {
                    p = mtermp / 12;
                }

                switch (mtermf) {
                    case 1:
                        msg = p + " years monthly";
                        break;
                    case 3:
                        msg = p + " years quarterly";
                        break;
                    case 4:
                        msg = p + " years termly";
                        break;
                    case 6:
                        msg = p + " years bi-annually";
                        break;
                    case 12:
                        msg = p + " years annually";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getPeriodInWords = function (mtermf) {
                switch (mtermf) {
                    case 1:
                        msg = "One";
                        break;
                    case 2:
                        msg = "Four";
                        break;
                    case 3:
                        msg = "Three";
                        break;
                    case 4:
                        msg = "Four";
                        break;
                    case 5:
                        msg = "Five";
                        break;
                    default:
                        msg = "";
                        break;

                }
                //item.mprice=5;
                return msg;
            }
            $scope.getTotalPrice = function () {
                $scope.Quotes.forEach(function (itemObj) {
                    $scope.Quotes.totalPrice = Number($scope.Quotes.totalPrice) + Number($scope.getItemPrice(itemObj));
                });
            };
            $scope.getItemPrice = function (itemObj) {
                var itemPrice = 0;
                itemPrice = (Number(itemObj.Product.mprice) * Number(itemObj.Product.quantity));
                return itemPrice;
            };
            $scope.ConfirmSend = function ($event, leaseno, item) {
                //var id = $cookies.getObject('leasebasket');
                $scope.confirmationDialogConfig = {
                    title: "Warning!!!",
                    message: "Are you sure to send agreement copy to lessor at lessor address?",
                    buttons: [{
                        label: "Yes, send it",
                        action: "updateSend",
                        step: item,
                        index: leaseno
                    }]
                };
                $scope.showDialog(true);

            };
            $scope.updateSend = function (index, item) {
                $scope.tabloading = true;
                $http.get("/api/AgreementApi/MarkSend?mleaseno=" + index).success(function (data, status) {
                    if (data == "Success") {

                        item.msend = 2;
                        $scope.showDialog(false);
                        $scope.tabloading = false;
                    }
                });
            }
            $scope.deleteFromCart = function (index, step) {
                console.log("index:");
                $scope.confirmationDialogConfig = {
                    title: "Warning!!!",
                    message: "Are you sure you want to delete?",
                    buttons: [{
                        label: "Delete",
                        action: "delete",
                        step: step,
                        index: index
                    }]
                };
                $scope.showDialog(true);
            };
            $scope.deleteFromSubCart = function (index) {
                //var id = $cookies.getObject('leasebasket');
                $scope.confirmationDialogConfig = {
                    title: "Warning!!!",
                    message: "Are you sure you want to delete?",
                    buttons: [{
                        label: "Delete Reference",
                        action: "deleterelatedproduct",
                        step: 1,
                        index: index
                    }]
                };
                $scope.showDialog(true);
            };
            $scope.executeDialogAction = function (action, index, step) {
                if (typeof $scope[action] === "function") {
                    $scope[action](index, step);
                }
            };
            $scope.showDialog = function (flag) {
                jQuery("#confirmation-dialog .modal").modal(flag ? 'show' : 'hide');
            };

            $scope.GenerateAgreement = function () {
                $scope.generateagreement = true;
                $scope.SelectedQuotesApprove = filterFilter($scope.QuotesApprove, { Selected: true });
                var d = [];
                $scope.SelectedQuotesApprove.forEach(function (e) {
                    var dd = {
                        "muserid": $rootScope.mschoolid,
                        "msubquoteid": e.msubquoteid
                    }
                    d.push(dd);
                });
                $http.get("/api/UserApi/getUserDatas?getid=" + $rootScope.muserid).success(function (data, status) {
                    $scope.UserData = data;
                    console.log($scope.UserData.morgname);
                });
                $location.hash('successmsg');
                $anchorScroll();
            }
            $scope.BackToAgreement = function () {
                $scope.generateagreement = false;
                $scope.SelectedQuotesApprove = [];
                var offset = jQuery('#lessor-md').offset();
                o = offset.top - 150;
                $window.scrollTo(0, o);
                //$location.hash('successmsg');
                //$anchorScroll();
            }
            $scope.setData = function (index, item) {
                //var d = [];
                if (item.length > 0) {
                    var s = "";
                    item.forEach(function (e) {
                        if (s == "") {
                            s = e.msubquoteid;
                        }
                        else {
                            s = s + "," + e.msubquoteid;
                        }
                    });
                    var dd = {
                        "Itemlist": s
                    }
                    $scope.agreementdata.push(dd);
                }

            }
            $scope.AddAddress = function (item) {
                $scope.leaseaddress = {
                    buttons: [{
                        label: "UpdateAddress",
                        action: "UpdateAddress",
                        item: item,
                        qty: 1,
                        event: 0,
                    }]
                };
                jQuery("#alternative_address").val(item.Address);
                jQuery("#leaseaddress-dialog .modal").modal('show');
            }
            $scope.UpdateAddress = function (item) {
                var address = jQuery("#alternative_address").val();
                item.Address = address;
                jQuery("#alternative_address").val('');
                jQuery("#leaseaddress-dialog .modal").modal('hide');

            }
            $scope.SaveAgreement = function (item) {
                var trhtml = "";
                var showwarn = false;
                //jQuery("#leaseterm-dialog tbody").html(trhtml);
                var items = $scope.Quotes.filter(function (prods) {

                    return (prods.Selected == true);
                });
                $scope.splititem = [];
                if (items.length > 1) {
                    var oldleadtime = $scope.leadtime;
                    items.forEach(function (obj) {

                        if (obj.mleadtime > oldleadtime) {
                            $scope.splititem.push(obj);
                            showwarn = true;
                        }
                    });

                }
                if (showwarn) {
                    $scope.leaseTerms1 = {
                        title: "Approval Required!",
                        message: "The lead time of following products are over " + $scope.leadtime + " days.",
                        message2: "Do you want to split it?",
                        moreoption: "",
                        oproduct: "",
                        buttons: [{
                            label: "Yes, Split order",
                            action: "MakeSplit",
                            item: items,
                            qty: "",
                            event: 1
                        },
                        {
                            label: "No, not to split",
                            action: "MakeSplit",
                            item: items,
                            qty: "",
                            event: 0
                        },
                        ]

                    };
                    jQuery("#leaseterm1-dialog .modal").modal('show');

                }
                else {
                    $scope.MakeSplit(items, '', 0);
                }
                //toastr.success("Address updated successfully", "Success");
            };
            $scope.MakeSplit = function (index, quotestatus, flag) {
                //jQuery("#leaseterm1-dialog .modal").modal('hide');
                $scope.itemsmodels = {};
                $scope.morderref = {};
                $scope.leaseTerms = {
                    title: "By confirming your order, you are booking the following stock items ready for delivery upon lease actiVATion.",
                    Products: index,
                    Split: flag,
                    buttons: [{
                        label: "Yes",
                        action: "SaveOrder",
                        item: $scope.Quotes,
                        qty: 1,
                        event: 0,
                    }]

                };
                jQuery("#leaseterm-dialog .modal").modal({
                    backdrop: 'static',
                    keyboard: false,
                    "show": true
                });
                //jQuery("#leaseterm1-dialog .modal").modal('hide');
            }
            $scope.EnableBtn = function () {
                var f = true;
                var value = $scope.Quotes;
                value.forEach(function (obj) {

                    if (obj.Selected == true) {
                        f = false;
                    }
                });
                if (f) {
                    return true;
                }
                else {
                    return false;
                }

            }
            $scope.changefield = function (item) {
                if (item == 1) {

                } else {

                }
            }
            $scope.storeValue = function ($index, value) {
                var d = {
                    "items": value
                };
                console.info($index, value);
                $scope.ItemM.push({ items: value });
            }

            $scope.SaveOrder = function () {
                var multipledatas = [];
                var f = true;
                if ($scope.ItemM.length > 0) {
                    var i = 0;
                    $scope.ItemM.forEach(function (obj) {
                        if ($scope.morderref[i].morderref == "" || $scope.morderref[i].morderref == undefined) {
                            $scope.morderref[i].emptyref = true;
                            f = false;
                            return false;
                        }
                        var mquotetotal = 0;
                        obj.items.forEach(function (obj2) {
                            if (obj2.Selected == true) {
                                mquotetotal = mquotetotal + Number((obj2.mprice * obj2.quantity).toFixed(2));

                            }
                        });
                        var datas = {
                            "Product": obj.items,
                            "msorderref": $scope.morderref[i].morderref,
                            "muserid": $rootScope.mschoolid,
                            "mquotetotal": mquotetotal,
                            "mpayment": 1,
                        };
                        multipledatas.push(datas);
                        console.info("Item Models", obj.items);
                        console.info("OrderRef", $scope.morderref[i].morderref);
                        i++;
                    });

                }
                if (!f) {
                    return false;
                }
                //return;
                jQuery("#leaseterm-dialog .modal").modal('hide');
                jQuery("#leaseterm1-dialog .modal").modal('hide');

                //$scope.Quotes.SelectedQuote=$scope.selected;
                //return false;
                $http.get("/api/LeaseBankApi/GetBankById?muserid=" + $rootScope.mschoolid).success(function (data, status) {
                    if (data != "empty") {
                        $scope.bank = data;
                        $scope.bankfound = true;
                    } else {
                        $scope.bank = {
                            "muserid": "",
                            "mbankname": "",
                            "mbankaccount": "",
                            "maccountholder": "",
                            "mbankshort": "",
                        };
                    }
                    jQuery('#leasebank-dialog .modal').modal({
                        backdrop: 'static',
                        show: true,
                        keyboard: false
                    }).one('click', '#continue', function (e) {
                        $scope.dataloading = true;
                        multipledatas.forEach(function (o) {
                            o.mpayment = $scope.payment;
                        });
                        console.log(multipledatas);
                        $http.post("/api/ProductApi/SaveOrder", multipledatas).success(function (data, status) {
                            if (data !== "failed") {
                                $scope.IsChecked = false;
                                $scope.IsClicked = false;
                                $scope.leaseselected = [];
                                $scope.itemsmodels = {};
                                $scope.morderref = {};
                                var mleaseids = {
                                    muserid: $rootScope.mschoolid,
                                    mleasenos: data,

                                }
                                $scope.mleaseall = data;
                                //$("input[name='mleaseids']").val(JSON.stringify(data));
                                $http.post('/api/AggreementApi/GetListAggreementById/', mleaseids).success(function (data2) {

                                    if (data2 == "empty") {
                                        $scope.modalAggreements = [];

                                    }
                                    if (data2.length <= 0) {
                                        $scope.modalAggreements = [];
                                    }
                                    else {

                                        $scope.modalAggreements = data2;

                                    }

                                    $scope.bootdetailmsg = "Thank you for confirming order.Now, You can print agreements.<br/> You can also print your agreement status in My account > Generated Agreements";
                                    jQuery('#leasebank-dialog .modal').modal('hide');
                                    $scope.dataloading = false;
                                    jQuery("#generatedAgreementmodal .modal").modal({
                                        backdrop: 'static',
                                        keyboard: false
                                    });


                                    getCounter();
                                    $scope.tabloading = false;
                                    $scope.setActiveTab(3);


                                });
                            }
                            else {
                                toastr.warning("Something went wrong", "Warning!!");
                                $scope.tabloading = false;
                            }
                        });

                    })
                });

            };
            $scope.CancelBank = function () {
                $scope.bankfound = true;
            }
            $scope.EditBank = function () {
                //alert("true");
                $scope.bankfound = false;
            };
            $scope.bankupdate = function () {
                $scope.bank.muserid = $rootScope.mschoolid;
                $http({

                    method: "POST",

                    url: "/api/LeaseBankApi/BankUpdate",

                    data: $scope.bank
                }).success(function (data) {
                    if (data == "success") {
                        toastr.success("detail updated successfully", "Success");
                        $scope.bankfound = true;
                    }
                    else {
                        toastr.success("something went wrong!", "Warning");
                        $scope.bankfound = false;
                    }
                });
            };
            jQuery('#leaseterm-dialog modal').on('hidden.bs.modal', function () {
                jQuery("#leaseterm1-dialog .modal").modal('hide');


            });
            $scope.updateTermCondition = function (index, quotestatus) {
                var getid = $scope.PrintedQuotes[index].msubquoteid;
                var oproduct = $scope.PrintedQuotes[index];
                var moreoption = [];
                if ($scope.getSubProducts.length > 0) {
                    moreoption = $scope.getSubProducts.filter(function (obj) {
                        return obj.mprodid === getid;
                    });
                }
                $scope.leaseTerms1 = {
                    title: "Approval Required!",
                    message: "Do you want to make terms flexible for further?",
                    moreoption: moreoption,
                    oproduct: oproduct,
                    buttons: [{
                        label: "Yes, make it flexible",
                        action: "updateStatus",
                        item: index,
                        qty: quotestatus,
                        event: 1
                    },
                    {
                        label: "No, make it fixed",
                        action: "updateStatus",
                        item: index,
                        qty: quotestatus,
                        event: 0
                    },
                    ]

                };
                jQuery("#leaseterm1-dialog .modal").modal('show');
            };
            $scope.updateReplaceProduct = function (itemid) {
                $scope.replaceProduct = itemid;
            };
            $scope.updateStatus = function (index, quotestatus, flag) {
                // console.log($scope.Quotes.Product[index]);
                var flexible = 0;
                console.log($scope.replaceProduct);
                if ($scope.replaceProduct != 0) {

                    var item = $scope.PrintedQuotes[index];
                    var rproduct = $scope.getSubProducts.filter(function (obj) {
                        console.log(obj);
                        return obj.Id == $scope.replaceProduct;
                    });
                    var rproduct2 = {
                        "mprodvarid": rproduct[0].mprodvarid,
                        "msupplierid": rproduct[0].msupplierid,
                        "mprice": rproduct[0].mprice
                    };
                    $scope.getSubProducts.forEach(function (obj) {
                        if (obj.Id === $scope.replaceProduct) {
                            obj.mprodvarid = item.mprodvarid;
                            obj.msupplierid = item.msupplierid;
                            obj.mprice = item.mprice;
                        }
                    });
                    $scope.PrintedQuotes[index].mprodvarid = rproduct2.mprodvarid;
                    $scope.PrintedQuotes[index].msupplierid = rproduct2.msupplierid;
                    $scope.PrintedQuotes[index].mprice = rproduct2.mprice;

                }

                if (flag == 1) {
                    flexible = 1;
                }
                else {
                    flexible = 0;
                }
                jQuery("#leaseterm1-dialog .modal").modal('hide');
                var getid = $scope.PrintedQuotes[index].msubquoteid;
                $http.get("/api/QuotationApi/updateQuoteStatus?getid=" + getid + "&status=" + quotestatus + "&flexible=" + flexible + "&muserid=" + $rootScope.muserid).success(function (data, status) {
                    if (data == "Updated") {
                        if ($scope.replaceProduct != 0) {
                            $scope.UpdateTotal($scope.PrintedQuotes[index].mprice, $scope.PrintedQuotes[index].mprice, $scope.PrintedQuotes[index], 2);
                            $http.post("api/QuotationApi/updateRelatedProduct", rproduct).success(function (data, status) {
                            });
                        }
                        $scope.replaceProduct = 0;
                        $scope.getprintedquote();
                        $scope.bootmsg = "Approve Successfully";
                        $scope.bootdetailmsg = "Product move to step-3 sent to lessor";
                        $scope.boottab = 3;
                        $scope.nextstep = true;
                        //$scope.showmodel = true;
                        //jQuery("#msgModal").modal("show");
                        toastr.success("Product move to step-3 sent to lessor", "Approve Successfully");

                        //$scope.PrintedQuotes[index].mquotestatus = quotestatus;

                    }
                    else {
                        toastr.error("Something went wrong", "Warning");
                    }
                });
                $scope.showDialog();
            };

            $scope.updateApproveStatus2 = function (item, quotestatus) {
                // console.log($scope.Quotes.Product[index]);
                var getid = item.msubquoteid;
                $http.get("/api/QuotationApi/updateQuoteStatus?getid=" + getid + "&status=" + quotestatus + "&flexible=0&muserid=" + $rootScope.muserid).success(function (data, status) {
                    if (data == "Updated") {

                        //toastr.success("Quotation status is updated successfully!", "Success");
                        $scope.getapprovequote();
                        $scope.bootmsg = "Un Approve Successfully";
                        $scope.bootdetailmsg = "Product move to step-2 approve quotation";
                        $scope.boottab = 3;
                        $scope.nextstep = false;
                        //$scope.showmodel = true;
                        /*$scope.bootmsg = "Approve Successfully";
                        $scope.bootdetailmsg = "Please check your order in Your order";
                        $scope.boottab = 4;
                        jQuery("#msgModal").modal("show");
                        */
                        toastr.success("Product move to step-2 approve quotation", "Un Approve Successfully");
                    }
                    else {
                        toastr.error("Something went wrong", "Warning");
                    }
                });
                $scope.showDialog();
            };

            $scope.delete = function (index, step) {
                console.log("Index :" + index + " Step:" + step);
                var getid = 0;

                if (step == 1) {
                    getid = $scope.Quotes[index].msubquoteid;
                }
                else if (step == 2) {
                    getid = $scope.PrintedQuotes[index].msubquoteid;
                }
                $http.get("/api/QuotationApi/deleteSubQuoteById?getid=" + getid).success(function (data, status) {
                    if (data == "Delete") {
                        if (step == 1) {
                            toastr.success("Your item remove from lease basket sucessfully!", "Success");
                            $scope.Quotes.splice(index, 1);
                            if ($scope.Quotes.length <= 0) {
                                $scope.emptyquote = true;
                            }
                        }
                        else if (step == 2) {
                            toastr.success("Your item remove from lease basket sucessfully!", "Success");
                            $scope.PrintedQuotes.splice(index, 1);
                            if ($scope.PrintedQuotes.length <= 0) {
                                $scope.emptyprintedquote = false;

                            }
                            getCounter();
                        }
                    }
                    else {
                        toastr.error("Something went wrong", "Warning");
                    }
                });
                $scope.showDialog();
            };
            $scope.deleterelatedproduct = function (index, step) {
                var id = index;
                $http.get('/api/QuotationApi/DeleteCompareProduct?id=' + id).success(function (data) {
                    if (data == "delete") {
                        var qst = $scope.getSubProducts.filter(function (prod) {
                            return prod.Id !== id;
                        });
                        $scope.getSubProducts = qst;
                        toastr.success("Related Product remove from Your Basket", "Success");
                    }
                    $scope.showDialog(false);
                });

            };

            jQuery(function () {
                jQuery("#datepicker").datepicker({
                    autoclose: true,
                    todayHighlight: true,
                    format: 'dd/mm/yyyy'
                }).datepicker('update', new Date())
                .on('changeDate', function (ev) {
                    newDate = new Date(ev.date);
                    $scope.edate = newDate.getFullYear() + "-" + (("0" + (newDate.getMonth() + 1)).slice(-2)) + "-" + newDate.getDate();
                    console.log($scope.edate);
                });
            });
            $scope.confirmDeliveryModal = function (msubq, index) {
                $scope.msubquote = msubq;
                $scope.position = index;
                //jQuery("#reviewModal .modal-body").html(data);
                jQuery("#reviewModal").modal("show");

                /*$http.post("api/ProductApi/UpdateQuote", passdata).success(function (data, status) {
                    $http({
                        method: "POST",
                        url: "/Quotation/LoadQuotation/",
                        data: {"mquoteid":$scope.Quotes.mquoteid,"subquoteids":$scope.selected}
                    }).success(function (data) {

                    });
                });*/
            };
            $scope.SaveReview = function () {
                jQuery("#reviewModal").modal("hide");
                $scope.tabloading = true;
                var pos = $scope.position;
                var subquote = $scope.msubquote;
                var edate = $scope.edate;
                var condition = $scope.condition;
                console.log("Position" + $scope.position);
                var data = { "mreceivedate": edate, "mcondition": condition, "msubquoteid": subquote, "muserid": $rootScope.muserid };
                $http.post("/api/OrderApi/updateOrderStatus", data).success(function (data, status) {
                    $scope.tabloading = false;

                    if (data == "Save") {
                        $scope.condition = 1;
                        $scope.reviewnote = "";
                        $scope.msubquote = 0;
                        $scope.position = -1;
                        $scope.Orders[pos].mquotestatus = "confirmed";
                        toastr.success("Thank you for your delivery review!", "Success");
                    }
                    else {
                        toastr.error("Something went wrong", "Warning");
                    }
                });
                //$scope.showDialog();
            }

            /****************************Print / Email ***************************************/
            $scope.executeleaseAction = function (action, passdata, step, getid) {
                if (typeof $scope[action] === "function") {
                    $scope[action](passdata, step, getid);
                }
            };
            $scope.showleaseDialog = function (flag) {
                jQuery("#leaseconfirmation-dialog .modal").modal(flag ? 'show' : 'hide');
            };
            $scope.getLeasePdf = function (mleaseid) {
                $scope.dataloading = true;
                $http.post("/api/AggreementApi/updateLastPrint?mleaseid=" + mleaseid + "&muserid=" + $rootScope.muserid).success(function (data, status) {
                    $http({
                        method: "POST",
                        url: "/Order/LoadOrder2/",
                        data: { "mleaseid": mleaseid }
                    }).success(function (data) {
                        //jQuery("#agreementmodal .modal-body").html(data);
                        var blobURL = URL.createObjectURL(b64toBlob(data, "application/pdf"));
                        //iframe.src = blobURL;
                        var iframe = document.getElementById('printf3');
                        /*jQuery("iframe#printf3").load(function () {
                            this.style.height = this.contentWindow.document.body.offsetHeight;
                       });*/
                        iframe.src = blobURL + "#zoom=100";
                        /*setTimeout(function () {
                            iframe.height = "";
                            iframe.height = iframe.contentWindow.document.body.scrollHeight + "px";
                            alert(iframe.height);
                        }, 1000);*/
                        jQuery("#agreementmodal .modal-title").html("Lease Agreement");
                        jQuery("#agreementmodal .modal").modal({

                            "show": true
                        });

                        $scope.dataloading = false;
                        $scope.setActiveTab(3);
                    });
                });
            };
            function b64toBlob(b64Data, contentType, sliceSize) {
                const byteCharacters = atob(b64Data);
                const byteArrays = [];
                sliceSize = 512;
                for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
                    const slice = byteCharacters.slice(offset, offset + sliceSize);

                    const byteNumbers = new Array(slice.length);
                    for (let i = 0; i < slice.length; i++) {
                        byteNumbers[i] = slice.charCodeAt(i);
                    }

                    const byteArray = new Uint8Array(byteNumbers);
                    byteArrays.push(byteArray);
                }

                const blob = new Blob(byteArrays, { type: contentType });
                return blob;
            }
            jQuery("#agreementmodal2 .modal").on("shown.bs.modal", function () {
                jQuery("#agreementmodal .modal-body").block({
                    message: '<h6>Please wait..</h6>'
                });
                var iframe = document.getElementById('printf2');
                iframe.src = "";
                var pagecount = jQuery("#pgcount").val();
                if (pagecount > 2) {

                    html2canvas(jQuery(".print-wrap:eq(0)")[0], {
                        imageTimeout: 2000,
                        scale: 2,
                        scrollX: 0,
                        scrollY: -10,
                        removeContainer: true,
                    }).then(function (canvas) {
                        canvas.getContext('2d').scale(2, 2);
                        calculatePDF_height_width(".print-wrap", 0);
                        pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);

                        var imgData = canvas.toDataURL("image/jpeg", 1.0);
                        pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                        html2canvas(jQuery(".print-wrap:eq(1)")[0], {
                            imageTimeout: 2000,
                            scale: 2,
                            scrollX: 0,
                            scrollY: 0,
                            removeContainer: true,
                        }).then(function (canvas) {
                            canvas.getContext('2d').scale(2, 2);
                            calculatePDF_height_width(".print-wrap", 1);

                            var imgData = canvas.toDataURL("image/jpeg", 1.0);
                            pdf.addPage(PDF_Width, PDF_Height);
                            pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                            html2canvas(jQuery(".print-wrap:eq(2)")[0], {
                                imageTimeout: 2000,
                                scale: 2,
                                scrollX: 0,
                                scrollY: 0,
                                removeContainer: true,
                            }).then(function (canvas) {
                                canvas.getContext('2d').scale(2, 2);
                                calculatePDF_height_width(".print-wrap", 1);
                                pdf.addPage(PDF_Width, PDF_Height);

                                calculatePDF_height_width(".print-wrap", 2);

                                var imgData = canvas.toDataURL("image/jpeg", 1.0);
                                pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                                setTimeout(function () {

                                    var blob = pdf.output("blob");

                                    //Getting URL of blob object
                                    var blobURL = URL.createObjectURL(blob);
                                    iframe.src = blobURL;

                                    //var downloadLink = document.getElementById('exportpdfnew');
                                    //downloadLink.href = blobURL;
                                    //Showing PDF generated in iFrame element
                                    let objFra = document.getElementById('printf2');
                                    jQuery("#printf2").css("height", Total_height);
                                    jQuery("#printf2").slideDown();
                                    jQuery("#grid").hide();
                                    jQuery("#agreementmodal .modal-body").unblock();
                                }, 50);

                            });
                        });

                    });
                } else {
                    html2canvas(jQuery(".print-wrap:eq(0)")[0], {
                        imageTimeout: 2000,
                        scale: 2,
                        scrollX: 0,
                        scrollY: -10,
                        removeContainer: true,
                    }).then(function (canvas) {
                        canvas.getContext('2d').scale(2, 2);
                        calculatePDF_height_width(".print-wrap", 0);
                        pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
                        console.log(canvas);
                        var imgData = canvas.toDataURL("image/jpeg", 1.0);
                        pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                        html2canvas(jQuery(".print-wrap:eq(1)")[0], {
                            imageTimeout: 2000,
                            scale: 2,
                            scrollX: 0,
                            scrollY: 0,
                            removeContainer: true,
                        }).then(function (canvas) {
                            canvas.getContext('2d').scale(2, 2);
                            calculatePDF_height_width(".print-wrap", 1);

                            var imgData = canvas.toDataURL("image/jpeg", 1.0);
                            pdf.addPage(PDF_Width, PDF_Height);
                            pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, HTML_Width, HTML_Height);
                            setTimeout(function () {

                                //pdf.autoPrint({ variant: 'non-confirm' });
                                //pdf.output('blob');
                                var blob = pdf.output("blob");

                                //Getting URL of blob object
                                var blobURL = URL.createObjectURL(blob);
                                iframe.src = blobURL;

                                //var downloadLink = document.getElementById('exportpdfnew');
                                //downloadLink.href = blobURL;
                                //Showing PDF generated in iFrame element
                                let objFra = document.getElementById('printf2');
                                jQuery("#printf2").css("height", Total_height);
                                jQuery("#printf2").slideDown();
                                jQuery("#grid").hide();
                                jQuery("#agreementmodal .modal-body").unblock();
                            }, 50);

                        });
                    });
                }
            });
            $scope.PrintAllAgreement = function () {
                $scope.tabloading = true;
                jQuery.blockUI();

                var mleaseids = {
                    muserid: $rootScope.muserid,
                    mleasenos: $scope.mleaseall,

                }
                $http.post("/api/AggreementApi/updateallLastPrint/", mleaseids).success(function (data, status) {
                    jQuery("#generatedAgreementmodal .modal").modal('hide');
                    $scope.bootmsg = "Your agreements have been generated and is/are in file Agreements.zip in your download folder.";
                    $scope.bootdetailmsg = "Please print,  sign and send  the agreement/s in the said file to the lessor at address given on the agreement/s";
                    //$scope.showmodel = true;
                    $scope.hideclose = false;
                    jQuery("#msgModal").modal({
                        backdrop: 'static',
                        show: true,
                        keyboard: false
                    });
                    $http({
                        method: "POST",
                        url: "/Order/LoadOrders/",
                        data: { "mleaseids": mleaseids.mleasenos }
                    }).success(function (data) {
                        //console.log(data.result);
                        jQuery.unblockUI();

                        //get the file name for download
                        if (data.fileName != "") {
                            //use window.location.href for redirect to download action for download the file
                            window.location.href = "@Url.RouteUrl(new
                                { Controller = "Order", Action = "Download"})/?file=" + data.fileName;
                        }
                        jQuery("#msgModal").modal("hide");
                        $scope.tabloading = false;
                        $scope.setActiveTab(3);
                    });
                });
            };
            $scope.print = "";
            $scope.printorder = function (index) {
                $scope.tabloading = true;
                $scope.print = index;
                setTimeout(function () {
                    var data = jQuery("#invoice-box").html();

                    console.log(data);
                    if (data != "empty") {
                        var DocumentContainer = jQuery("#invoice-box").html();
                        var height = jQuery("#invoice-box").height();
                        var html = '<html><head>' +
                                       '</head><body style="background:#ffffff;">' +
                                       jQuery("#invoice-box").html() +
                                       '</body></html>';
                        var myFrame = jQuery("#printf").contents().find('body');
                        var textareaValue = data;
                        myFrame.html(textareaValue);
                        window.frames["printf"].focus();
                        window.frames["printf"].print();
                    }

                }, 100);
                $scope.tabloading = false;


            };
            $scope.PrintSingleQuote = function (index) {
                $scope.dataloading = true;
                var passdata = $scope.Quotes[index];
                var getid = $scope.Quotes[index].msubquoteid;
                var d = [];
                d.push(passdata);
                PrintSingleQuotes(passdata, getid);


            };

            function PrintSingleQuotes(passdata, getid) {
                $scope.showleaseDialog(false);
                $scope.dataloading = true;
                $http.post("/api/ProductApi/UpdateSingleQuote", passdata).success(function (data, status) {
                    $http({
                        method: "POST",
                        url: "/Quotation/LoadQuotation/",
                        data: { "muserid": $rootScope.muserid, "subquoteids": getid }
                    }).success(function (data) {
                        jQuery("#quoteModal .modal-body").html(data);
                        jQuery("#quoteModal").modal("show");
                        $scope.setActiveTab(1);
                        $scope.dataloading = false;
                    });
                });
            }

            $scope.PrintReferenceSingleQuotes = function (getid) {
                var divid = "#div" + getid;
                var html = jQuery(divid).html();
                $scope.dataloading = true;
                $http({
                    method: "POST",
                    url: "/Quotation/LoadReferenceQuotation/",
                    data: { "muserid": $rootScope.muserid, "subquoteids": getid }
                }).success(function (data) {
                    jQuery("#displayview").html(html);
                    jQuery("#nondisplayview").html(data);
                    jQuery("#rquoteModal").modal("show");
                    //$scope.setActiveTab(1);
                    $scope.dataloading = false;
                });

            }
            $scope.PrintSingleItem = function (index, step, item) {
                $scope.dataloading = true;
                var passdata = $scope.Quotes[index];
                var getid = 0;
                if (step == 3) {
                    getid = item.msubquoteid;
                }
                else if (step == 2) {
                    getid = $scope.PrintedQuotes[index].msubquoteid;
                }
                $http({
                    method: "POST",
                    url: "/Quotation/LoadQuotation/",
                    data: { "muserid": $rootScope.muserid, "subquoteids": getid }
                }).success(function (data) {

                    jQuery("#quoteModal .modal-body").html(data);
                    jQuery("#quoteModal").modal("show");
                    $scope.dataloading = false;
                });

            };



            /*********************************Upload DOC************************************/
            $scope.UploadDoc = function ($event, mleaseno) {
                $event.stopPropagation();
                $scope.tabloading = true;
                $scope.mleaseno = mleaseno;

                jQuery("#docinmodal").modal({
                    backdrop: 'static',
                    keyboard: false,
                    "show": true
                });
                $scope.tabloading = false;

            }
            $scope.mleaseno = "";
            $scope.leasedocid = "";
            var uploader = $scope.uploader =

                        new FileUploader({
                            //url: window.location.protocol + '//' + window.location.host + window.location.pathname + '/api/Upload/UploadFile'

                            url: '/api/AgreementApi/UploadFile',

                        });


            // }


            // FILTERS
            uploader.filters.push({
                name: 'extensionFilter',
                fn: function (item, options) {
                    var filename = item.name;
                    var extension = filename.substring(filename.lastIndexOf('.') + 1).toLowerCase();
                    if (extension == "jpg" || extension == "png" || extension == "JPG" || extension == "jpeg" || extension == "JPEG" || extension == "pdf")
                        return true;
                    else {
                        toastr.error("Invalid file format. Please select a file with pdf/jpg/JPEG or rtf format  and try again.", "Warning");
                        return false;
                    }
                }
            });

            uploader.filters.push({
                name: 'sizeFilter',
                fn: function (item, options) {
                    var fileSize = item.size;
                    fileSize = parseInt(fileSize) / (1024 * 1024);
                    if (fileSize <= 1)
                        return true;
                    else {
                        toastr.error("Selected file exceeds the MB file size limit. Please choose a new file and try again.", "Warning");
                        return false;
                    }
                }
            });

            uploader.filters.push({
                name: 'itemResetFilter',
                fn: function (item, options) {
                    if (this.queue.length < 5)
                        return true;
                    else {
                        toastr.error("You have exceeded the limit of uploading files.", "Warning");
                        return false;
                    }
                }
            });

            // CALLBACKS

            uploader.onWhenAddingFileFailed = function (item, filter, options) {
                console.info('onWhenAddingFileFailed', item, filter, options);
            };
            uploader.onAfterAddingFile = function (fileItem) {
                //alert('Files ready for upload.');
            };

            uploader.onSuccessItem = function (fileItem, response, status, headers) {
                $scope.uploader.queue = [];
                $scope.uploader.progress = 0;

                console.info('onCompleteItem', response);
                if (response != "empty") {
                    var ordersdata = new Object();
                    ordersdata.mleaseno = $scope.mleaseno;
                    ordersdata.mdocname = response;
                    ordersdata.muserid = $rootScope.muserid;
                    //{
                    //    "mleaseno": $scope.mleaseno,
                    //    "mdocname": response,
                    //    "muserid": $rootScope.muserid,
                    //};
                    $http.post('/api/AgreementApi/SaveDocIn', ordersdata).success(function (data) {
                        if (data == "Success") {
                            $scope.tabloading = false;

                            toastr.success("Your agreement uploaded successfully", "Success");
                            jQuery("#docinmodal").modal('hide');
                            $scope.DocUpload = true;
                            jQuery.unblockUI();
                            $scope.setActiveTab(3);
                        }
                        else {
                            toastr.error("Please try again", "warning");
                        }
                    });
                    /*jQuery.ajax({
                        url: '/api/AgreementApi/SaveDocIn',
                        type: 'POST',
                        data: {"ordersdata":ordersdata },
                        success: function (data) {
                            //$("#docinmodal")
                            if (data == "Success") {
                                //jQuery("#docinmodal").modal('hide');
                                $scope.tabloading = false;

                                toastr.success("Thank you for your delivery review!", "Success");
                                jQuery("#docinmodal").modal('hide');
                                //$scope.setActiveTab(3);
                                $scope.DocUpload = true;
                                jQuery.unblockUI();
                            }
                            else {
                                toastr.error("Please try again", "warning");
                            }
                        }
                    });*/
                }
                //$scope.userdatas.com_logo = response["data"]["filename"];
                //toastr.success("Selected file has been uploaded successfully.", "Warning");
            };
            jQuery('#docinmodal').on('hidden.bs.modal', function () {
                //jQuery("#docinmodal").modal('hide');
                $scope.DocUpload = false;

            });

            uploader.onProgressItem = function (fileItem, progress) {
                console.info('onProgressItem', fileItem, progress);
                //$scope.tabloading = true;
                jQuery.blockUI();
            };

            $scope.UploadDoc = function ($event, mleaseno) {
                $event.stopPropagation();
                $scope.tabloading = true;
                //mApp.block("#m_blockui_2_portlet");
                $scope.mleaseno = mleaseno;

                jQuery("#docinmodal").modal({
                    backdrop: 'static',
                    keyboard: false,
                    "show": true
                });
                $scope.tabloading = false;
                //mApp.unblock("#m_blockui_2_portlet");
            }


            $scope.Logout = function () {
                $scope.MSubmitted = false;
                $rootScope.IsUserLogedIn = false;
                $rootScope.userid = 0;
                $cookies.remove("userdata");
                $window.location.href = "/Leasing/";
            };

            /**************Address Code****************/
            $scope.alladdress = [];
            $scope.showAddresses = function (item) {
                var label = "Set Default Address";
                var action = "SetDefaultAddress";
                $scope.selectedaddressid = $scope.defaultaddressid;
                if (item != null) {
                    label = "Set Address";
                    action = "SetAddress";
                    $scope.selectedaddressid = item.Address;
                }
                $scope.tabloading = true;
                $http.get("/api/UserApi/GetUserAddresses?getid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.alladdress = data2;
                    }
                    else {
                        $scope.alladdress = [];
                    }
                    $scope.tabloading = false;
                });


            }
            $scope.User = {
                museraddrid: '',
                muid: '',
                maddress1: '',
                maddress2: '',
                mcity: '',
                mcountry: '',
                mlandmark: '',
                maddresstype: '',
                mpostcode: ''
            };
            $scope.AddNewAddress = function () {
                $http.get("/api/AccountApi/GetCountries").success(function (data, status) {

                    if (data == "empty") {
                        $rootScope.countries = [];

                    }
                    else {
                        $scope.countries = data;
                        $scope.getStates($scope.countries[229]);
                    }


                });
                jQuery("#addnewaddress-dialog .modal").modal('show');

            }
            $scope.submitText = "Save";
            $scope.SaveData = function (isValid) {
                if ($scope.submitText == 'Save') {
                    $scope.rsubmitted = true;
                    $scope.message = '';
                    $scope.User.muid = $rootScope.mschoolid;
                    if (isValid) {
                        $scope.submitText = 'Please Wait...';
                        //$scope.User = data;
                        $http({

                            method: "POST",

                            url: "/User/SaveUserAddress",

                            data: $scope.User
                        }).success(function (data) {
                            if (data["msg"] == "Success") {
                                $scope.Message = "Address save successfully";
                                toastr.success($scope.Message, "Success");
                                jQuery("#addnewaddress-dialog .modal").modal('hide');
                                $scope.User = {
                                    museraddrid: '',
                                    muid: '',
                                    maddress1: '',
                                    maddress2: '',
                                    mcity: '',
                                    mcountry: '',
                                    mlandmark: '',
                                    maddresstype: '',
                                    mpostcode: ''
                                };
                                $scope.setActiveTab(8);

                                //$scope.SaveCart();
                            }
                            else {
                                $scope.IsError = true;
                                alert('Invalid Credential!');
                            }

                            $scope.user = null;

                        }).error(function () {

                            alert('failed');

                        })

                    }
                    else {
                        jQuery('input.ng-invalid').first().focus();
                        $scope.message = 'Please fill required fields value';
                        $scope.rsubmitted = false;
                    }
                }
            }

            $scope.addressess = [];
            $scope.allAddress = [];
            $scope.getaddbtntxt = "Find the address";
            $scope.getaddressdisable = false;
            $scope.getAddress = function (postcode) {
                var apikey = "aftW_j9KrkakTrJ026QoSA27396";
                $scope.getaddressdisable = true;
                $scope.getaddbtntxt = "Loading..";
                $http.get("https://api.getaddress.io/find/" + postcode + "?api-key=" + apikey + "&expand=true&sort=true").success(function (data, status) {
                    if (data != null) {
                        $scope.User.mpostcode = data["postcode"];
                        $scope.allAddress = data["addresses"];
                        var i = 0;
                        $scope.allAddress.forEach(function (obj) {
                            var newobj = {
                                Code: i,
                                Name: jQuery.grep(obj.formatted_address, Boolean).join(", ")
                            };
                            $scope.addressess.push(newobj);
                            i++;
                        })

                    }
                    else {

                    }
                    $scope.getaddbtntxt = "Find the address";
                    $scope.getaddressdisable = false;


                });
            }
            $scope.getSelectedAddress = function (id) {

                console.log(id.Code);
                var d = $scope.allAddress[id.Code];
                $scope.User.maddress1 = d["line_1"];
                $scope.User.maddress2 = d["line_2"];
                $scope.User.mcity = d["town_or_city"];

            }
            $scope.getStates = function (countryid) {
                $scope.User.mcountry = countryid.Code;
                $http.get("/api/AccountApi/GetStates?cnid=" + countryid.Code).success(function (data, status) {

                    if (data == "empty") {
                        $rootScope.states = [];

                    }
                    else {
                        $scope.states = data;
                    }


                }).error(function () {

                    alert('failed');

                });
            }

            $scope.SetDefaultAddress = function (id) {
                $http.get("/api/UserApi/UpdateDefaultAddress?getid=" + id + "&schoolid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.Message = "Make address default successfully";
                        toastr.success($scope.Message, "Success");
                        jQuery("#addnewaddress-dialog .modal").modal('hide');
                        $scope.setActiveTab(8);
                    }
                    else {
                        $scope.alladdress = [];
                    }
                });
            };
            $scope.ChangeAddress = function (id) {
                var data = $scope.alladdress.filter(function (obj) {
                    return obj.museraddrid == id;
                });
                $scope.User = {
                    museraddrid: data[0].museraddrid,
                    muid: data[0].muid,
                    maddress1: data[0].maddress1,
                    maddress2: data[0].maddress2,
                    mcity: data[0].mcity,
                    mcountry: data[0].mcountry,
                    mlandmark: data[0].mlandmark,
                    maddresstype: data[0].maddresstype,
                    mpostcode: data[0].mpostcode
                };
                $http.get("/api/AccountApi/GetCountries").success(function (data, status) {

                    if (data == "empty") {
                        $rootScope.countries = [];

                    }
                    else {
                        $scope.countries = data;
                        $scope.getStates($scope.countries[229]);
                    }


                });

                jQuery("#addnewaddress-dialog .modal").modal('show');
            };

            $scope.DeleteAddress = function (index) {

                $scope.confirmationDialogConfig = {
                    title: "Warning!!!",
                    message: "Are you sure you want to delete?",
                    buttons: [{
                        label: "Delete",
                        action: "DeleteSingleAddress",
                        step: 0,
                        index: index
                    }]
                };
                $scope.showDialog(true);
            };
            $scope.DeleteSingleAddress = function (id) {
                $http.get("/api/UserApi/DeleteAddress?getid=" + id + "&schoolid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.Message = "address deleted successfully";
                        toastr.success($scope.Message, "Success");
                        $scope.showDialog(false);
                        //jQuery("#addnewaddress-dialog .modal").modal('hide');
                        $scope.setActiveTab(8);
                    }
                    else {
                        $scope.alladdress = [];
                    }
                });
            };

            /*****************************************Profile Code********************************************************/
            $scope.usubmitText = "Save";
            $scope.rsubmitted = false;
            $scope.validuser = true;
            $scope.userd = [];
            $scope.showhideprofile = function (f) {
                if (f == 1) {
                    $scope.edituser = true;
                }
                else {
                    $scope.edituser = false;
                }
            }
            $scope.$watchGroup(['form.$valid'], function (newVal) {
                $scope.IsFormValid = newVal;
                $scope.IsRegisterFormValid = newVal;
                //$scope.getTotalPrice();



            }, true);
            $scope.getProfile = function () {
                $scope.tabloading = true;
                $http.get("/api/UserApi/getUserAllDatas?getid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.userd = data2;
                    }
                    else {
                        $scope.Userd = [];
                    }
                    $scope.tabloading = false;
                });
            };
            $scope.UserSaveData = function (isValid) {
                if ($scope.usubmitText == 'Save') {
                    $scope.rsubmitted = true;
                    $scope.tabloading = true;
                    $scope.message = '';
                    if ($scope.validuser && isValid) {
                        $scope.usubmitText = 'Please Wait...';
                        //$scope.User = data;
                        $http({

                            method: "POST",

                            url: "/User/UpdateUser",

                            data: $scope.userd
                        }).success(function (data) {
                            if (data["msg"] == "Success") {
                                $scope.tabloading = false;
                                $scope.edituser = false;
                                $scope.usubmitText = "Save";
                                $scope.rsubmitted = false;
                                $scope.validuser = true;

                                $scope.showhideprofile(2);


                                $scope.Message = "Your data updated successfully";
                                toastr.success($scope.Message, "Success");

                                //$scope.SaveCart();
                            }
                            else {
                                $scope.IsError = true;
                                $scope.rsubmitted = false;
                                //$scope.edituser = false;
                                alert('Invalid Credential!');
                            }


                        }).error(function () {
                            $scope.rsubmitted = false;
                            alert('failed');

                        })

                    }
                    else {
                        jQuery('input.ng-invalid').first().focus();
                        $scope.message = 'Please fill required fields value';
                        $scope.rsubmitted = false;
                    }


                }

            }
            //Clear Form (reset)
            function ClearForm() {
                $scope.User = {};
                $scope.reg.$setPristine(); //here f1 our form name
                $scope.submitted = false;
            }


            /**************Contact  Code****************/
            $scope.allcontacts = [];
            $scope.defaultcontactid = 0;
            $scope.showContacts = function (item) {
                var label = "Set Default Contact";
                var action = "SetDefaultContact";
                $scope.selectedcontactid = $scope.defaultcontactid;
                $scope.tabloading = true;
                $http.get("/api/UserApi/GetUserContacts?getid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.allcontacts = data2;
                    }
                    else {
                        $scope.allcontacts = [];
                    }
                    $scope.tabloading = false;
                });


            }
            $scope.usercontacts = {
                cusername: '',
                csurname: '',
                cposition: '',
                cemailaddress: '',
                cphone: '',
                usermoreid: '',
                Id: 0,

            };
            $scope.AddNewContact = function () {
                jQuery("#addnewcontact-dialog .modal").modal('show');

            }
            $scope.csubmitText = "Save";
            $scope.CSaveData = function (isValid) {
                if ($scope.csubmitText == 'Save') {
                    $scope.crsubmitted = true;
                    $scope.message = '';
                    $scope.usercontacts.usermoreid = $rootScope.mschoolid;
                    if (isValid) {
                        $scope.crsubmitText = 'Please Wait...';
                        //$scope.User = data;
                        $http({

                            method: "POST",

                            url: "/User/SaveUserContact",

                            data: $scope.usercontacts
                        }).success(function (data) {
                            if (data["msg"] == "Success") {
                                $scope.Message = "Contact save successfully";
                                toastr.success($scope.Message, "Success");
                                jQuery("#addnewcontact-dialog .modal").modal('hide');
                                $scope.usercontacts = {
                                    cusername: '',
                                    csurname: '',
                                    cposition: '',
                                    cemailaddress: '',
                                    cphone: '',
                                    usermoreid: '',
                                    cposition: '',

                                };
                                $scope.setActiveTab(10);
                                $scope.crsubmitted = false;
                                //$scope.SaveCart();
                            }
                            else {
                                $scope.IsError = true;
                                $scope.crsubmitted = false;
                                alert('Invalid Credential!');
                            }

                            $scope.user = null;

                        }).error(function () {
                            $scope.crsubmitted = false;
                            alert('failed');

                        })

                    }
                    else {
                        jQuery('input.ng-invalid').first().focus();
                        $scope.message = 'Please fill required fields value';
                        $scope.crsubmitted = false;
                    }
                }
            }

            $scope.addcontact = [];


            $scope.SetDefaultContact = function (id) {
                $http.get("/api/UserApi/UpdateDefaultContact?getid=" + id + "&schoolid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.Message = "Make contact default successfully";
                        toastr.success($scope.Message, "Success");
                        jQuery("#addnewcontact-dialog .modal").modal('hide');
                        $scope.setActiveTab(10);
                    }
                    else {
                        $scope.alladdress = [];
                    }
                });
            };
            $scope.ChangeContact = function (id) {
                var data = $scope.allcontacts.filter(function (obj) {
                    return obj.Id == id;
                });
                $scope.usercontacts = {
                    cusername: data[0].cusername,
                    csurname: data[0].csurname,
                    cposition: data[0].cposition,
                    cemailaddress: data[0].cemailaddress,
                    cphone: data[0].cphone,
                    usermoreid: data[0].usermoreid,
                    Id: data[0].Id,


                };
                jQuery("#addnewcontact-dialog .modal").modal('show');
            };

            $scope.DeleteContact = function (index) {

                $scope.confirmationDialogConfig = {
                    title: "Warning!!!",
                    message: "Are you sure you want to delete?",
                    buttons: [{
                        label: "Delete",
                        action: "DeleteSingleContact",
                        step: 0,
                        index: index
                    }]
                };
                $scope.showDialog(true);
            };
            $scope.DeleteSingleContact = function (id) {
                $http.get("/api/UserApi/DeleteContact?getid=" + id + "&schoolid=" + $rootScope.mschoolid).success(function (data2, status) {
                    if (data2 != "empty") {
                        $scope.Message = "contact deleted successfully";
                        toastr.success($scope.Message, "Success");
                        $scope.showDialog(false);
                        //jQuery("#addnewaddress-dialog .modal").modal('hide');
                        $scope.setActiveTab(10);
                    }
                    else {
                        $scope.alladdress = [];
                    }
                });
            };



            /************************TAB CODE**************************/
            $scope.setActiveTab = function (tabNum) {
                initTabs();
                $scope.showmodel = false;
                //jQuery("#msgModal").modal("hide");
                if (tabNum == 1) {
                    $scope.breadcum = "Your Lease Basket";
                    $scope.pagetitle = "Your Lease Basket";
                    $scope.generateagreement = false;
                    loadquotes();
                }
                else if (tabNum == 2) {
                    $scope.breadcum = "Orders";
                    $scope.pagetitle = "Orders";
                    $scope.generateagreement = false;
                    $scope.getorders();
                    //$scope.getprintedquote();
                }
                else if (tabNum == 12) {
                    $scope.breadcum = "Pending Signature leases";
                    $scope.pagetitle = "Pending Signature leases";
                    getpendingsignaggreements();
                    //$scope.getapprovequote();

                }
                else if (tabNum == 3) {
                    $scope.breadcum = "Your lease orders";
                    $scope.pagetitle = "Your lease orders";
                    getaggreements();
                    //$scope.getapprovequote();

                }
                else if (tabNum == 4) {
                    $scope.breadcum = "Your active leases";
                    $scope.pagetitle = "Your active leases";
                    $scope.generateagreement = false;
                    $scope.getactiveaggreements();

                }
                else if (tabNum == 5) {
                    $scope.breadcum = "Wishlist";
                    $scope.pagetitle = "Wishist";
                    $scope.generateagreement = false;
                    //$scope.getleaseaggreement();

                }
                else if (tabNum == 6) {
                    $scope.breadcum = "Messages";
                    $scope.pagetitle = "Messages";
                    $scope.generateagreement = false;
                    //$scope.getleaseaggreement();

                }
                else if (tabNum == 7) {
                    $scope.breadcum = "My Profile";
                    $scope.pagetitle = "My Profile";
                    $scope.edituser = false;
                    $scope.getProfile();

                }
                else if (tabNum == 8) {
                    $scope.breadcum = "My Addresses";
                    $scope.pagetitle = "My Addresses";
                    $scope.showAddresses();
                }

                else if (tabNum == 9) {
                    $scope.breadcum = "Settings";
                    $scope.pagetitle = "Settings";
                    $scope.generateagreement = false;
                    //$scope.getleaseaggreement();

                }
                else if (tabNum == 10) {
                    $scope.breadcum = "My Contacts";
                    $scope.pagetitle = "My Contacts";
                    $scope.showContacts();
                }
                $scope.loader = false;
                tabClasses[tabNum] = "nav-link active";
                tabPaneClasses[tabNum] = "in active";
            };

            //Initialize
            initTabs();
            if ($scope.tab != null) {
                if ($scope.tab > 2 && $scope.tab <= 12) {
                    $scope.setActiveTab($scope.tab);
                }
                else {
                    $scope.setActiveTab(3);
                }
            } else {
                $scope.setActiveTab(3);
            }
            getCounter();



        }]);


    </script>
}

